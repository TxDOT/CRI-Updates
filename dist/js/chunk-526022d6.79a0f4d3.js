(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-526022d6"],{"008c":function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return P})),r.d(t,"e",(function(){return D})),r.d(t,"f",(function(){return E})),r.d(t,"g",(function(){return R}));var i=r("b2b2"),n=r("a9ab");const s=(e,t,r)=>[t,r],o=(e,t,r)=>[t,r,e[2]],a=(e,t,r)=>[t,r,e[2],e[3]];function c(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:Object(i["l"])(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function d({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function u(e,t,r){const i=[];let n,s,o,a;for(let c=0;c<r.length;c++){const u=r[c];c>0?(o=l(e,u[0]),a=d(e,u[1]),o===n&&a===s||(i.push(t(u,o-n,a-s)),n=o,s=a)):(n=l(e,u[0]),s=d(e,u[1]),i.push(t(u,n,s)))}return i.length>0?i:null}function h(e,t,r,i){return u(e,r?i?a:o:i?o:s,t)}function p(e,t,r,i){const n=[],c=r?i?a:o:i?o:s;for(let s=0;s<t.length;s++){const r=u(e,c,t[s]);r&&r.length>=3&&n.push(r)}return n.length?n:null}function f(e,t,r,i){const n=[],c=r?i?a:o:i?o:s;for(let s=0;s<t.length;s++){const r=u(e,c,t[s]);r&&r.length>=2&&n.push(r)}return n.length?n:null}function b({scale:e,translate:t},r){return r*e[0]+t[0]}function m({scale:e,translate:t},r){return t[1]-r*e[1]}function g(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=e.scale;let o=b(e,r[0][0]),a=m(e,r[0][1]);i[0]=t(r[0],o,a);for(let c=1;c<r.length;c++){const e=r[c];o+=e[0]*n,a-=e[1]*s,i[c]=t(e,o,a)}return i}function v(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=g(e,t,r[n]);return i}function O(e,t,r,i){return g(e,r?i?a:o:i?o:s,t)}function j(e,t,r,i){return v(e,r?i?a:o:i?o:s,t)}function y(e,t,r,i){return v(e,r?i?a:o:i?o:s,t)}function x(e,t,r,i,n){return t.xmin=l(e,r.xmin),t.ymin=d(e,r.ymin),t.xmax=l(e,r.xmax),t.ymax=d(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function _(e,t,r,i,n){return t.points=h(e,r.points,i,n),t}function w(e,t,r,i,n){return t.x=l(e,r.x),t.y=d(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function S(e,t,r,i,n){const s=p(e,r.rings,i,n);return s?(t.rings=s,t):null}function C(e,t,r,i,n){const s=f(e,r.paths,i,n);return s?(t.paths=s,t):null}function T(e,t){return e&&t?Object(n["f"])(t)?w(e,{},t,!1,!1):Object(n["h"])(t)?C(e,{},t,!1,!1):Object(n["g"])(t)?S(e,{},t,!1,!1):Object(n["e"])(t)?_(e,{},t,!1,!1):Object(n["d"])(t)?x(e,{},t,!1,!1):null:null}function P(e,t,r,n,s){return Object(i["l"])(r)&&(t.points=O(e,r.points,n,s)),t}function D(e,t,r,n,s){return Object(i["k"])(r)||(t.x=b(e,r.x),t.y=m(e,r.y),t!==r&&(n&&(t.z=r.z),s&&(t.m=r.m))),t}function E(e,t,r,n,s){return Object(i["l"])(r)&&(t.rings=y(e,r.rings,n,s)),t}function R(e,t,r,n,s){return Object(i["l"])(r)&&(t.paths=j(e,r.paths,n,s)),t}},"040b":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){1===t.viewingMode?e.vertex.code.add(i["a"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(i["a"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),1===t.viewingMode?e.vertex.code.add(i["a"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(i["a"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},"0bde":function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r("b2b2"),n=r("ecd7"),s=r("8a44"),o=r("e431"),a=r("0b2d"),c=r("d359"),l=r("d18f"),d=r("f895"),u=r("1153");class h{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),S[0]=null,R.prune(),I.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const r=p.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}p.release(r)}remove(e,t=null){this._objectCount-=e.length;const r=p.acquire();for(const n of e){const e=Object(i["l"])(t)?t:Object(d["b"])(this._objectToBoundingSphere(n),A);y(e[3])?(r.init(this._root),this._remove(n,e,r)):this._degenerateObjects.delete(n)}p.release(r),this._shrink()}update(e,t){if(!y(t[3])&&this._isDegenerate(e))return;const r=C(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const i=Object(l["g"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNode(i,e))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObject(i,e)&&r(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObject(i,e)&&r(e)}),!0})}forEachAlongRayWithVerticalOffset(e,t,r,i){const n=Object(l["g"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNodeWithOffset(n,e,i))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)}),!0})}forEach(e){this._forEachNode(this._root,t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r,i=(()=>!0),n=1/0){let s=1/0,a=1/0,l=null;const u=O(e,t),h=o=>{if(--n,!i(o))return;const u=this._objectToBoundingSphere(o);if(!Object(c["e"])(r,u))return;const h=j(e,t,Object(d["e"])(u)),p=h-u[3],f=h+u[3];p<s&&(s=p,a=f,l=o)};return this._forEachNodeDepthOrdered(this._root,i=>{if(n<=0||!Object(c["e"])(r,i.bounds))return!1;if(Object(o["e"])(P,u,i.halfSize),Object(o["f"])(P,P,i.bounds),j(e,t,P)>a)return!1;const s=i.node;return s.terminals.forAll(e=>h(e)),null!==s.residents&&s.residents.forAll(e=>h(e)),!0},e,t),l}forEachInDepthRange(e,t,r,i,n,s,a){let l=-1/0,u=1/0;const h={setRange:e=>{1===r?(l=Math.max(l,e.near),u=Math.min(u,e.far)):(l=Math.max(l,-e.far),u=Math.min(u,-e.near))}};h.setRange(i);const p=j(t,r,e),f=O(t,r),b=O(t,-r),m=e=>{if(!a(e))return;const i=this._objectToBoundingSphere(e),o=Object(d["e"])(i),f=j(t,r,o)-p,b=f-i[3],m=f+i[3];b>u||m<l||!Object(c["e"])(s,i)||n(e,h)};this._forEachNodeDepthOrdered(this._root,e=>{if(!Object(c["e"])(s,e.bounds))return!1;if(Object(o["e"])(P,f,e.halfSize),Object(o["f"])(P,P,e.bounds),j(t,r,P)-p>u)return!1;if(Object(o["e"])(P,b,e.halfSize),Object(o["f"])(P,P,e.bounds),j(t,r,P)-p<l)return!1;const i=e.node;return i.terminals.forAll(e=>m(e)),null!==i.residents&&i.residents.forAll(e=>m(e)),!0},t,r)}forEachNode(e){this._forEachNode(this._root,t=>e(t.node,t.bounds,t.halfSize))}_intersectsNode(e,t){return m(t.bounds,2*-t.halfSize,D),m(t.bounds,2*t.halfSize,E),Object(u["h"])(e.origin,e.direction,D,E)}_intersectsNodeWithOffset(e,t,r){return m(t.bounds,2*-t.halfSize,D),m(t.bounds,2*t.halfSize,E),r.applyToMinMax(D,E),Object(u["h"])(e.origin,e.direction,D,E)}_intersectsObject(e,t){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(d["f"])(r,e)}_intersectsObjectWithOffset(e,t,r){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(d["f"])(r.applyToBoundingSphere(i),e)}_forEachNode(e,t){let r=p.acquire().init(e);const i=[r];for(;0!==i.length;){if(r=i.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&i.push(p.acquire().init(r).advance(e));p.release(r)}}_forEachNodeDepthOrdered(e,t,r,i=1){let n=p.acquire().init(e);const s=[n];for(v(r,i,U);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=U[e];n.node.children[t]&&s.push(p.acquire().init(n).advance(t))}p.release(n)}}_remove(e,t,r){R.clear();const i=r.advanceTo(t,(e,t)=>{R.push(e.node),R.push(t)})?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(let n=R.length-2;n>=0;n-=2){const e=R.data[n],t=R.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new s["a"]({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const i=p.acquire().init(e);this._add(t.getItemAt(r),i),p.release(i)}}_grow(e,t){if(0!==t&&(g(e,t,e=>this._objectToBoundingSphere(e),z),y(z[3])&&!this._fitsInsideTree(z)))if(this._nodeIsEmpty(this._root.node))Object(d["b"])(z,this._root.bounds),this._root.halfSize=1.25*z[3];else{const e=this._rootBoundsForRootAsSubNode(z);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(z,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){Object(o["k"])(M,t.bounds),M[3]=t.halfSize,g([e,M],2,e=>e,L);const r=p.acquire().init(this._root);this._root.initFrom(null,L,1.25*L[3]),this._forEachNode(r,e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0)),p.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth)),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let i=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let o=0;o<3;o++){const e=n[o]-s-(r[o]-t),a=r[o]+t-(n[o]+s),c=Math.max(0,Math.ceil(e/(2*s))),l=Math.max(0,Math.ceil(a/(2*s)))+1,d=2**Math.ceil(Math.log(c+l)*Math.LOG2E);i=Math.max(i,d),F[o].min=c,F[o].max=l}for(let o=0;o<3;o++){let e=F[o].min,t=F[o].max;const r=(i-(e+t))/2;e+=Math.ceil(r),t+=Math.floor(r);const a=n[o]-s-e*s*2;T[o]=a+(t+e)*s}return T[3]=i*s*w,p.acquire().initFrom(null,T,i*s,0)}_growRootAsSubNode(e){const t=this._root.node;Object(o["k"])(z,this._root.bounds),z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,i=0;for(;i<t.length&&null==e;)r=i++,e=t[r];for(;i<t.length;)if(t[i++])return-1;return r}_isDegenerate(e){return!y(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}}class p{constructor(){this.bounds=Object(d["c"])(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r,n=this.depth){return this.node=Object(i["l"])(e)?e:p.createEmptyNode(),Object(i["l"])(t)&&Object(d["b"])(t,this.bounds),this.halfSize=r,this.depth=n,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=x[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*w,this}advanceTo(e,t,r=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new s["a"]({shrink:!0}),residents:new s["a"]({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function f(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function b(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function m(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function g(e,t,r,i){if(1===t){const t=r(e[0]);Object(d["b"])(t,i)}else{D[0]=1/0,D[1]=1/0,D[2]=1/0,E[0]=-1/0,E[1]=-1/0,E[2]=-1/0;for(let i=0;i<t;i++){const t=r(e[i]);y(t[3])&&(f(D,t),b(E,t))}Object(o["i"])(i,D,E,.5),i[3]=Math.max(E[0]-D[0],E[1]-D[1],E[2]-D[2])/2}}function v(e,t,r){if(!I.length)for(let i=0;i<8;++i)I.push({index:0,distance:0});for(let i=0;i<8;++i){const r=x[i];I.data[i].index=i,I.data[i].distance=j(e,t,r)}I.sort((e,t)=>e.distance-t.distance);for(let i=0;i<8;++i)r[i]=I.data[i].index}function O(e,t){let r=1/0,i=null;for(let n=0;n<8;++n){const s=j(e,t,_[n]);s<r&&(r=s,i=_[n])}return i}function j(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function y(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new n["a"](p);const x=[Object(a["h"])(-1,-1,-1),Object(a["h"])(1,-1,-1),Object(a["h"])(-1,1,-1),Object(a["h"])(1,1,-1),Object(a["h"])(-1,-1,1),Object(a["h"])(1,-1,1),Object(a["h"])(-1,1,1),Object(a["h"])(1,1,1)],_=[Object(a["h"])(-1,-1,-1),Object(a["h"])(-1,-1,1),Object(a["h"])(-1,1,-1),Object(a["h"])(-1,1,1),Object(a["h"])(1,-1,-1),Object(a["h"])(1,-1,1),Object(a["h"])(1,1,-1),Object(a["h"])(1,1,1)],w=Math.sqrt(3),S=[null];function C(e){return S[0]=e,S}const T=Object(d["c"])(),P=Object(a["f"])(),D=Object(a["f"])(),E=Object(a["f"])(),R=new s["a"],A=Object(d["c"])(),z=Object(d["c"])(),M=Object(d["c"])(),L=Object(d["c"])(),F=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=new s["a"],U=[0,0,0,0,0,0,0,0]},"0cb9":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o}));var i=r("b2b2"),n=r("84f4");class s{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}}function o(e){return"array"in e}function a(e,t,r="ground"){if(Object(n["a"])(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(o(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(i["u"])(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},"0d96":function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return j}));var i=r("3349"),n=r("02f1"),s=r("0fc4"),o=r("d272"),a=r("7c1d"),c=r("d0cb"),l=r("7079"),d=r("6a07"),u=r("be24"),h=r("ebd5"),p=r("4377"),f=r("501b"),b=r("2f98"),m=r("3886"),g=r("690a");function v(e){const t=new g["a"],r=e.signedDistanceFieldEnabled;if(t.include(a["a"]),t.include(c["a"],e),t.include(o["a"],e),6===e.output)return t.include(l["a"],e),t;t.include(b["a"]),t.fragment.include(f["a"]),t.fragment.include(p["a"]),t.include(u["a"],e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m["a"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?m["a"]`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:m["a"]`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const i=m["a"]`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,n=e.pixelSnappingEnabled?r?m["a"]`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:m["a"]`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:m["a"]`posProj += quadOffset;`;t.vertex.code.add(m["a"]`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${i}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${m["a"].float(h["c"])};
      ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${m["a"].float(h["c"])};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${n}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?m["a"]`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const s=e.debugDrawBorder?m["a"]`(isBorder > 0.0 ? 0.0 : ${m["a"].float(h["b"])})`:m["a"].float(h["b"]),v=m["a"]`
    ${e.debugDrawBorder?m["a"]`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?m["a"]`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${s} ||
          fillPixelColor.a + outlinePixelColor.a < ${m["a"].float(h["c"])}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${s}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:m["a"]`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${s}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?m["a"]`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(m["a"]`
      void main() {
        ${v}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(m["a"]`
    void main() {
      ${v}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(d["a"]),t.fragment.code.add(m["a"]`
    void main() {
      ${v}
      ${e.binaryHighlightOcclusionEnabled?m["a"]`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function O(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",s["b"]),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",j(t))}function j(e,t=x){return e.textureIsSignedDistanceField?y(e.anchorPos,e.distanceFieldBoundingBox,t):Object(i["c"])(t,e.anchorPos),t}function y(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}const x=Object(n["a"])(),_=Object.freeze({__proto__:null,build:v,bindHUDMaterialUniforms:O,calculateAnchorPosForRendering:j})},"0d9f":function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return ie})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return L})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return z})),r.d(t,"g",(function(){return S})),r.d(t,"h",(function(){return C})),r.d(t,"i",(function(){return W})),r.d(t,"j",(function(){return q})),r.d(t,"k",(function(){return x}));r("c120");var i=r("e92d"),n=r("38a4"),s=r("2119"),o=r("d791"),a=r("afe1"),c=r("e431"),l=r("0b2d"),d=r("bd7e"),u=r("7289"),h=r("d18f"),p=r("a1b1"),f=r("7361");const b=i["a"].getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class m{constructor(){this.plane=Object(u["d"])(),this.origin=Object(l["f"])(),this.basis1=Object(l["f"])(),this.basis2=Object(l["f"])()}}function g(e=X){return{plane:Object(u["d"])(e.plane),origin:Object(l["d"])(e.origin),basis1:Object(l["d"])(e.basis1),basis2:Object(l["d"])(e.basis2)}}function v(e,t,r){const i=K.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=Object(u["u"])(0,0,0,0),x(i),i}function O(e,t=g()){return y(e.origin,e.basis1,e.basis2,t)}function j(e,t){Object(c["k"])(t.origin,e.origin),Object(c["k"])(t.basis1,e.basis1),Object(c["k"])(t.basis2,e.basis2),Object(u["c"])(e.plane,t.plane)}function y(e,t,r,i=g()){return Object(c["k"])(i.origin,e),Object(c["k"])(i.basis1,t),Object(c["k"])(i.basis2,r),x(i),$(i,"fromValues()"),i}function x(e){Object(u["i"])(e.basis2,e.basis1,e.origin,e.plane)}function _(e,t,r){e!==r&&O(e,r);const i=Object(c["e"])(f["d"].get(),W(e),t);return Object(c["f"])(r.origin,r.origin,i),r.plane[3]-=t,r}function w(e,t,r){return S(t,r),_(r,I(e,e.origin),r),r}function S(e,t=g()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return Object(c["w"])(t.origin,e[0]+r,e[1]+i,0),Object(c["w"])(t.basis1,r,0,0),Object(c["w"])(t.basis2,0,i,0),Object(u["h"])(0,0,1,0,t.plane),t}function C(e,t,r){return!!Object(u["m"])(e.plane,t,r)&&H(e,r)}function T(e,t,r){if(C(e,t,r))return r;const i=P(e,t,f["d"].get());return Object(c["f"])(r,t.origin,Object(c["e"])(f["d"].get(),t.direction,Object(c["m"])(t.origin,i)/Object(c["p"])(t.direction))),r}function P(e,t,r){const i=Q.get();Z(e,t,i,Q.get());let s=Number.POSITIVE_INFINITY;for(const o of ee){const a=B(e,o,Y.get()),l=f["d"].get();if(Object(u["k"])(i,a,l)){const e=Object(c["v"])(f["d"].get(),t.origin,l),i=Math.abs(Object(n["a"])(Object(c["h"])(t.direction,e)));i<s&&(s=i,Object(c["k"])(r,l))}}return s===Number.POSITIVE_INFINITY?D(e,t,r):r}function D(e,t,r){if(C(e,t,r))return r;const i=Q.get(),n=Q.get();Z(e,t,i,n);let s=Number.POSITIVE_INFINITY;for(const o of ee){const a=B(e,o,Y.get()),l=f["d"].get();if(Object(u["l"])(i,a,l)){const e=Object(h["d"])(t,l);if(!Object(u["o"])(n,l))continue;e<s&&(s=e,Object(c["k"])(r,l))}}return A(e,t.origin)<s&&E(e,t.origin,r),r}function E(e,t,r){const i=Object(u["r"])(e.plane,t,f["d"].get()),n=Object(d["i"])(k(e,e.basis1),i,-1,1,f["d"].get()),s=Object(d["i"])(k(e,e.basis2),i,-1,1,f["d"].get());return Object(c["j"])(r,Object(c["f"])(f["d"].get(),n,s),e.origin),r}function R(e,t,r){const{origin:i,basis1:n,basis2:s}=e,o=Object(c["j"])(f["d"].get(),t,i),a=Object(p["d"])(n,o),l=Object(p["d"])(s,o),d=Object(p["d"])(W(e),o);return Object(c["w"])(r,a,l,d)}function A(e,t){const r=R(e,t,f["d"].get()),{basis1:i,basis2:n}=e,s=Object(c["p"])(i),o=Object(c["p"])(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),d=r[2];return a*a+l*l+d*d}function z(e,t){return Math.sqrt(A(e,t))}function M(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of ee){const n=B(e,i,Y.get()),s=Object(d["e"])(n,t);s>r&&(r=s)}return Math.sqrt(r)}function L(e,t){return Object(u["o"])(e.plane,t)&&H(e,t)}function F(e,t,r,i){return G(e,r,i)}function I(e,t){const r=-e.plane[3];return Object(p["d"])(W(e),t)-r}function U(e,t,r,i){const n=I(e,t),s=Object(c["e"])(J,W(e),r-n);return Object(c["f"])(i,t,s),i}function V(e,t){return Object(c["o"])(e.basis1,t.basis1)&&Object(c["o"])(e.basis2,t.basis2)&&Object(c["o"])(e.origin,t.origin)}function N(e,t,r){return e!==r&&O(e,r),Object(o["c"])(te,t),Object(o["t"])(te,te),Object(c["q"])(r.basis1,e.basis1,te),Object(c["q"])(r.basis2,e.basis2,te),Object(c["q"])(Object(u["q"])(r.plane),Object(u["q"])(e.plane),te),Object(c["q"])(r.origin,e.origin,t),Object(u["s"])(r.plane,r.origin,r.plane),r}function q(e,t,r,i){return e!==i&&O(e,i),Object(o["f"])(re,Object(o["j"])(re),t,r),Object(c["q"])(i.basis1,e.basis1,re),Object(c["q"])(i.basis2,e.basis2,re),x(i),i}function W(e){return Object(u["q"])(e.plane)}function G(e,t,r){switch(t){case 0:Object(c["k"])(r,e.basis1),Object(c["r"])(r,r);break;case 1:Object(c["k"])(r,e.basis2),Object(c["r"])(r,r);break;case 2:Object(c["k"])(r,W(e))}return r}function H(e,t){const r=Object(c["j"])(f["d"].get(),t,e.origin),i=Object(c["t"])(e.basis1),n=Object(c["t"])(e.basis2),s=Object(c["h"])(e.basis1,r),o=Object(c["h"])(e.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function k(e,t){const r=Y.get();return Object(c["k"])(r.origin,e.origin),Object(c["k"])(r.vector,t),r}function B(e,t,r){const{basis1:i,basis2:n,origin:s}=e,o=Object(c["e"])(f["d"].get(),i,t.origin[0]),a=Object(c["e"])(f["d"].get(),n,t.origin[1]);Object(c["f"])(r.origin,o,a),Object(c["f"])(r.origin,r.origin,s);const l=Object(c["e"])(f["d"].get(),i,t.direction[0]),d=Object(c["e"])(f["d"].get(),n,t.direction[1]);return Object(c["e"])(r.vector,Object(c["f"])(l,l,d),2),r}function $(e,t){Math.abs(Object(c["h"])(e.basis1,e.basis2)/(Object(c["p"])(e.basis1)*Object(c["p"])(e.basis2)))>1e-6&&b.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c["h"])(e.basis1,W(e)))>1e-6&&b.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c["h"])(W(e),e.origin)-e.plane[3])>1e-6&&b.warn(t,"Plane offset is not consistent with plane origin")}function Z(e,t,r,i){const n=W(e);Object(u["i"])(n,t.direction,t.origin,r),Object(u["i"])(Object(u["q"])(r),n,t.origin,i)}const X={plane:Object(u["d"])(),origin:Object(l["h"])(0,0,0),basis1:Object(l["h"])(1,0,0),basis2:Object(l["h"])(0,1,0)},Q=new s["a"](u["d"]),Y=new s["a"](d["d"]),J=Object(l["f"])(),K=new s["a"](()=>({origin:null,basis1:null,basis2:null,plane:null})),ee=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],te=Object(a["d"])(),re=Object(a["d"])(),ie=Object.freeze({__proto__:null,BoundedPlaneClass:m,create:g,wrap:v,copy:O,copyWithoutVerify:j,fromValues:y,updateUnboundedPlane:x,elevate:_,setExtent:w,fromAABoundingRect:S,intersectRay:C,intersectRayClosestSilhouette:T,closestPointOnSilhouette:P,closestPoint:D,projectPoint:E,projectPointLocal:R,distance2:A,distance:z,distanceToSilhouette:M,extrusionContainsPoint:L,axisAt:F,altitudeAt:I,setAltitudeAt:U,equals:V,transform:N,rotate:q,normal:W,UP:X})},"0eb9":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r("b2b2"),n=r("8076"),s=r("e9d6");class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n["a"])(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=Object(s["d"])(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n["c"])(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(i["u"])(e.offset,0)}updateFeatureExpressionInfoContext(e,t,r){if(Object(i["k"])(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(i["l"])(t)&&Object(i["l"])(r)?(this._featureExpressionInfoContext=Object(s["a"])(e),Object(s["f"])(this._featureExpressionInfoContext,Object(s["c"])(n.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return Object(i["l"])(e)&&t.setFromElevationInfo(e),t}}},1666:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o}));var i=r("9812"),n=r("32ed"),s=r("8c4b");function o(e){const t=c(e.rings,e.hasZ,1),r=[];let n=0,o=0;for(const s of t.polygons){const e=s.count,a=s.index,c=new Float64Array(t.position.buffer,3*a*t.position.BYTES_PER_ELEMENT,3*e),l=s.holeIndices.map(e=>e-a),d=new Uint32Array(Object(i["a"])(c,l,3));r.push({position:c,faces:d}),n+=c.length,o+=d.length}const l=a(r,n,o),d=Object(s["a"])(l.position.buffer,6,{originalIndices:l.faces});return l.position=new Float64Array(d.buffer),l.faces=d.indices,l}function a(e,t,r){if(1===e.length)return e[0];const i=new Float64Array(t),n=new Uint32Array(r);let s=0,o=0,a=0;for(const c of e){for(let e=0;e<c.position.length;e++)i[s++]=c.position[e];for(let e=0;e<c.faces.length;e++)n[o++]=c.faces[e]+a;a=s/3}return{position:i,faces:n}}function c(e,t,r){const i=e.length,n=new Array(i),s=new Array(i),o=new Array(i);let a=0,c=0,u=0,h=0;for(let l=0;l<i;++l)h+=e[l].length;const p=new Float64Array(3*h);let f=0;for(let b=i-1;b>=0;b--){const h=e[b],m=1===r&&d(h);if(m&&1!==i)n[a++]=h;else{let e=h.length;for(let t=0;t<a;++t)e+=n[t].length;const r={index:f,pathLengths:new Array(a+1),count:e,holeIndices:new Array(a)};r.pathLengths[0]=h.length,h.length>0&&(o[u++]={index:f,count:h.length}),f=m?l(h,h.length-1,-1,p,f,h.length,t):l(h,0,1,p,f,h.length,t);for(let i=0;i<a;++i){const e=n[i];r.holeIndices[i]=f,r.pathLengths[i+1]=e.length,e.length>0&&(o[u++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}a=0,r.count>0&&(s[c++]=r)}}for(let d=0;d<a;++d){const e=n[d];e.length>0&&(o[u++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}return c<i&&(s.length=c),u<i&&(o.length=u),{position:p,polygons:s,outlines:o}}function l(e,t,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const s=e[t];i[n++]=s[0],i[n++]=s[1],i[n++]=o?s[2]:0,t+=r}return n/3}function d(e){return!Object(n["g"])(e,!1,!1)}},"171c":function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var i=r("e92d"),n=r("38a4"),s=r("b2b2"),o=r("a915"),a=r("d791"),c=r("afe1"),l=r("3349"),d=r("02f1"),u=r("e431"),h=r("0b2d"),p=r("7577"),f=r("0fc4"),b=r("d359"),m=r("d18f"),g=r("a1b1"),v=r("1153");const O=i["a"].getLogger("esri.views.3d.webgl-engine.lib.Camera");class j{constructor(e=null,t=null,r=null){this._viewUp=Object(h["f"])(),this._viewForward=Object(h["f"])(),this._viewRight=Object(h["f"])(),this._ray=Object(m["c"])(),this._viewport=Object(f["g"])(0,0,1,1),this._padding=Object(f["g"])(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d["e"])(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c["d"])(),this._projectionDirty=!0,this._projectionMatrix=Object(c["d"])(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c["d"])(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c["d"])(),this._frustumDirty=!0,this._frustum=Object(b["b"])(),this._fullViewport=Object(f["e"])(),this.pixelRatio=1,this.relativeElevation=0,Object(s["l"])(e)&&Object(u["k"])(this._ray.origin,e),this._center=Object(s["l"])(t)?Object(h["d"])(t):Object(h["f"])(),this._up=Object(s["l"])(r)?Object(h["d"])(r):Object(h["h"])(0,0,1)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(u["j"])(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(a["d"])(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(p["c"])(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(a["n"])(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;Object(a["i"])(this._projectionMatrix,-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(a["d"])(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(v["b"])(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(v["d"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(v["c"])(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(v["e"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(u["m"])(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(a["c"])(this._viewInverseTransposeMatrix,this.viewMatrix),Object(a["t"])(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(u["k"])(this._ray.origin,e.eye),Object(u["k"])(this._center,e.center),Object(u["k"])(this._up,e.up),Object(p["c"])(this._viewport,e.viewport),Object(p["c"])(this._padding,e.padding),Object(l["c"])(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(a["d"])(this._viewMatrix,e.viewMatrix),Object(u["k"])(this._viewRight,e.viewRight),Object(u["k"])(this._viewUp,e.viewUp),Object(u["k"])(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(a["d"])(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(b["a"])(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(a["d"])(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p["c"])(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new j).copyFrom(this)}equals(e){return Object(u["o"])(this.eye,e.eye)&&Object(u["o"])(this._center,e.center)&&Object(u["o"])(this._up,e.up)&&Object(p["g"])(this._viewport,e.viewport)&&Object(p["g"])(this._padding,e.padding)&&Object(l["e"])(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4,r=1-1e-10;Object(u["z"])(_,e.eye,e.center),Object(u["z"])(w,this.eye,this._center);const i=Object(u["h"])(_,w),n=Object(u["A"])(_),s=Object(u["A"])(w);return i*i>=r*n*s&&Object(u["B"])(e.eye,this.eye)<Math.max(n,s)*t*t&&Object(p["i"])(e.padding,this._padding)<.5&&Object(p["i"])(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(g["d"])(this.viewForward,Object(u["j"])(_,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(o["f"])()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t,r=!1){e!==y&&Object(u["k"])(y,e),y[3]=1,r&&(t[2]=-y[2]),Object(p["m"])(y,y,this.projectionMatrix),Object(u["e"])(y,y,1/Math.abs(y[3]));const i=this.fullViewport;return t[0]=Object(n["i"])(0,i[0]+i[2],.5+.5*y[0]),t[1]=Object(n["i"])(0,i[1]+i[3],.5+.5*y[1]),r||(t[2]=.5*(y[2]+1)),t}projectToScreen(e,t){this.projectToRenderScreen(e,S),this.renderToScreen(S,t)}projectToRenderScreen(e,t){if(y[0]=e[0],y[1]=e[1],y[2]=e[2],y[3]=1,Object(p["m"])(y,y,this.viewProjectionMatrix),0===y[3])return null;Object(u["e"])(y,y,1/Math.abs(y[3]));const r=this.fullViewport;return"x"in t?(t.x=Object(n["i"])(0,r[0]+r[2],.5+.5*y[0]),t.y=Object(n["i"])(0,r[1]+r[3],.5+.5*y[1])):(t[0]=Object(n["i"])(0,r[0]+r[2],.5+.5*y[0]),t[1]=Object(n["i"])(0,r[1]+r[3],.5+.5*y[1]),t.length>2&&(t[2]=.5*(y[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,S),t)}unprojectFromRenderScreen(e,t){if(Object(a["n"])(x,this.projectionMatrix,this.viewMatrix),!Object(a["c"])(x,x))return null;const r=this.fullViewport;return y[0]=2*(e[0]-r[0])/r[2]-1,y[1]=2*(e[1]-r[1])/r[3]-1,y[2]=2*e[2]-1,y[3]=1,Object(p["m"])(y,y,x),0===y[3]?null:(t[0]=y[0]/y[3],t[1]=y[1]/y[3],t[2]=y[2]/y[3],t)}constrainWindowSize(e,t,r,i=r){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),c=-Math.min(n-r/2,0),l=-Math.min(this.fullHeight-s-i/2,0);return[o,a,r-c- -Math.min(this.fullWidth-n-r/2,0),i-l- -Math.min(s-i/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}computeUpGlobal(){Object(u["j"])(_,this.center,this.eye);const e=Object(u["p"])(this.center);e<1?(Object(u["w"])(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(u["h"])(_,this.center))>.9999*Object(u["p"])(_)*e||(Object(u["g"])(this._up,_,this.center),Object(u["g"])(this._up,this._up,_),Object(u["r"])(this._up,this._up),this._markViewDirty())}computeUpLocal(){Object(u["v"])(_,this.eye,this.center),Math.abs(_[2])<=.9999&&(Object(u["e"])(_,_,_[2]),Object(u["w"])(this._up,-_[0],-_[1],1-_[2]),Object(u["r"])(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(u["o"])(e,t)||(Object(u["k"])(t,e),this._markViewDirty()):O.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(b["c"])(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(a["m"])(this._viewMatrix,this.eye,this._center,this._up),Object(u["w"])(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(u["w"])(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(u["w"])(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const y=Object(f["e"])(),x=Object(c["d"])(),_=Object(h["f"])(),w=Object(h["f"])(),S=Object(o["d"])()},1962:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f}));var i=r("d272"),n=r("4db9"),s=r("6d5b"),o=r("c2d1"),a=r("6a07"),c=r("d047"),l=r("c6d7"),d=r("ebd5"),u=r("4377"),h=r("3886"),p=r("690a");function f(e){const t=new p["a"],r=1===e.output;return t.include(n["a"],{linearDepth:r}),t.include(s["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r&&(t.include(o["a"],e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(h["a"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${r?h["a"]`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:h["a"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(i["a"],e),t.fragment.include(u["a"]),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(l["b"],e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(a["a"]),t.fragment.code.add(h["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${h["a"].float(d["c"])}) {
      discard;
    }

    ${7===e.output?h["a"]`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?h["a"]`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?h["a"]`outputHighlight();`:""};
    ${1===e.output?h["a"]`outputDepth(linearDepth);`:""};
  }
  `),t}const b=Object.freeze({__proto__:null,build:f})},"1a54":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return d}));r("f0b9"),r("c120");var i=r("b2b2"),n=(r("a21b"),r("f2e0"),r("5996"),r("4261")),s=r("9180");r("008c"),r("74e2"),r("a1f3"),r("3563");class o{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function a(e){return Object(i["l"])(e.geometry)}class c{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function d(e){if(Object(i["k"])(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function u(e,t){switch(Object(n["h"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)Object(n["l"])(t,e.paths[r],e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)Object(n["l"])(t,e.rings[r],e.hasZ);break;case"multipoint":Object(n["l"])(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function h(e,t){switch(Object(s["m"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)Object(s["p"])(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)Object(s["p"])(t,e.rings[r]);break;case"multipoint":Object(s["p"])(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(n["f"])(),Object(s["l"])()},"1f93":function(e,t,r){"use strict";r.d(t,"a",(function(){return R}));var i=r("b2b2"),n=r("b0ea");class s{constructor(){this.enabled=!0,this._time=0}get time(){return Object(n["a"])(this._time)}advance(e){return Object(i["l"])(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}var o=r("b061"),a=r("35b3"),c=r("7438"),l=r("d7f7"),d=r("a4ee"),u=r("d272"),h=r("6a07"),p=r("c6d7"),f=r("d017"),b=r("df77"),m=r("33e2"),g=r("8e97"),v=r("c3a4"),O=r("ca98"),j=r("da35"),y=r("fa1e"),x=r("c829"),_=r("ea44"),w=r("189c");class S extends O["a"]{constructor(e,t,r){super(e,t,r),this._textureRepository=e.waterTextureRepository}initializeProgram(e){const t=S.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,highStepCount:!0,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new x["a"](e.rctx,i,y["a"])}bindPass(e,t){Object(g["c"])(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(p["a"])(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(b["b"])(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(m["b"])(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(h["b"])(this.program,t)}bindDraw(e){Object(g["d"])(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(g["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(f["b"])(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(u["c"])(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e;return Object(w["f"])({blending:2!==t.output&&4!==t.output&&t.transparent?r?c["g"]:Object(c["a"])(e):null,depthTest:{func:Object(c["b"])(e)},depthWrite:r?t.writeDepth&&w["d"]:Object(c["c"])(e),colorWrite:w["c"],polygonOffset:r||i?null:Object(c["h"])(t.enableOffset)})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}S.shader=new v["a"](_["a"],()=>r.e("chunk-2d0a5169").then(r.bind(null,"08e0")));class C extends j["a"]{constructor(){super(...arguments),this.output=0,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(d["a"])([Object(j["b"])({count:8})],C.prototype,"output",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"receiveShadows",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"slicePlaneEnabled",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"transparent",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"enableOffset",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"writeDepth",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"useSSR",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"isDraped",void 0),Object(d["a"])([Object(j["b"])({count:4})],C.prototype,"transparencyPassType",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"multipassTerrainEnabled",void 0),Object(d["a"])([Object(j["b"])()],C.prototype,"cullAboveGround",void 0);class T extends l["a"]{updateParameters(e){return this.ensureTechnique(S,e)}setElapsedTimeUniform(e){const t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.parameters.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:e.ssrEnabled})}ensureResources(e){const t=this._techniqueRep.constructionContext.waterTextureRepository;return t.ready||t.updating||t.loadTextures(e),t.ready?2:1}beginSlot(e){return 0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(t.program)}}var P=r("8675"),D=r("7c51"),E=r("b855");class R extends a["a"]{constructor(e){super(e,E["a"]),this._techniqueConfig=new C,this.animation=new s}getTechniqueConfig(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<c["e"],this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<A;const r=this.animation.advance(e);return this.animation.enabled&&r}intersect(e,t,r,i,n,s,o){Object(D["f"])(e,t,i,n,s,void 0,o)}requiresSlot(e,t){switch(Object(o["b"])(t)){case 2:return 21===e;case 0:if(this.parameters.isDraped)return 20===e;break;case 4:return 2===e||20===e}let r=2;return this.parameters.transparent&&(r=this.parameters.writeDepth?4:7),e===r}createGLMaterial(e){if(0===e.output&&this.parameters.isDraped)return e.output=5,new T(e);switch(e.output){case 0:case 2:case 4:case 7:return new T(e)}return null}createBufferWriter(){return new P["a"](P["d"])}}const A=35e3},"2aad":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(i["a"]`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},"2df1":function(e,t,r){"use strict";r.d(t,"a",(function(){return Q}));var i=r("38a4"),n=r("b2b2"),s=r("a915"),o=r("1c92"),a=r("dae5"),c=r("d791"),l=r("afe1"),d=r("3349"),u=r("02f1"),h=r("e431"),p=r("0b2d");function f(e){return e instanceof Float32Array&&e.length>=16}function b(e){return Array.isArray(e)&&e.length>=16}function m(e){return f(e)||b(e)}var g=r("9180"),v=r("fc00"),O=r("1038"),j=r("b061"),y=r("68af"),x=r("35b3"),_=r("da1c"),w=r("1153"),S=r("5957"),C=r("7c51"),T=r("b623"),P=r("0d96"),D=r("a4ee"),E=r("d272"),R=r("17b0"),A=r("d0cb"),z=r("6a07"),M=r("9617"),L=r("c6d7"),F=r("be24"),I=r("2f98"),U=r("8e97"),V=r("c3a4"),N=r("ca98"),q=r("da35"),W=r("fa1e"),G=r("7438"),H=r("c829"),k=r("189c");class B extends N["a"]{initializeProgram(e){const t=B.shader.get(),r=this.configuration,i=t.build({output:r.output,FrontFacePass:2===r.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:r.debugDrawBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,pixelSnappingEnabled:r.pixelSnappingEnabled,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1,isDraped:r.isDraped,multipassGeometryEnabled:r.multipassGeometryEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new H["a"](e.rctx,i,W["a"])}bindPass(e,t){Object(U["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(R["b"])(this.program,e,t),Object(I["b"])(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(U["f"])(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(M["a"])(this.program,t),Object(L["a"])(this.program,t)):(Object(A["b"])(this.program,t),Object(P["c"])(this.program,e,t.camera.pixelRatio||1),Object(F["b"])(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(z["b"])(this.program,t)}bindDraw(e){Object(U["d"])(this.program,e),Object(U["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(E["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e,n=515,s=this.configuration.polygonOffsetEnabled&&$,o=(r||i)&&4!==t.output?(t.depthEnabled||6===t.output)&&k["d"]:null;return Object(k["f"])({blending:0===t.output||7===t.output||4===t.output?r?Z:Object(G["a"])(e):null,depthTest:{func:n},depthWrite:o,colorWrite:k["c"],polygonOffset:s})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}B.shader=new V["a"](P["a"],()=>r.e("chunk-2d0db7d8").then(r.bind(null,"6fa3")));const $={factor:0,units:-4},Z=Object(k["h"])(1,771);class X extends q["a"]{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!1,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(D["a"])([Object(q["b"])({count:8})],X.prototype,"output",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"occlusionTestEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"sdf",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"vvSize",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"vvColor",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"verticalOffset",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"screenSizePerspective",void 0),Object(D["a"])([Object(q["b"])({count:2})],X.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"debugDrawBorder",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"binaryHighlightOcclusion",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"slicePlaneEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"polygonOffsetEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"depthEnabled",void 0),Object(D["a"])([Object(q["b"])({count:4})],X.prototype,"transparencyPassType",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"pixelSnappingEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"isDraped",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"multipassGeometryEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"multipassTerrainEnabled",void 0),Object(D["a"])([Object(q["b"])()],X.prototype,"cullAboveGround",void 0);class Q extends x["a"]{constructor(e){super(e,Oe),this.techniqueConfig=new X}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.parameters.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,s,o,a,c,l){Object(n["l"])(l)?this.intersectDrapedHudGeometry(e,o,a,c,l):this.intersectHudGeometry(e,t,r,i,a,c)}intersectDrapedHudGeometry(e,t,r,i,s){const o=e.vertexAttributes.get("position"),a=e.vertexAttributes.get("size"),c=this.parameters,l=Object(P["d"])(c);let d=1,u=1;if(Object(n["l"])(i)){const e=i(fe);d=e[0],u=e[5]}d*=e.screenToWorldRatio,u*=e.screenToWorldRatio;const h=me*e.screenToWorldRatio;for(let n=0;n<o.data.length/o.size;n++){const i=n*o.size,p=o.data[i],f=o.data[i+1],b=n*a.size;let m;ge[0]=a.data[b]*d,ge[1]=a.data[b+1]*u,c.textureIsSignedDistanceField&&(m=c.outlineSize*e.screenToWorldRatio/2),te(t,p,f,ge,h,m,c,l)&&r(s.dist,s.normal,-1,!0)}}intersectHudGeometry(e,t,r,i,s,a){if(!i.options.selectionMode||!i.options.hud||Object(T["d"])(t))return;const l=this.parameters;let d=1,u=1;if(Object(o["f"])(le,r),Object(n["l"])(a)){const e=a(fe);d=e[0],u=e[5],ee(le)}const f=e.vertexAttributes.get("position"),b=e.vertexAttributes.get("size"),m=e.vertexAttributes.get("normal"),g=e.vertexAttributes.get("auxpos1");Object(w["a"])(f.size>=3);const v=i.point,O=i.camera,j=Object(P["d"])(l);d*=O.pixelRatio,u*=O.pixelRatio;const y="screen"===this.parameters.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(h["w"])(ne,f.data[e],f.data[e+1],f.data[e+2]),Object(h["q"])(ne,ne,r);const t=n*b.size;ge[0]=b.data[t]*d,ge[1]=b.data[t+1]*u,Object(h["q"])(ne,ne,O.viewMatrix);const o=n*g.size;if(Object(h["w"])(he,g.data[o+0],g.data[o+1],g.data[o+2]),!y&&(ne[0]+=he[0],ne[1]+=he[1],0!==he[2])){const e=he[2];Object(h["r"])(he,ne),Object(h["j"])(ne,ne,Object(h["e"])(he,he,e))}const a=n*m.size;if(Object(h["w"])(se,m.data[a],m.data[a+1],m.data[a+2]),this.normalAndViewAngle(se,le,O,pe),this.applyVerticalOffsetTransformationView(ne,pe,O,re),O.applyProjection(ne,oe),oe[0]>-1){let e=Math.floor(oe[0])+this.parameters.screenOffset[0],t=Math.floor(oe[1])+this.parameters.screenOffset[1];y&&(e+=he[0],0!==he[1]&&(t+=Object(_["b"])(he[1],re.factorAlignment))),Object(_["a"])(ge,re.factor,ge);const r=be*O.pixelRatio;let n;if(l.textureIsSignedDistanceField&&(n=l.outlineSize*O.pixelRatio/2),te(v,e,t,ge,r,n,l,j)){const e=i.ray;if(Object(h["q"])(ce,ne,Object(c["c"])(ue,O.viewMatrix)),oe[0]=v[0],oe[1]=v[1],O.unprojectFromRenderScreen(oe,ne)){const t=Object(p["f"])();Object(h["k"])(t,e.direction);const r=1/Object(h["p"])(t);Object(h["e"])(t,t,r),s(Object(h["m"])(e.origin,ne)*r,t,-1,!0,1,ce)}}}}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const i=r.get("position"),n=e.indices.get("position");return Object(O["b"])(i,n,t)}createBufferWriter(){return new ye(this)}normalAndViewAngle(e,t,r,i){return m(t)&&(t=Object(o["f"])(de,t)),Object(h["x"])(i.normal,e,t),Object(h["q"])(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=Object(h["h"])(ae,ve),i}updateScaleInfo(e,t,r){const i=this.parameters;i.screenSizePerspective?Object(_["c"])(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?Object(_["c"])(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,r,i,n,s,o){const a=this.normalAndViewAngle(t,r,n,pe);return this.applyVerticalGroundOffsetView(e,a,n,o),this.applyVerticalOffsetTransformationView(o,a,n,s),this.applyPolygonOffsetView(o,a,i[3],n,o),this.applyCenterOffsetView(o,i,o),o}applyShaderOffsetsNDC(e,t,r,i,s){return this.applyCenterOffsetNDC(e,t,r,i),Object(n["l"])(s)&&Object(h["k"])(s,i),this.applyPolygonOffsetNDC(i,t,r,i),i}applyPolygonOffsetView(e,t,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);0===a&&(a=o);const c=o*a;if(this.parameters.shaderPolygonOffset<=0)return Object(h["k"])(s,e);const l=Object(i["d"])(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-l*l)/l/n.viewport[2];return Object(h["e"])(s,e,c>0?d:1/d),s}applyVerticalGroundOffsetView(e,t,r,i){const n=Object(h["p"])(e),s=r.aboveGround?1:-1,o=.5*r.computeRenderPixelSizeAtDist(n),a=Object(h["e"])(ne,t.normal,s*o);return Object(h["f"])(i,e,a),i}applyVerticalOffsetTransformationView(e,t,r,i){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=Object(h["p"])(e);this.updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const s=Object(h["p"])(e),o=n.screenSizePerspectiveAlignment||n.screenSizePerspective,a=Object(C["i"])(r,s,n.verticalOffset,t.cosAngle,o);return this.updateScaleInfo(i,s,t.cosAngle),Object(h["e"])(t.normal,t.normal,a),Object(h["f"])(e,e,t.normal)}applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&Object(h["k"])(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(Object(h["r"])(se,r),Object(h["f"])(r,r,Object(h["e"])(se,se,t[2])))),r}applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&Object(h["k"])(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}applyPolygonOffsetNDC(e,t,r,i){const n=this.parameters.shaderPolygonOffset;if(e!==i&&Object(h["k"])(i,e),n){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*n}return i}requiresSlot(e,t){const r=Object(j["b"])(t);if(0===r||7===r){if(20===e)return!0;const t=this.parameters.drawInSecondSlot?17:16;return this.parameters.occlusionTest&&11===e||e===t}return e===(this.parameters.drawInSecondSlot?17:16)||20===e}createGLMaterial(e){return 0===e.output||7===e.output?new J(e):4===e.output?new Y(e):null}calculateRelativeScreenBounds(e,t,r=Object(g["l"])()){return K(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class Y extends y["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(e)}selectProgram(e){return this.ensureTechnique(B,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}class J extends Y{isOcclusionSlot(e){return 11===e.slot&&this._material.parameters.occlusionTest&&(0===this._output||7===this._output)}selectProgram(e){return this.ensureTechnique(B,e,this.isOcclusionSlot(e)?6:this._output)}bind(e,t){this.isOcclusionSlot(e)||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.parameters,e)}}function K(e,t,r,i=ie){return Object(d["c"])(i,e.anchorPos),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function ee(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],d=1/Math.sqrt(t*t+r*r+i*i),u=1/Math.sqrt(n*n+s*s+o*o),h=1/Math.sqrt(a*a+c*c+l*l);return e[0]=t*d,e[1]=r*d,e[2]=i*d,e[3]=n*u,e[4]=s*u,e[5]=o*u,e[6]=a*h,e[7]=c*h,e[8]=l*h,e}function te(e,t,r,i,n,s,o,a){let c=t-n-(a[0]>0?i[0]*a[0]:0),l=c+i[0]+2*n,d=r-n-(a[1]>0?i[1]*a[1]:0),u=d+i[1]+2*n;if(o.textureIsSignedDistanceField){const e=o.distanceFieldBoundingBox;c+=i[0]*e[0],d+=i[1]*e[1],l-=i[0]*(1-e[2]),u-=i[1]*(1-e[3]),c-=s,l+=s,d-=s,u+=s}return e[0]>c&&e[0]<l&&e[1]>d&&e[1]<u}const re={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ie=Object(u["a"])(),ne=Object(p["f"])(),se=Object(p["f"])(),oe=Object(s["d"])(),ae=Object(p["f"])(),ce=Object(p["f"])(),le=Object(a["b"])(),de=Object(a["b"])(),ue=Object(l["d"])(),he=Object(p["f"])(),pe={normal:ae,cosAngle:0},fe=Object(l["d"])(),be=1,me=2,ge=[0,0],ve=Object(p["h"])(0,0,1),Oe={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(u["e"])(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...x["b"]},je=Object(v["a"])().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class ye{constructor(e){this.material=e,this.vertexBufferLayout=je}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,r,i){Object(S["e"])(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(S["d"])(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6);{const e=t.vertexAttributes.get("uv0").data;let n,s,o,a;if(null==e||e.length<4){const e=this.material.parameters;n=0,s=0,o=e.texCoordScale[0],a=e.texCoordScale[1]}else n=e[0],s=e[1],o=e[2],a=e[3];o=Math.min(1.99999,o+1),a=Math.min(1.99999,a+1);const c=t.indices.get("position").length,l=r.uv0;let d=i;for(let t=0;t<c;++t)l.set(d,0,n),l.set(d,1,s),d+=1,l.set(d,0,o),l.set(d,1,s),d+=1,l.set(d,0,o),l.set(d,1,a),d+=1,l.set(d,0,o),l.set(d,1,a),d+=1,l.set(d,0,n),l.set(d,1,a),d+=1,l.set(d,0,n),l.set(d,1,s),d+=1}Object(S["b"])(t.indices.get("color"),t.vertexAttributes.get("color").data,4,r.color,i,6);{const e=t.indices.get("size"),n=t.vertexAttributes.get("size").data,s=e.length,o=r.size;let a=i;for(let t=0;t<s;++t){const r=n[2*e[t]],i=n[2*e[t]+1];for(let e=0;e<6;++e)o.set(a,0,r),o.set(a,1,i),a+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(S["a"])(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(S["a"])(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,r.auxpos2,i,6)}}},"2e0f":function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return v}));var i,n=r("6c97"),s=r("b2b2"),o=r("d791"),a=r("afe1"),c=r("0b2d"),l=r("8188"),d=r("84f4"),u=r("ba58"),h=r("0cb9");function p(e,t,r,i,n,s,o,a,c,d,u){const h=C[u.mode];let p,f,b=0;if(Object(l["k"])(e,t,r,i,c.spatialReference,n,a))return h.requiresAlignment(u)?(b=h.applyElevationAlignmentBuffer(i,n,s,o,a,c,d,u),p=s,f=o):(p=i,f=n),Object(l["k"])(p,c.spatialReference,f,s,d.spatialReference,o,a)?b:void 0}function f(e,t,r,i,o){const a=(Object(d["a"])(e)?e.z:Object(h["c"])(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=Object(s["u"])(Object(h["b"])(t,e,"ground"),0);return o.verticalDistanceToGround=0,o.sampledElevation=r,void(o.z=r)}case"relative-to-ground":{const n=Object(s["u"])(Object(h["b"])(t,e,"ground"),0),c=r.geometryZWithOffset(a,i);return o.verticalDistanceToGround=c,o.sampledElevation=n,void(o.z=c+n)}case"relative-to-scene":{const n=Object(s["u"])(Object(h["b"])(t,e,"scene"),0),c=r.geometryZWithOffset(a,i);return o.verticalDistanceToGround=c,o.sampledElevation=n,void(o.z=c+n)}case"absolute-height":{const n=r.geometryZWithOffset(a,i),c=Object(s["u"])(Object(h["b"])(t,e,"ground"),0);return o.verticalDistanceToGround=n-c,o.sampledElevation=c,void(o.z=n)}default:return Object(n["a"])(r.mode),void(o.z=0)}}function b(e,t,r,i){return f(e,t,r,i,P),P.z}function m(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?i.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function O(e,t,r,i,n){f(t,r,n,i,P),Object(u["i"])(e,P.verticalDistanceToGround);const s=P.sampledElevation,a=Object(o["d"])(T,e.transformation);return D[0]=t.x,D[1]=t.y,D[2]=P.z,Object(l["c"])(t.spatialReference,D,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function j(e,t,r,i,n,o){let a=0;const c=o.spatialReference;t*=3,i*=3;for(let l=0;l<n;++l){const n=e[t+0],l=e[t+1],d=e[t+2],u=Object(s["u"])(o.getElevation(n,l,d,c,"ground"),0);a+=u,r[i+0]=n,r[i+1]=l,r[i+2]=u,t+=3,i+=3}return a/n}function y(e,t,r,i,n,o,a,c){let l=0;const d=c.calculateOffsetRenderUnits(a),u=c.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const n=e[t+0],a=e[t+1],c=e[t+2],p=Object(s["u"])(o.getElevation(n,a,c,h,"ground"),0);l+=p,r[i+0]=n,r[i+1]=a,r[i+2]=null==u?c+p+d:p+d,t+=3,i+=3}return l/n}function x(e,t,r,i,n,o,a,c){let l=0;const d=c.calculateOffsetRenderUnits(a),u=c.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const n=e[t+0],a=e[t+1],c=e[t+2],p=Object(s["u"])(o.getElevation(n,a,c,h,"scene"),0);l+=p,r[i+0]=n,r[i+1]=a,r[i+2]=null==u?c+p+d:p+d,t+=3,i+=3}return l/n}function _(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}function w(e,t,r,i,n,s,o,a){const c=a.calculateOffsetRenderUnits(o),l=a.featureExpressionInfoContext;t*=3,i*=3;for(let d=0;d<n;++d){const n=e[t+0],s=e[t+1],o=e[t+2];r[i+0]=n,r[i+1]=s,r[i+2]=null==l?o+c:c,t+=3,i+=3}return 0}class S{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(i||(i={}));const C={"absolute-height":{applyElevationAlignmentBuffer:w,requiresAlignment:_},"on-the-ground":{applyElevationAlignmentBuffer:j,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:y,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:x,requiresAlignment:()=>!0}},T=Object(a["d"])(),P=new S,D=Object(c["f"])()},"2ebb":function(e,t,r){"use strict";function i(e,t=0){const r=e.stride;return e.fieldNames.filter(t=>{const r=e.fields.get(t).optional;return!(r&&r.glPadding)}).map(i=>{const s=e.fields.get(i),o=s.constructor.ElementCount,a=n(s.constructor.ElementType),c=s.offset,l=!(!s.optional||!s.optional.glNormalized);return{name:i,stride:r,count:o,type:a,offset:c,normalized:l,divisor:t}})}function n(e){const t=s[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}r.d(t,"a",(function(){return i}));const s={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},"33e2":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var i=r("d981"),n=r("3886");function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(i["b"]),e.fragment.code.add(n["a"]`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function o(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},3544:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var i=r("b2b2");const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},s={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null},o=8;function a(e,t=2){return Object(i["k"])(e)?e:{pattern:e.slice(),pixelRatio:t}}function c(e,t=2){return{pattern:[e,e],pixelRatio:t}}function l(e){return Object(i["l"])(e)&&"style"===e.type?a(s[e.style],o):null}},3563:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("c120"),r("b2b2");function i(e,t){return!!n(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function n(e,t){return e===t||e&&t&&e.equals(t)}},3748:function(e,t,r){"use strict";r.d(t,"a",(function(){return L}));var i=r("e92d"),n=r("b2b2"),s=r("a915"),o=r("3349"),a=r("e431"),c=r("0b2d"),l=r("bd7e"),d=r("7289"),u=r("8190"),h=r("1038"),p=r("d7f7"),f=r("35b3"),b=r("1153"),m=r("5957"),g=r("8675"),v=r("7c51"),O=r("b623"),j=r("a4ee"),y=r("d272"),x=r("6a07"),_=r("8e97"),w=r("c3a4"),S=r("ca98"),C=r("da35"),T=r("fa1e"),P=r("c829"),D=r("87b7"),E=r("713b"),R=r("189c");class A extends S["a"]{constructor(e,t,r){super(e,t,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&4!==this.configuration.output}initializeProgram(e){const t=A.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:r.stipplePreferContinuous});return new P["a"](e.rctx,i,T["a"])}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(_["c"])(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:r,pixels:i}=Object(n["l"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",r),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(n["t"])(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}4===this.configuration.output&&Object(x["b"])(this.program,t)}bindDraw(e){Object(_["d"])(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(_["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(y["c"])(this.program,this.configuration,e),this.program.rebindTextures()}initializePipeline(){const e=this.configuration,t=Object(R["g"])(770,1,771,771),r=(t,r=null,i=null)=>Object(R["f"])({blending:r,depthTest:D["b"],depthWrite:i,colorWrite:R["c"],stencilWrite:e.sceneHasOcludees?D["h"]:null,stencilTest:e.sceneHasOcludees?t?D["d"]:D["c"]:null});return 0===e.output?(this._occludeePipelineState=r(!0,e.transparent||this.stippleEnabled?t:null,R["d"]),r(!1,e.transparent||this.stippleEnabled?t:null,R["d"])):r(!1)}get primitiveType(){return 1}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}A.shader=new w["a"](E["a"],()=>r.e("chunk-2d20f1b1").then(r.bind(null,"b1e1")));class z extends C["a"]{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.sceneHasOcludees=!1}}Object(j["a"])([Object(C["b"])({count:8})],z.prototype,"output",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"slicePlaneEnabled",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"vertexColors",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"transparent",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"draped",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"stippleEnabled",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"stippleOffColorEnabled",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"stipplePreferContinuous",void 0),Object(j["a"])([Object(C["b"])()],z.prototype,"sceneHasOcludees",void 0);const M=i["a"].getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class L extends f["a"]{constructor(e){super(e,U),this._techniqueConfig=new z}getTechniqueConfig(e,t){this._techniqueConfig.output=e,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=20===t.slot;const r=Object(n["l"])(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&Object(n["l"])(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,r,i,s,o,a,c,l){Object(n["l"])(l)?Object(v["e"])(e,i,l,o,1,a):this.intersectLineGeometry(e,t,r,i,a)}intersectLineGeometry(e,t,r,i,n){if(!i.options.selectionMode||Object(O["d"])(t))return;if(!Object(b["g"])(r))return void M.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes.get("position").data,c=i.camera,u=X;Object(o["c"])(u,i.point);const h=2;Object(a["w"])(Q[0],u[0]-h,u[1]+h,0),Object(a["w"])(Q[1],u[0]+h,u[1]+h,0),Object(a["w"])(Q[2],u[0]+h,u[1]-h,0),Object(a["w"])(Q[3],u[0]-h,u[1]-h,0);for(let o=0;o<4;o++)if(!c.unprojectFromRenderScreen(Q[o],Y[o]))return;Object(d["f"])(c.eye,Y[0],Y[1],J),Object(d["f"])(c.eye,Y[1],Y[2],K),Object(d["f"])(c.eye,Y[2],Y[3],ee),Object(d["f"])(c.eye,Y[3],Y[0],te);let p=Number.MAX_VALUE,f=0;for(let o=0;o<s.length-5;o+=3){if(V[0]=s[o]+r[12],V[1]=s[o+1]+r[13],V[2]=s[o+2]+r[14],N[0]=s[o+3]+r[12],N[1]=s[o+4]+r[13],N[2]=s[o+5]+r[14],Object(d["t"])(J,V)<0&&Object(d["t"])(J,N)<0||Object(d["t"])(K,V)<0&&Object(d["t"])(K,N)<0||Object(d["t"])(ee,V)<0&&Object(d["t"])(ee,N)<0||Object(d["t"])(te,V)<0&&Object(d["t"])(te,N)<0)continue;if(c.projectToRenderScreen(V,G),c.projectToRenderScreen(N,H),G[2]<0&&H[2]>0){Object(a["j"])(q,V,N);const e=c.frustum,t=-Object(d["t"])(e[4],V)/Object(a["h"])(q,Object(d["q"])(e[4]));Object(a["e"])(q,q,t),Object(a["f"])(V,V,q),c.projectToRenderScreen(V,G)}else if(G[2]>0&&H[2]<0){Object(a["j"])(q,N,V);const e=c.frustum,t=-Object(d["t"])(e[4],N)/Object(a["h"])(q,Object(d["q"])(e[4]));Object(a["e"])(q,q,t),Object(a["f"])(N,N,q),c.projectToRenderScreen(N,H)}else if(G[2]<0&&H[2]<0)continue;G[2]=0,H[2]=0;const e=Object(l["e"])(Object(l["f"])(G,H,$),u);e<p&&(p=e,Object(a["k"])(k,V),Object(a["k"])(B,N),f=o/3)}const m=i.rayBegin,g=i.rayEnd;if(p<h*h){let e=Number.MAX_VALUE;if(Object(l["a"])(Object(l["f"])(k,B,$),Object(l["f"])(m,g,Z),W)){Object(a["j"])(W,W,m);const t=Object(a["p"])(W);Object(a["e"])(W,W,1/t),e=t/Object(a["m"])(m,g)}n(e,W,f,!1)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const i=r.get("position");return Object(h["a"])(i,null,!1,t)}requiresSlot(e){return 2===e||20===e}createGLMaterial(e){return 0===e.output||4===e.output?new F(e):null}createBufferWriter(){const e=this.parameters.vertexColors?g["b"]:g["c"];return Object(n["k"])(this.parameters.stipplePattern)?new g["a"](e):new I(e.clone().vec3f("auxpos1").vec2f("uv0"))}}class F extends p["a"]{updateParameters(e){return this.ensureTechnique(A,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0===this._output&&this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}class I{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(m["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i),this.writeAuxpos1(e,t,r,i),this.writeUV0(e,t,r,i)}writeAuxpos1(e,t,r,i){const n=r.getField("auxpos1",u["u"]),s=t.indices.get("position"),o=t.vertexAttributes.get("position").data,a=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;i*=c;for(let d=0;d<s.length-1;d+=2)for(const e of[1,0]){const t=3*s[d+e],r=o[t],n=o[t+1],u=o[t+2],h=a[0]*r+a[4]*n+a[8]*u+a[12],p=a[1]*r+a[5]*n+a[9]*u+a[13],f=a[2]*r+a[6]*n+a[10]*u+a[14];l[i]=h,l[i+1]=p,l[i+2]=f,i+=c}}writeUV0(e,t,r,i){var n;const s=r.getField("uv0",u["m"]),o=t.indices.get("position"),c=t.vertexAttributes.get("position").data,l=null==(n=t.vertexAttributes.get("distanceToStart"))?void 0:n.data,d=e.transformation,h=s.typedBufferStride,p=s.typedBuffer;let f=0;p[i*=h]=0,p[i+1]=f,i+=h;const b=3*o[0],m=Object(a["w"])(V,c[b],c[b+1],c[b+2]);d&&Object(a["q"])(m,m,d);const g=N,v=o.length-1;let O=1;const j=l?(e,t,r)=>f=l[r]:(e,t,r)=>f+=Object(a["m"])(e,t);for(let u=1;u<v;u+=2){const e=3*o[u];Object(a["w"])(g,c[e],c[e+1],c[e+2]),d&&Object(a["q"])(g,g,d),j(m,g,O++);for(let t=0;t<2;++t)p[i]=1-t,p[i+1]=f,i+=h;Object(a["k"])(m,g)}const y=3*o[v];Object(a["w"])(g,c[y],c[y+1],c[y+2]),d&&Object(a["q"])(g,g,d),j(m,g,O),p[i]=1,p[i+1]=f}}const U={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1,...f["b"]},V=Object(c["f"])(),N=Object(c["f"])(),q=Object(c["f"])(),W=Object(c["f"])(),G=Object(s["d"])(),H=Object(s["d"])(),k=Object(c["f"])(),B=Object(c["f"])(),$=Object(l["d"])(),Z=Object(l["d"])(),X=Object(c["f"])(),Q=[Object(s["d"])(),Object(s["d"])(),Object(s["d"])(),Object(s["d"])()],Y=[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()],J=Object(d["d"])(),K=Object(d["d"])(),ee=Object(d["d"])(),te=Object(d["d"])()},"3e44":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o}));var i=r("2aad"),n=r("3886"),s=r("690a");function o(){const e=new s["a"];return e.include(i["a"]),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(n["a"]`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`),e}const a=Object.freeze({__proto__:null,build:o})},"4f8b":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return l}));var i=r("2119"),n=r("e431"),s=r("d18f");r("7361");function o(e){return e?{ray:Object(s["c"])(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(s["c"])(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=o()){return Object(s["b"])(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,r=o()){const i=Object(n["p"])(e.vector);return Object(s["f"])(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function l(e,t){return u(e,e.c0,t)}function d(e,t){return u(e,e.c1,t)}function u(e,t,r){return Object(n["f"])(r,e.ray.origin,Object(n["e"])(r,e.ray.direction,t))}new i["a"](()=>({c0:0,c1:0,ray:null}))},5241:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return m}));var i=r("b2b2"),n=r("afe1"),s=r("0b2d"),o=r("8188"),a=r("4261"),c=r("32ed"),l=r("1a54"),d=r("2e0f"),u=r("ba58"),h=r("5a22");const p=Object(s["f"])();function f(e,t,r,s,c,l,u,f){const b=r?r.length:0,m=e.clippingExtent;if(Object(o["n"])(t,p,e.elevationProvider.spatialReference),Object(i["l"])(m)&&!Object(a["e"])(m,p))return null;const g=e.renderCoordsHelper.spatialReference;Object(o["n"])(t,p,g);const v=e.localOriginFactory.getOrigin(p),O=new h["a"]({castShadow:!1,metadata:{layerUid:l,graphicUid:u,usesVerticalDistanceToGround:!0}});for(let i=0;i<b;i++){const e=n["a"];O.addGeometry(r[i],s[i],e,v,f)}return{object:O,sampledElevation:Object(d["c"])(O,t,e.elevationProvider,e.renderCoordsHelper,c)}}function b(e,t,r){const i=e.elevationContext,n=r.spatialReference;Object(o["n"])(t,p,n),i.centerPointInElevationSR=Object(l["g"])(p[0],p[1],t.hasZ?p[2]:0,n)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(u["a"])(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=Object(c["f"])(t,Object(c["e"])(t)/2);return Object(l["g"])(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function g(e,t,r,i,n){const s=new Float64Array(3*e.length),o=new Float64Array(s.length);e.forEach((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0});const a=Object(d["d"])(s,t,0,o,0,s,0,s.length/3,r,i,n),c=null!=a;return{numVertices:e.length,position:s,mapPosition:o,projectionSuccess:c,sampledElevation:a}}},"5a22":function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var i=r("b2b2"),n=r("d791"),s=r("afe1"),o=r("e431"),a=r("0b2d"),c=r("f895"),l=r("680b"),d=r("003f"),u=r("ecd7"),h=r("f2e0");class p{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,r,i,n,s){this.id=Object(h["a"])(),this.geometry=e,this.material=t,this.transformation=r,this.instanceParameters=i,this.origin=n,this._shaderTransformation=s,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(i["l"])(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(o["q"])(e,e,this.getStaticTransformation()),!0)}}p.pool=new u["a"](p);var f=r("bea9"),b=r("1153"),m=r("b623");class g extends d["a"]{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(s["d"])(),this._bvObjectSpace=new O,this._bvWorldSpace=new O,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new v),this.transformation=Object(s["d"])();const{geometries:t,materials:r,transformations:i,origins:n}=e;if(Array.isArray(t)){Object(b["a"])(r.length===t.length,"Object3D: materials don't match geometries"),Object(b["a"])(i.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=p.pool.acquire(t[e],r[e],Object(s["c"])(i[e]),{highlights:null,occludees:null,visible:this._visible},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n["d"])(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(b["a"])(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,r,n,o){r=r||s["a"],this._geometries.push(e);const a=p.pool.acquire(e,t,r,{highlights:null,occludees:null,visible:this._visible},n,o);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(i["l"])(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(i["l"])(t.shaderTransformation)?this._geometryRecords.some(e=>Object(i["l"])(e.shaderTransformation)):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new f["a"](1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(m["a"])(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(m["e"])(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new f["a"](0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(m["a"])(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(m["e"])(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n["n"])(Object(i["u"])(t,Object(s["d"])()),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return t=t||Object(s["d"])(),Object(n["n"])(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],r=e.boundingInfo;Object(i["l"])(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Object(o["i"])(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(o["i"])(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(a["f"])(),t=Object(a["f"])(),r=Object(l["c"])(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const s=this._geometries[n].boundingInfo;if(Object(i["k"])(s))continue;const a=this._geometryRecords[n].getShaderTransformation(),c=Object(l["c"])(a);Object(o["q"])(e,s.getCenter(),a);const d=Object(o["m"])(e,this._bvObjectSpace.bounds),u=s.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],d+u),Object(o["q"])(t,e,this.transformation);const h=Object(o["m"])(t,this._bvWorldSpace.bounds),p=u*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,r){const i=e.getBBMin(),n=e.getBBMax(),s=Object(a["d"])(i),c=Object(a["d"])(n);Object(o["q"])(s,s,r),Object(o["q"])(c,c,r);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],s[o],c[o]),t.max[o]=Math.max(t.max[o],s[o],c[o]);for(let a=0;a<3;++a){Object(o["k"])(s,i),Object(o["k"])(c,n),s[a]=n[a],c[a]=i[a],Object(o["q"])(s,s,r),Object(o["q"])(c,c,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],s[e],c[e]),t.max[e]=Math.max(t.max[e],s[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(i["l"])(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(i["l"])(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class v{constructor(){this.min=Object(a["h"])(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(a["h"])(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class O extends v{constructor(){super(...arguments),this.bounds=Object(c["c"])()}init(){Object(o["w"])(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(o["w"])(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c["a"])(this.bounds)}}},6061:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r("b2b2"),n=r("f2e0"),s=r("d791"),o=r("afe1"),a=r("e431"),c=r("0fc4"),l=r("680b"),d=r("1038"),u=r("bea9"),h=r("b623");class p{constructor(e,t,r=null,i=null,s=Object(n["a"])(),a=null,l=null,d=!1){this.data=e,this.material=t,this.layerUid=r,this.graphicUid=i,this.id=s,this.boundingInfo=a,this.calculateShaderTransformation=l,this.castShadow=d,this.boundingSphere=Object(c["e"])(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(o["d"])(),this._shaderTransformationDirty=!0}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,r=Object(l["c"])(e)){Object(i["k"])(this.boundingInfo)||(Object(a["q"])(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return Object(i["l"])(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(i["k"])(this.calculateShaderTransformation)?Object(i["u"])(this.transformation,o["a"]):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(o["d"])()),Object(s["d"])(this._shaderTransformation,this.calculateShaderTransformation(Object(i["u"])(this.transformation,o["a"]))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(i["l"])(this._transformation)&&Object(a["q"])(e,e,this._transformation),!0);const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return!!Object(d["c"])(r,t,e)&&(Object(i["l"])(this._transformation)&&Object(a["q"])(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new u["a"](0),t=this.instanceParameters;return t.highlights=Object(h["a"])(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(h["e"])(t.highlights,e)}}},6611:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r("a4ee"),n=r("fc29"),s=r("59b2"),o=(r("b50f"),r("c120"),r("cea0"),r("d386"));let a=class extends n["a"]{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(i["a"])([Object(s["b"])()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"LABELS_SHOW_BORDER",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"SHOW_POI",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(i["a"])([Object(s["b"])()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),a=Object(i["a"])([Object(o["a"])("esri.views.3d.support.DebugFlags")],a);const c=new a},"661c":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r("38a4");function n(e,t,r=0){const n=Object(i["d"])(e,0,c);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*l(n*o[i]))}function s(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],c=s(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},6750:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("501b"),n=r("3886");function s(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?o(e,t):a(e)}function o(e,t){const r=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(i["a"]),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("camPos","vec3"),e.vertex.code.add(n["a"]`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - camPos);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),e.vertex.code.add(n["a"]`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${c};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),e.vertex.code.add(n["a"]`
  ${t.stippleRequiresStretchMeasure?n["a"]`vec3`:n["a"]`vec2`} computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {
  `),r&&e.vertex.code.add(n["a"]`
      if (segmentLengthPseudoScreen >= patternLength) {

        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?n["a"]`return vec3(0.0, segmentLengthScreenRounded, repetitions / flooredRepetitions);`:n["a"]`return vec2(0.0, segmentLengthScreenRounded);`}
      }
    `),e.vertex.code.add(n["a"]`
      ${t.stippleRequiresStretchMeasure?n["a"]`return vec3(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen, 1.0)`:n["a"]`return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen)`};
    }
  `),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(n["a"]`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),e.fragment.code.add(n["a"]`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?n["a"]`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n["a"]`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?n["a"]`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      return (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?n["a"]`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n["a"]`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?e.fragment.code.add(n["a"]`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(n["a"]`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function a(e){e.fragment.code.add(n["a"]`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const c=n["a"].float(.4)},7079:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("d047"),n=r("9617"),s=r("501b"),o=r("3886");function a(e,t){t.multipassGeometryEnabled&&e.vertex.include(n["b"]),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(o["a"]`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?o["a"]`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(i["a"]),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(s["a"]),e.fragment.code.add(o["a"]`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?o["a"]`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},"713b":function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u}));var i=r("d272"),n=r("4db9"),s=r("6d5b"),o=r("6a07"),a=r("6750"),c=r("ebd5"),l=r("3886"),d=r("690a");function u(e){const t=new d["a"];return t.include(n["a"],{linearDepth:!1}),t.include(s["a"],e),t.include(a["a"],{...e,stippleRequiresStretchMeasure:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3")),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(l["a"]`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.vertex.code.add(l["a"]`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped||t.vertex.code.add(l["a"]`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(l["a"]`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?t.vertex.code.add(l["a"]`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):t.vertex.code.add(l["a"]`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(l["a"]`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),t.vertex.code.add(l["a"]`}`),4===e.output&&t.include(o["a"]),t.include(i["a"],e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(l["a"]`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${l["a"].float(c["c"])}) {
      discard;
    }

    ${0===e.output?l["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?l["a"]`outputHighlight();`:""}
  }
  `),t}const h=Object.freeze({__proto__:null,build:u})},"748f":function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r("ce6d"),n=r("af40"),s=r("b2b2"),o=r("8a44"),a=r("003f");const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var l=r("0bde");class d extends a["a"]{constructor(e,t=""){var r,s,a;super(),this.apiLayerUid=t,this.type=0,this.events=new i["a"],this.isSliceable=!1,this._objects=new o["a"],this._stageHandles=new n["a"],this.apiLayerUid=t,this.isVisible=null==(r=null==e?void 0:e.isVisible)||r,this.isPickable=null==(s=null==e?void 0:e.isPickable)||s,this.updatePolicy=null!=(a=null==e?void 0:e.updatePolicy)?a:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of c)this._stageHandles.add(this.events.on(t,r=>e.handleEvent(t,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(s["l"])(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(s["l"])(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(s["l"])(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(s["l"])(this._octree)&&this._octree.remove(t)}}sync(){Object(s["l"])(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(s["l"])(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(s["k"])(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(s["e"])(this._octree)}_createOctree(){this._octree=new l["a"](e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}},7585:function(e,t,r){"use strict";r.d(t,"a",(function(){return Tt}));var i=r("a4ee"),n=r("fc29"),s=r("ce6d"),o=r("af40"),a=r("e92d"),c=r("28eb"),l=r("b2b2"),d=r("8a44"),u=r("c47a"),h=r("3795"),p=r("59b2"),f=(r("b50f"),r("c120"),r("cea0"),r("d386")),b=r("d791"),m=r("02f1"),g=r("0b2d"),v=r("afe1"),O=r("6611"),j=r("38a4"),y=r("9180"),x=r("7abc");class _{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=Object(y["l"])(),this.resolution=0,this.renderLocalOrigin=Object(x["a"])(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries={extents:[Object(y["l"])(),Object(y["l"])(),Object(y["l"])()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}getNormalTexture(e){const t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield(),i=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)1===n.type&&!1===i?this.validTargets[n.type]=!1:this.validTargets[n.type]=e.drawTarget(this,n,t);return r^this.computeRenderTargetValidityBitfield()?0:1}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(y["u"])(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(y["u"])(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(y["k"])(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}var w=r("738e"),S=r("7ce4"),C=r("d267"),T=(r("1956"),r("d17d"),r("9f8b"),r("a1ff")),P=r("0fa6");class D{constructor(e,t){this.size=Object(w["a"])(),this._fbo=null,this._fbo=new C["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l["f"])(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}class E{constructor(e){const t=(t,r,i=!0)=>({type:r,fbo:new D(e,i),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(0,0),t(0,1),t(5,2,!1),t(3,3),t(0,4)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>R)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,t)=>e+t.fbo.gpuMemoryUsage,0)}}const R=1e3;class A{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var r;return null==(r=this._outer.get(e))?void 0:r.get(t)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,r)=>e(t,r))}}class z{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class M{constructor(e){this._context=e,this._perConstructorInstances=new A,this._frameCounter=0,this._keepAliveFrameCount=L}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(e=>e.forEach(e=>e.technique.dispose())),this._perConstructorInstances.clear()}acquire(e,t){const r=t.key;let i=this._perConstructorInstances.get(e,r);if(Object(l["k"])(i)){const n=new e(this._context,t,()=>this.release(n));i=new z(n),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,r){if(Object(l["l"])(r)){if(t.key===r.key)return r;r.release()}return this.acquire(e,t)}release(e){if(Object(l["k"])(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);Object(l["k"])(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==L&&this._perConstructorInstances.forEach((e,t)=>{e.forEach((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.dispose(),this._perConstructorInstances.delete(t,r))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((t,r)=>{const i=async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach(e=>{e.technique.reload(this._context)}))};e.push(i(t,r))}),await Promise.all(e)}}const L=-1,F=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const r=this[t];this[t]=null,r&&"function"==typeof r.dispose&&r.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};F(class{});function I(){return(e,t)=>{var r,i;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(r=null==(i=e._managedDisposables)?void 0:i.slice())?r:[]),e._managedDisposables.unshift(t)}}var U=r("171c"),V=r("1153");const N=a["a"].getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class q{constructor(e){this._glMaterial=e,this.refCnt=0,this._glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(V["a"])(this.refCnt>=0)}getRefCnt(){return this.refCnt}get glMaterial(){return this._glMaterial}}class W{constructor(e,t,r,i){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new A}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let r=this._id2glMaterialRef.get(t,e.id);if(Object(l["k"])(r)){const i=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});r=new q(i),this._id2glMaterialRef.set(t,e.id,r)}return r.incRefCnt(),r.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);Object(l["l"])(r)&&(r.decRefCnt(),0===r.getRefCnt()&&(Object(l["f"])(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){Object(l["l"])(e.repository)&&e.repository!==this&&N.error("Material is already owned by a different material repository"),e.repository=this}}var G=r("d5f7"),H=r("adf1"),k=r("9250");class B{constructor(e){this.rctx=e,this.camera=null,this.lastFrameCamera=new U["a"],this.pass=0,this.slot=2,this.highlightDepthTexture=null,this.renderOccludedMask=$,this.hasOccludees=!1}resetRenderOccludedMask(){this.renderOccludedMask=$}get isHighlightPass(){return 5===this.pass}}const $=13;class Z{constructor(){this.adds=new d["a"],this.removes=new d["a"],this.updates=new d["a"]({allocator:e=>e||new X,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class X{}class Q{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}function Y(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new Q,t.set(e,r)),r};return e.adds.forAll(e=>{J(e)&&r(e.material).adds.push(e)}),e.removes.forAll(e=>{J(e)&&r(e.material).removes.push(e)}),e.updates.forAll(e=>{J(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)}),t}function J(e){return e.data.indexCount>=1}var K=r("2ebb"),ee=r("b061"),te=r("1f93");class re{constructor(e){this.first=e.from,this.count=e.to-e.from}}class ie{constructor(e=0,t=0){this.from=e,this.to=t}}class ne extends ie{constructor(e,t,r,i,n,s){super(t,r),this.id=e,this.isVisible=i,this.hasHighlights=n,this.hasOccludees=s}}function se(e){return Array.from(e.values()).sort(oe)}function oe(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function ae(e,t){if(0===e.length)return void e.push(new re(t));const r=e[e.length-1];if(ce(r,t)){const e=t.from-r.first+t.to-t.from;r.count=e}else e.push(new re(t))}function ce(e,t){return e.first+e.count>=t.from}class le{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(ue(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let r;const i=he(this._buffer.length,this._size,e);if(this._buffer.length!==i){const e=this._pool.newBuffer(i);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,i))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),r=this._buffer,this._buffer=e}const n=this._size;return this._size=e,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(e,t,i)=>this._buffer.array.set(r.array.subarray(t,i),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,r)=>{e!==t&&this._buffer.array.copyWithin(e,t,r)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}const de=65536;function ue(e){return Math.ceil(e/de)*de}function he(e,t,r){return t<=r?e>=r?e:ue(Math.max(2*e,r)):e<=2*r?e:ue(r)}var pe=r("aefa"),fe=r("f2e0");class be{constructor(e,t,r,i){this.vao=new P["a"](e,t,{geometry:r},{geometry:S["a"].createVertex(e,35044)}),this.array=new Float32Array(i),this.vao.vertexBuffers.geometry.setData(this.array)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const me=pe["a"]+1;class ge{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=e.newCache("MergedRenderer pool "+Object(fe["a"])(),ve)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),r=this._cache.pop(t);if(Object(l["l"])(r)){const e=r.pop();return r.length>0&&this._cache.put(t,r,e.array.byteLength*r.length,me),e}return new be(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,r=e.array.length.toString(),i=this._cache.pop(r);return Object(l["l"])(i)?(i.push(e),this._cache.put(r,i,t*i.length,-1)):this._cache.put(r,[e],t,-1),null}}function ve(e,t){if(0===t)return void e.forEach(e=>e.dispose());const r=e.pop(),i=e.length*r.array.byteLength;return r.dispose(),i}var Oe=r("b623");class je{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new d["a"],this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new ee["a"](this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new ge(e,r.vertexAttributeLocations,Object(K["a"])(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof te["a"]}get rendersOccluded(){return!this.isEmpty&&1!==this._material.renderOccluded}modify(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}addAndRemoveGeometries(e,t){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,s=xe(e,t);s.forEach((e,t)=>{s.delete(t);const o=e.toAdd.reduce((e,t)=>e+r.elementCount(t.data),0);let a=n.get(t);if(null==a)Object(V["a"])(0===e.toRemove.length),a=new Te(e.origin,new le(this._bufferPool,o*i)),n.set(t,a);else if(0===e.toAdd.length&&a.instances.size===e.toRemove.length)return a.buffer.dispose(),void n.delete(t);let c=0;a.instances.forEach(e=>c+=e.to-e.from);const l=e.toRemove.reduce((e,t)=>e+r.elementCount(t.data),0),d=a.buffer.size,u=(c+o-l)*i,h=De;if(u<d/2?this.removeAndRebuild(a,e.toRemove,i,u,h):e.toRemove.length>0&&this.remove(a,e.toRemove,i,h),e.toAdd.length>0){const t=Ee;Object(V["i"])(t,-e.origin[0],-e.origin[1],-e.origin[2]),this.add(a,e.toAdd,i,t,h)}const p=a.buffer.vao.vertexBuffers.geometry;Ce(h),h.forAll(({from:e,to:t})=>{if(e<t){const r=a.buffer.array,i=4,n=e*i,s=t*i;p.setSubData(r,n,n,s)}}),h.clear(),a.drawCommandsDirty=!0})}updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.origin.id),s=n&&n.instances.get(e.id);if(!s)return;const o=i.updateType;if(1&o&&(s.isVisible=e.instanceParameters.visible),9&o){const t=e.instanceParameters.visible;s.hasHighlights=!!e.instanceParameters.highlights&&t}if(16&o&&(s.hasOccludees=!!e.instanceParameters.occludees),6&o){const{array:i,vao:o}=n.buffer;Object(Oe["b"])(e,Re,Ae),t.write({transformation:Re,invTranspTransformation:Ae},e.data,t.vertexBufferLayout.createView(i.buffer),s.from),Object(V["a"])(s.from+t.elementCount(e.data)===s.to,"material VBO layout has changed"),o.vertexBuffers.geometry.setSubData(i,s.from*r*4,s.from*r*4,s.to*r*4)}n.drawCommandsDirty=!0}}updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(c["c"])(e.instances,t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))});const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!we(e)){const t=this._bufferWriter.vertexBufferLayout.stride,r=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:r}])}const t=se(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?ae(e.drawCommandsOccludees,r):ae(e.drawCommandsDefault,r),r.hasHighlights?ae(e.drawCommandsHighlight,r):ae(e.drawCommandsShadowHighlightRest,r))};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)})}updateLogic(e){return this._material.update(e)}render(e,t,r){if(null!=e&&!this._material.requiresSlot(e,t))return!1;const i=5===t||7===t;if(i&&!this._hasHighlights)return!1;const n=6===t,s=!(i||n);if(this._dataByOrigin.forEach(e=>{if(i&&!e.hasHighlights)return;const t=(i?e.drawCommandsHighlight:n&&we(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,r=s&&e.drawCommandsOccludees||null;(Object(l["l"])(t)||Object(l["l"])(r))&&this._renderCommandData.push(new Pe(e.origin,e.buffer,t,r))}),0===this._renderCommandData.length)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(Object(l["k"])(a))return this._renderCommandData.clear(),!1;const c=a.beginSlot(r);return c.bindPipelineState(o,e,!1),o.useProgram(c.program),a.bind(r,c),this._renderCommandData.forAll(({origin:t,buffer:i,renderCommands:n,occludeeCommands:s})=>{r.origin=t,c.bindDraw(r),c.ensureAttributeLocations(i.vao),o.bindVAO(i.vao);const a=c.primitiveType;Object(l["l"])(n)&&this.renderCommands(o,a,n),Object(l["l"])(s)&&(c.bindPipelineState(o,e,!0),this.renderCommands(o,a,s),c.bindPipelineState(o,e,!1))}),this._renderCommandData.clear(),!0}renderCommands(e,t,r){for(let i=0;i<r.length;i++)e.drawArrays(t,r[i].first,r[i].count)}removeAndRebuild(e,t,r,i,n){for(const l of t)e.instances.delete(l.id);const s=se(e.instances);e.instances.clear();const o=e.buffer.size,a=e.buffer.alloc(i);let c=0;for(const l of s){const t=l.from*r,i=l.to*r;a.copy(c,t,i),l.from=c/r,c+=i-t,l.to=c/r,e.instances.set(l.id,l)}n.push(new ie(0,a.hasNewBuffer?e.buffer.array.length:o)),a.dispose(),e.buffer.erase(c,n.back().to),e.holes.clear()}remove(e,t,r,i){for(const n of t){const t=n.id,s=e.instances.get(t),o=s.from*r,a=s.to*r;e.buffer.erase(o,a),e.holes.push(new ie(s.from,s.to)),e.instances.delete(t),i.push(new ie(o,a))}Ce(e.holes)}add(e,t,r,i,n){const s=this._bufferWriter;let o=s.vertexBufferLayout.createView(e.buffer.array.buffer);for(const a of t){const t=Object(l["l"])(a.transformation)?Object(b["n"])(Re,i,a.transformation):i;Object(b["c"])(Ae,t);const c=Object(b["t"])(Ae,Ae),d=s.elementCount(a.data),u=d*r;let h=Se(e.holes,d);Object(l["k"])(h)&&(h=e.buffer.size/r,e.buffer.grow(u),o=s.vertexBufferLayout.createView(e.buffer.array.buffer)),s.write({transformation:t,invTranspTransformation:c},a.data,o,h);const p=a.instanceParameters.visible,f=!!a.instanceParameters.highlights&&p,m=!!a.instanceParameters.occludees,g=new ne(a.id,h,h+d,p,f,m);Object(V["a"])(null==e.instances.get(a.id)),e.instances.set(a.id,g),n.push(new ie(g.from*r,g.to*r))}}get test(){return{material:this._material,glMaterials:this._glMaterials}}}class ye{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function xe(e,t){const r=new Map;for(const i of e)_e(r,i,!0);for(const i of t)_e(r,i,!1);return r}function _e(e,t,r){const i=t.origin;if(Object(l["k"])(i))return;let n=e.get(i.id);null==n&&(n=new ye(i.vec3),e.set(i.id,n)),r?n.toAdd.push(t):n.toRemove.push(t)}function we(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Se(e,t){let r;if(!e.some(e=>!(e.to-e.from<t)&&(r=e,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}function Ce(e){const t=new Map;e.forAll(e=>t.set(e.from,e));let r=!0;for(;r;)r=!1,e.forEach(i=>{const n=t.get(i.to);n&&(i.to=n.to,t.delete(n.from),e.removeUnordered(n),r=!0)})}class Te{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new d["a"]({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Pe{constructor(e,t,r,i){this.origin=e,this.buffer=t,this.renderCommands=r,this.occludeeCommands=i}}const De=new d["a"]({deallocator:null}),Ee=Object(v["d"])(),Re=Object(v["d"])(),Ae=Object(v["d"])();let ze=class extends n["a"]{constructor(){super(...arguments),this._pending=new Me,this._changes=new Z,this._materialRenderers=new Map,this._sortedMaterialRenderers=new d["a"],this._hasHighlights=!1,this._hasWater=!1}dispose(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(c["c"])(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Y(this._changes);let t=!1,r=!1,i=!1;return e.forEach((e,n)=>{let s=this._materialRenderers.get(n);if(!s&&e.adds.length>0&&(s=new je(this.rctx,this.materialRepository,n),this._materialRenderers.set(n,s),t=!0,r=!0,i=!0),!s)return;const o=r||s.hasHighlights,a=i||s.hasWater;s.modify(e),r=r||o!==s.hasHighlights,i=i||a!==s.hasWater,s.isEmpty&&(this._materialRenderers.delete(n),s.dispose(),t=!0)}),this._changes.clear(),t&&this.updateSortedMaterialRenderers(),r&&(this._hasHighlights=Object(c["c"])(this._materialRenderers,e=>e.hasHighlights)),i&&(this._hasWater=Object(c["c"])(this._materialRenderers,e=>e.hasWater)),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=this._pending.empty;for(const r of e)this._pending.adds.add(r);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const r of e)this._pending.adds.has(r)?(this._pending.removed.add(r),this._pending.adds.delete(r)):this._pending.removed.has(r)||this._pending.removes.add(r);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=i,e.updateType=t}r&&this._changes.updates.length>0&&this.notifyChange("updating")}updateLogic(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:r})=>t=r.updateLogic(e)||t),t}render(e,t){for(let r=0;r<this._sortedMaterialRenderers.length;r++){const i=this._sortedMaterialRenderers.data[r];i.material.shouldRender(e)&&i.materialRenderer.render(t.slot,e.pass,t)}}updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push({material:r,materialRenderer:t})}),this._sortedMaterialRenderers.sort((e,t)=>{const r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(i["a"])([Object(p["b"])()],ze.prototype,"rctx",void 0),Object(i["a"])([Object(p["b"])()],ze.prototype,"materialRepository",void 0),Object(i["a"])([Object(p["b"])()],ze.prototype,"updating",null),ze=Object(i["a"])([Object(f["a"])("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ze);class Me{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}var Le=r("3e44"),Fe=r("c3a4"),Ie=r("ca98"),Ue=r("da35"),Ve=r("fa1e"),Ne=r("c829"),qe=r("189c");class We extends Ie["a"]{initializeProgram(e){const t=We.shader.get().build();return new Ne["a"](e.rctx,t,Ve["a"])}initializePipeline(){return this.configuration.hasAlpha?Object(qe["f"])({blending:Object(qe["g"])(770,1,771,771),colorWrite:qe["c"]}):Object(qe["f"])({colorWrite:qe["c"]})}}We.shader=new Fe["a"](Le["a"],()=>r.e("chunk-2d0b3143").then(r.bind(null,"279a")));class Ge extends Ue["a"]{constructor(){super(...arguments),this.hasAlpha=!1}}Object(i["a"])([Object(Ue["b"])()],Ge.prototype,"hasAlpha",void 0);class He{constructor(e=Object(g["f"])()){this.intensity=e}}class ke{constructor(e=Object(g["f"])(),t=Object(g["h"])(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class Be{constructor(e=Object(g["f"])(),t=Object(g["h"])(.57735,.57735,.57735),r=!0){this.intensity=e,this.direction=t,this.castShadows=r}}class $e{constructor(){this.r=[0],this.g=[0],this.b=[0]}}var Ze=r("e431");function Xe(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function Qe(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function Ye(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function Je(e){return(e+1)*(e+1)}function Ke(e){return Object(j["d"])(Math.floor(Math.sqrt(e)-1),0,2)}function et(e,t,r){const i=e[0],n=e[1],s=e[2],o=r||[];return o.length=Je(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),t>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function tt(e,t){const r=Je(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function rt(e,t){const r=Ke(t.r.length);for(const i of e)Object(Ze["s"])(dt,i.direction),et(dt,r,ct),Xe(ct,ut),Qe(ct,i.intensity[0],lt),Ye(t.r,lt),Qe(ct,i.intensity[1],lt),Ye(t.g,lt),Qe(ct,i.intensity[2],lt),Ye(t.b,lt);return t}function it(e,t){et(dt,0,ct);for(const r of e)t.r[0]+=ct[0]*ut[0]*r.intensity[0]*4*Math.PI,t.g[0]+=ct[0]*ut[0]*r.intensity[1]*4*Math.PI,t.b[0]+=ct[0]*ut[0]*r.intensity[2]*4*Math.PI;return t}function nt(e,t,r,i){tt(t,i),Object(Ze["w"])(r.intensity,0,0,0);let n=!1;const s=st,o=ot,a=at;s.length=0,o.length=0,a.length=0;for(const c of e)c instanceof Be&&!n?(Object(Ze["k"])(r.direction,c.direction),r.intensity[0]=c.intensity[0],r.intensity[1]=c.intensity[1],r.intensity[2]=c.intensity[2],r.castShadows=c.castShadows,n=!0):c instanceof Be||c instanceof ke?s.push(c):c instanceof He?o.push(c):c instanceof $e&&a.push(c);rt(s,i),it(o,i);for(const c of a)Ye(i.r,c.r),Ye(i.g,c.g),Ye(i.b,c.b)}const st=[],ot=[],at=[],ct=[0],lt=[0],dt=Object(g["f"])(),ut=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class ht{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(g["f"])(),ambient:{color:Object(g["f"])(),intensity:1},diffuse:{color:Object(g["f"])(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new $e,this._mainLight={intensity:Object(g["f"])(),direction:Object(g["h"])(1,0,0),castShadows:!1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(e,t=!1){const r=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",r),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);const i=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}set(e){nt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(Ze["k"])(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(Ze["e"])(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(Ze["k"])(pt,this._oldSunlight.diffuse.color),Object(Ze["e"])(pt,pt,this._ambientBoost*this.globalFactor),Object(Ze["f"])(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,pt)}get old(){return this._oldSunlight}}const pt=Object(g["f"])();var ft=r("661c");class bt{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach(e=>e.texture=Object(l["f"])(e.texture)),this.cache.clear()}acquire(e){if(Object(l["k"])(e))return null;const t=this.patternId(e),r=this.cache.get(t);if(r)return r.refCount++,r.bind;const i=e.pixelRatio,{encodedData:n,sdfNormalizer:s,pixels:o,paddedPixels:a}=mt(e.pattern,i),c=o/i,d={refCount:1,texture:null,bind:e=>(Object(l["k"])(d.texture)&&(d.texture=new T["a"](this._rctx,{width:a,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},n)),e.bindTexture(d.texture,"stipplePatternTexture"),{pixelSize:c,sdfNormalizer:s,pixels:o})};return this.cache.set(t,d),d.bind}release(e){if(Object(l["k"])(e))return;const t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(Object(l["l"])(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}swap(e,t){const r=this.acquire(t);return this.release(e),r}patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}function mt(e,t){const r=e.map(e=>Math.round(e*t)),i=1/t,n=Math.floor(r.reduce((e,t)=>e+t)),s=r.reduce((e,t)=>Math.max(e,t)),o=(Math.floor(.5*(s-1))+.5)*i,a=[];let c=1;for(const f of r){for(let e=0;e<f;e++){const t=c*(Math.min(e,f-1-e)+.5)*i/o*.5+.5;a.push(t)}c=-c}const l=Math.round(r[0]/2),d=[...a.slice(l),...a.slice(0,l)],u=n+2,h=new Uint8Array(4*u);let p=4;for(const f of d)Object(ft["a"])(f,h,p),p+=4;return h.copyWithin(0,p-4,p),h.copyWithin(p,4,8),{encodedData:h,sdfNormalizer:o,paddedPixels:u,pixels:n}}var gt=r("9305"),vt=r("8539");const Ot=a["a"].getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let jt=class extends(F(n["a"])){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new ht,this._handles=new o["a"],this._frameTask=gt["a"],this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new d["a"],this._geometries=new Map,this.worldToPCSRatio=1,this.events=new s["a"],this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new B(this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new bt(e.renderingContext),this._shaderTechniqueRepository=new M({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Object(h["a"])(t,"loadingState",()=>this.events.emit("content-changed")),Object(h["a"])(this,"spatialReference",e=>this._localOrigins=new H["a"](e))]),this._materialRepository=new W(e.textureRepository,this._shaderTechniqueRepository,e=>{(e.renderOccluded&Pt)>0!==this._rendersOccluded&&this.updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new He(Object(g["h"])(1,1,1))]),this._bindParameters={slot:20,highlightDepthTexture:Object(G["a"])(this._rctx),camera:wt,inverseViewport:Object(m["a"])(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:v["a"],ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._frameTask=this.view.resourceController.scheduler.registerTask(gt["b"].STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._layerRenderers.forEach(e=>e.dispose()),this._layerRenderers.clear(),this._debugTextureTechnique=Object(l["r"])(this._debugTextureTechnique),this._debugPatternTexture=Object(l["f"])(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l["f"])(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l["f"])(this._shaderTechniqueRepository),this._temporaryFBO=Object(l["f"])(this._temporaryFBO),this._quadVAO=Object(l["f"])(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedLayerRenderersDirty||this._frameTask.updating||Object(c["c"])(this._layerRenderers,e=>e.updating)}get hasOverlays(){return Object(l["l"])(this._overlays)&&Object(l["l"])(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l["l"])(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l["l"])(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(i,r,e)||t}return t}get overlays(){return Object(l["u"])(this._overlays,[])}ensureDrapeTargets(e){Object(l["l"])(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=Object(u["a"])(e,e=>1===e.drapeTargetType)})}ensureDrapeSources(e){Object(l["l"])(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=Object(c["c"])(e,(e,t)=>1===t.drapeSourceType),t.hasDrapedRasterSource=Object(c["c"])(e,(e,t)=>0===t.drapeSourceType)})}ensureOverlays(e,t){Object(l["k"])(this._overlays)&&(this._overlayRenderTarget=new E(this._rctx),this._overlays=[new _(0,this._overlayRenderTarget),new _(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(l["f"])(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}_processLayers(e,t){let r=!1;for(const[i,n]of this._layerRenderers){if(e.done)break;(i.destroyed||t(i))&&(n.commitChanges()&&(r=!0,e.madeProgress()),n.isEmpty&&(r=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(i),this._handles.remove(i)))}this.updateSortedLayerRenderers(),r&&(Object(l["l"])(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}processSyncLayers(){this._processLayers(gt["c"],e=>1===e.updatePolicy)}addGeometries(e,t,r){for(const i of e)Object(l["k"])(i.origin)&&(i.origin=this._localOrigins.getOrigin(i.boundingSphere)),this._geometries.set(i.id,i);this.ensureLayerRenderer(t).add(e),2===r&&this.notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,r){for(const n of e)this._geometries.delete(Object(l["t"])(n.id));const i=this._layerRenderers.get(t);i&&(i.remove(e),2===r&&this.notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,r){const i=this._layerRenderers.get(t);if(i)switch(i.modify(e,r),r){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else Ot.warn("Attempted to update geometry for nonexistent layer")}notifyGraphicGeometryChanged(e,t){if(Object(l["k"])(t.notifyGraphicGeometryChanged))return;let r;for(const i of e){const e=i.graphicUid;Object(l["l"])(e)&&e!==r&&(t.notifyGraphicGeometryChanged(e),r=e)}}notifyGraphicVisibilityChanged(e,t){if(Object(l["k"])(t.notifyGraphicVisibilityChanged))return;let r;for(const i of e){const e=i.graphicUid;Object(l["l"])(e)&&e!==r&&(t.notifyGraphicVisibilityChanged(e),r=e)}}updateHighlights(e,t){const r=this._layerRenderers.get(t);r?r.modify(e,8):Ot.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!O["a"].OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateLogic(e){let t=!1;return this._layerRenderers.forEach(r=>t=r.updateLogic(e)||t),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(0===i.numViews)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const n=t.renderPass;if(this.isEmpty()||5===n&&!this.hasHighlights||3===n&&!this.hasWater||!e.hasSomeSizedView())return!1;const s=t.fbo;if(!s.isValid())return!1;const o=2*e.resolution,a=e.resolution;s.resize(o,a);const c=this._rctx;wt.pixelRatio=e.pixelRatio*r,this._renderContext.pass=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===n?21:20,e.applyViewport(this._rctx),s.bind(c),0===e.index&&(c.setClearColor(0,0,0,0),c.clearSafe(16384));const d=1===t.type?2:4===t.type?1:0;if(1===d&&(this._renderContext.renderOccludedMask=Pt),O["a"].OVERLAY_DRAW_DEBUG_TEXTURE&&1!==d)for(let l=0;l<i.numViews;l++)this.setViewParameters(i.extents[l],e,wt),this.drawDebugTexture(e.resolution,xt[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll(({layerView:t,renderer:r})=>{if(2===d&&Object(l["l"])(t)&&0===t.drapeSourceType)return;const u=Object(l["l"])(t)&&Object(l["l"])(t.fullOpacity)&&t.fullOpacity<1&&0===n;u&&(this.bindTemporaryFramebuffer(this._rctx,o,a),c.clearSafe(16384));for(let n=0;n<i.numViews;n++)this.setViewParameters(i.extents[n],e,wt),r.render(this._renderContext,this._bindParameters);u&&Object(l["l"])(this._temporaryFBO)&&(s.bind(c),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,Object(l["t"])(Object(l["t"])(t).fullOpacity),3,e.index))}),c.bindFramebuffer(null),s.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){Object(l["k"])(this._temporaryFBO)&&(this._temporaryFBO=new D(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}intersect(e,t,r,i){let n=0;this._geometries.forEach(s=>{if(i&&!i(s))return;this._intersectRenderGeometry(s,r,t,0,e,n);const o=this.longitudeCyclical;o&&(s.boundingSphere[0]-s.boundingSphere[3]<o.min&&this._intersectRenderGeometry(s,r,t,o.range,e,n),s.boundingSphere[0]+s.boundingSphere[3]>o.max&&this._intersectRenderGeometry(s,r,t,-o.range,e,n)),n++})}_intersectRenderGeometry(e,t,r,i,n,s){if(!e.instanceParameters.visible)return;let o=0;Object(l["l"])(e.transformation)&&(i+=e.transformation[12],o=e.transformation[13]),St[0]=r[0]-i,St[1]=r[1]-o,St[2]=1,Ct[0]=r[0]-i,Ct[1]=r[1]-o,Ct[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,St,Ct,(r,i,o)=>{_t(t,o,e.material.renderPriority,s,n,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}ensureLayerRenderer(e){let t=this._layerRenderers.get(e);return t||(t=new ze({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,t),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",()=>this.events.emit("content-changed")),e),this._handles.add(Object(h["a"])(t,"updating",()=>this.notifyChange("updating")),e)),t}updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const e=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach(t=>{const r=t,i=this._layerRenderers.get(r);i&&(this._sortedLayerRenderers.push(new yt(r,i)),e.delete(i))}),e.forEach(e=>this._sortedLayerRenderers.push(new yt(null,e)))}setViewParameters(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,Object(b["p"])(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Object(b["j"])(r.viewMatrix),Object(b["b"])(r.viewMatrix,r.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=r,this._bindParameters.camera=r,this._bindParameters.inverseViewport[0]=1/r.fullViewport[2],this._bindParameters.inverseViewport[1]=1/r.fullViewport[3]}updateHasWater(){const e=Object(c["c"])(this._layerRenderers,e=>e.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}updateHasHighlights(){const e=Object(c["c"])(this._layerRenderers,e=>e.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}updateRendersOccluded(){const e=Object(c["c"])(this._layerRenderers,e=>e.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}drawDebugTexture(e,t){const r=this._rctx;this.ensureDebugPatternResources(e,e);const i=this._debugTextureTechnique.program;r.useProgram(i),this._debugTextureTechnique.bindPipelineState(r),i.setUniform4f("color",t[0],t[1],t[2],1),i.bindTexture(this._debugPatternTexture,"tex"),r.bindVAO(this._quadVAO),r.drawArrays(5,0,Object(vt["e"])(this._quadVAO,"geometry"))}ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const r=new Uint8Array(e*t*4);let i=0;for(let s=0;s<t;s++)for(let n=0;n<e;n++){const o=Math.floor(n/10),a=Math.floor(s/10);o<2||a<2||10*o>e-20||10*a>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&a?1&n^1&s?0:255:1&o^1&a?0:128)}this._debugPatternTexture=new T["a"](this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r);const n=new Ge;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(We,n),this._quadVAO=Object(G["b"])(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};Object(i["a"])([Object(p["b"])()],jt.prototype,"_frameTask",void 0),Object(i["a"])([Object(p["b"])()],jt.prototype,"_sortedLayerRenderersDirty",void 0),Object(i["a"])([I()],jt.prototype,"_shaderTechniqueRepository",void 0),Object(i["a"])([I()],jt.prototype,"_stippleTextureRepository",void 0),Object(i["a"])([Object(p["b"])({constructOnly:!0})],jt.prototype,"view",void 0),Object(i["a"])([Object(p["b"])()],jt.prototype,"worldToPCSRatio",void 0),Object(i["a"])([Object(p["b"])()],jt.prototype,"spatialReference",void 0),Object(i["a"])([Object(p["b"])({type:Boolean,readOnly:!0})],jt.prototype,"updating",null),jt=Object(i["a"])([Object(f["a"])("esri.views.3d.terrain.OverlayRenderer")],jt);class yt{constructor(e,t){this.layerView=e,this.renderer=t}}const xt=[[1,.5,.5],[.5,.5,1]];function _t(e,t,r,i,n,s,o){const a={layerUid:s,graphicUid:o,triangleNr:t},c=t=>{t.set(3,a,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&c(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&c(n.results.max),2===n.options.store){const e=Object(k["b"])(n.ray);c(e),n.results.all.push(e)}}const wt=new U["a"];wt.near=1,wt.far=1e4,wt.relativeElevation=null;const St=Object(g["f"])(),Ct=Object(g["f"])(),Tt=-2,Pt=4},"7abc":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("0b2d");class n{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,r,s){return new n(Object(i["h"])(e,t,r),s)}},"7c1d":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){const t=i["a"]`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=i["a"]`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}},"84f4":function(e,t,r){"use strict";function i(e){return"point"===e.type}r.d(t,"a",(function(){return i}))},8675:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return o}));var i=r("fc00"),n=r("5957");const s=Object(i["a"])().vec3f("position"),o=Object(i["a"])().vec3f("position").vec2f("uv0"),a=Object(i["a"])().vec3f("position").vec4u8("color");class c{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(n["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}},"86ba":function(e,t,r){"use strict";r.d(t,"a",(function(){return V}));var i=r("e92d"),n=r("38a4"),s=r("b2b2"),o=r("a915"),a=r("3349"),c=r("e431"),l=r("0b2d"),d=r("bd7e"),u=r("7289"),h=r("fc00"),p=r("1038"),f=r("d7f7"),b=r("b061"),m=r("35b3"),g=r("1153"),v=r("b4c8"),O=r("b623"),j=r("9a68"),y=r("a4ee"),x=r("d272"),_=r("6a07"),w=r("c6d7"),S=r("be24"),C=r("8e97"),T=r("c3a4"),P=r("ca98"),D=r("da35"),E=r("7438"),R=r("c829"),A=r("87b7"),z=r("189c");const M=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);class L extends P["a"]{constructor(e,t,r){super(e,t,r),this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&4!==this.configuration.output}initializeProgram(e){const t=L.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:r.stippleScaleWithLineWidth,stipplePreferContinuous:r.stipplePreferContinuous,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new R["a"](e.rctx,i,M)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(C["c"])(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(_["b"])(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(w["a"])(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(S["d"])(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:i,pixels:n}=Object(s["l"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};if(this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){const t=Object(s["t"])(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(s["u"])(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){Object(C["d"])(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(C["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(x["c"])(this.program,this.configuration,e),this.program.rebindTextures()}makePipelineState(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(z["f"])({blending:0===r.output||7===r.output?i?E["g"]:Object(E["a"])(e):null,depthTest:{func:Object(E["b"])(e)},depthWrite:i?!r.transparent&&r.writeDepth&&z["d"]:Object(E["c"])(e),colorWrite:z["c"],stencilWrite:r.sceneHasOcludees?A["h"]:null,stencilTest:r.sceneHasOcludees?t?A["d"]:A["c"]:null,polygonOffset:i||n?r.polygonOffset&&F:E["d"]})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&F;return e.occluder&&(this._occluderPipelineTransparent=Object(z["f"])({blending:E["g"],polygonOffset:t,depthTest:A["a"],depthWrite:null,colorWrite:z["c"],stencilWrite:null,stencilTest:A["f"]}),this._occluderPipelineOpaque=Object(z["f"])({blending:E["g"],polygonOffset:t,depthTest:A["a"],depthWrite:null,colorWrite:z["c"],stencilWrite:A["g"],stencilTest:A["e"]}),this._occluderPipelineMaskWrite=Object(z["f"])({blending:null,polygonOffset:t,depthTest:A["b"],depthWrite:null,colorWrite:null,stencilWrite:A["h"],stencilTest:A["d"]})),this._occludeePipelineState=this.makePipelineState(this.configuration.transparencyPassType,!0),this.makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?10===e?this._occluderPipelineTransparent:9===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}L.shader=new T["a"](j["b"],()=>r.e("chunk-2d213386").then(r.bind(null,"ac6d")));const F={factor:0,units:-4};class I extends D["a"]{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(y["a"])([Object(D["b"])({count:8})],I.prototype,"output",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"occluder",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"slicePlaneEnabled",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"transparent",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"polygonOffset",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"writeDepth",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"draped",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"stippleEnabled",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"stippleOffColorEnabled",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"stippleScaleWithLineWidth",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"stipplePreferContinuous",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"roundCaps",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"roundJoins",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"vvSize",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"vvColor",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"vvOpacity",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"falloffEnabled",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"innerColorEnabled",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"sceneHasOcludees",void 0),Object(y["a"])([Object(D["b"])({count:4})],I.prototype,"transparencyPassType",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"multipassTerrainEnabled",void 0),Object(y["a"])([Object(D["b"])()],I.prototype,"cullAboveGround",void 0);const U=i["a"].getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class V extends m["a"]{constructor(e){super(e,q),this._vertexAttributeLocations=M,this.techniqueConfig=new I,this.layout=this.createLayout()}isClosed(e,t){return k(this.parameters,e,t)}dispose(){}getPassParameters(){return this.parameters}getTechniqueConfig(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=20===t.slot;const r=Object(s["l"])(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&Object(s["l"])(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.roundCaps=2===this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&Object(s["l"])(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=8===this.parameters.renderOccluded,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,n,o,a,c,l){Object(s["l"])(l)?this.intersectDrapedLineGeometry(e,i,l,o,a):this.intersectLineGeometry(e,t,r,i,a)}intersectDrapedLineGeometry(e,t,r,i,s){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get("position").data,a=e.vertexAttributes.get("size");let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];c*=Object(n["d"])(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(c*=a.data[0]);const l=i[0],d=i[1],u=(c/2+4)*e.screenToWorldRatio;let h=Number.MAX_VALUE,p=0;for(let f=0;f<o.length-5;f+=3){const e=o[f],t=o[f+1],r=l-e,i=d-t,s=o[f+3]-e,a=o[f+4]-t,c=Object(n["d"])((s*r+a*i)/(s*s+a*a),0,1),u=s*c-r,b=a*c-i,m=u*u+b*b;m<h&&(h=m,p=f/3)}h<u*u&&s(r.dist,r.normal,p,!1)}intersectLineGeometry(e,t,r,i,s){if(!i.options.selectionMode||Object(O["d"])(t))return;if(!Object(g["g"])(r))return void U.error("intersection assumes a translation-only matrix");const o=e.vertexAttributes,l=o.get("position").data;let h=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=o.get("sizeFeatureAttribute").data[0];h*=Object(n["d"])(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has("size")&&(h*=o.get("size").data[0]);const p=i.camera,f=Q;Object(a["c"])(f,i.point);const b=h*p.pixelRatio/2+4*p.pixelRatio;Object(c["w"])(oe[0],f[0]-b,f[1]+b,0),Object(c["w"])(oe[1],f[0]+b,f[1]+b,0),Object(c["w"])(oe[2],f[0]+b,f[1]-b,0),Object(c["w"])(oe[3],f[0]-b,f[1]-b,0);for(let n=0;n<4;n++)if(!p.unprojectFromRenderScreen(oe[n],ae[n]))return;Object(u["f"])(p.eye,ae[0],ae[1],ce),Object(u["f"])(p.eye,ae[1],ae[2],le),Object(u["f"])(p.eye,ae[2],ae[3],de),Object(u["f"])(p.eye,ae[3],ae[0],ue);let m=Number.MAX_VALUE,v=0;const j=H(this.parameters,o,e.indices)?l.length-2:l.length-5;for(let n=0;n<j;n+=3){B[0]=l[n]+r[12],B[1]=l[n+1]+r[13],B[2]=l[n+2]+r[14];const e=(n+3)%l.length;if($[0]=l[e]+r[12],$[1]=l[e+1]+r[13],$[2]=l[e+2]+r[14],Object(u["t"])(ce,B)<0&&Object(u["t"])(ce,$)<0||Object(u["t"])(le,B)<0&&Object(u["t"])(le,$)<0||Object(u["t"])(de,B)<0&&Object(u["t"])(de,$)<0||Object(u["t"])(ue,B)<0&&Object(u["t"])(ue,$)<0)continue;if(p.projectToRenderScreen(B,Y),p.projectToRenderScreen($,J),Y[2]<0&&J[2]>0){Object(c["j"])(Z,B,$);const e=p.frustum,t=-Object(u["t"])(e[4],B)/Object(c["h"])(Z,Object(u["q"])(e[4]));Object(c["e"])(Z,Z,t),Object(c["f"])(B,B,Z),p.projectToRenderScreen(B,Y)}else if(Y[2]>0&&J[2]<0){Object(c["j"])(Z,$,B);const e=p.frustum,t=-Object(u["t"])(e[4],$)/Object(c["h"])(Z,Object(u["q"])(e[4]));Object(c["e"])(Z,Z,t),Object(c["f"])($,$,Z),p.projectToRenderScreen($,J)}else if(Y[2]<0&&J[2]<0)continue;Y[2]=0,J[2]=0;const t=Object(d["e"])(Object(d["f"])(Y,J,te),f);t<m&&(m=t,Object(c["k"])(K,B),Object(c["k"])(ee,$),v=n/3)}const y=i.rayBegin,x=i.rayEnd;if(m<b*b){let e=Number.MAX_VALUE;if(Object(d["a"])(Object(d["f"])(K,ee,te),Object(d["f"])(y,x,re),X)){Object(c["j"])(X,X,y);const t=Object(c["p"])(X);Object(c["e"])(X,X,1/t),e=t/Object(c["m"])(y,x)}s(e,X,v,!1)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=e.indices,n=r.get("position");return Object(p["a"])(n,i?i.get("position"):null,i&&H(this.parameters,r,i),t)}createLayout(){const e=Object(h["a"])().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.parameters.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.parameters.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.parameters.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new W(this.layout,this.parameters)}requiresSlot(e,t){if(20===e)return!0;if(8===this.parameters.renderOccluded)return 2===e||9===e||10===e;const r=Object(b["b"])(t);return 0===r||7===r?e===(this.parameters.writeDepth?4:7):2===e}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new N(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return Object(s["l"])(e)&&e[3]<1&&e[3]>0}}class N extends f["a"]{updateParameters(e){return this.ensureTechnique(L,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const q={width:0,color:[1,1,1,1],join:"miter",cap:0,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...m["b"],...v["a"].Default};class W{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=j["a"]+r}}isClosed(e){return H(this.parameters,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.parameters.cap){case 1:case 2:return 1;default:return 0}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,r=e.indices.get("position").length/2+1,i=this.isClosed(e);let n=i?2:2*t;const s=i?0:1,o=i?r:r-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=s;e<o;++e)n+=4+2*t[e]}else n+=(o-s)*(2*this.numJoinSubdivisions+4);return n+=2,n}write(e,t,r,i){var n;const s=ie,o=ne,a=se,l=t.vertexAttributes.get("position").data,d=t.indices&&t.indices.get("position"),u=null==(n=t.vertexAttributes.get("distanceToStart"))?void 0:n.data,h=this.numCapSubdivisions(t);d&&d.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=null;t.vertexAttributes.has("subdivisions")&&(p=t.vertexAttributes.get("subdivisions").data);let f=1,b=0;this.parameters.vvSizeEnabled?b=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(f=t.vertexAttributes.get("size").data[0]);let m=[1,1,1,1],g=0;this.parameters.vvColorEnabled?g=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(m=t.vertexAttributes.get("color").data);let v=0;this.parameters.vvOpacityEnabled&&(v=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const O=l.length/3,j=e.transformation,y=new Float32Array(r.buffer),x=this.vertexBufferLayout.stride/4;let _=i*x;const w=_;let S=0;const C=(e,t,r,i,n,s,o)=>{if(y[_++]=t[0],y[_++]=t[1],y[_++]=t[2],y[_++]=i,y[_++]=o,y[_++]=n,y[_++]=e[0],y[_++]=e[1],y[_++]=e[2],y[_++]=r[0],y[_++]=r[1],y[_++]=r[2],this.parameters.vvSizeEnabled?y[_++]=b:y[_++]=f,this.parameters.vvColorEnabled)y[_++]=g;else{const e=Math.min(4*s,m.length-4);y[_++]=m[e+0],y[_++]=m[e+1],y[_++]=m[e+2],y[_++]=m[e+3]}this.parameters.vvOpacityEnabled&&(y[_++]=v)};_+=x,Object(c["w"])(o,l[0],l[1],l[2]),j&&Object(c["q"])(o,o,j);const T=this.isClosed(t);if(T){const e=l.length-3;Object(c["w"])(s,l[e],l[e+1],l[e+2]),j&&Object(c["q"])(s,s,j)}else{Object(c["k"])(s,o),Object(c["w"])(a,l[3],l[4],l[5]),j&&Object(c["q"])(a,a,j);for(let e=0;e<h;++e){const t=1-e/h;C(s,o,a,t,-4,0,S),C(s,o,a,t,4,0,S)}C(s,o,a,0,-4,0,S),C(s,o,a,0,4,0,S),Object(c["k"])(s,o),Object(c["k"])(o,a)}const P=T?0:1,D=T?O:O-1,E=u?(e,t,r)=>S=u[r]:(e,t,r)=>S+=Object(c["m"])(e,t);for(let R=P;R<D;R++){const e=(R+1)%O*3;Object(c["w"])(a,l[e+0],l[e+1],l[e+2]),j&&Object(c["q"])(a,a,j),E(s,o,R),C(s,o,a,0,-1,R,S),C(s,o,a,0,1,R,S);const t=p?p[R]:this.numJoinSubdivisions;for(let r=0;r<t;++r){const e=(r+1)/(t+1);C(s,o,a,e,-1,R,S),C(s,o,a,e,1,R,S)}C(s,o,a,1,-2,R,S),C(s,o,a,1,2,R,S),Object(c["k"])(s,o),Object(c["k"])(o,a)}if(T)Object(c["w"])(a,l[3],l[4],l[5]),j&&Object(c["q"])(a,a,j),S=E(s,o,D),C(s,o,a,0,-1,P,S),C(s,o,a,0,1,P,S);else{S=E(s,o,D),C(s,o,a,0,-5,D,S),C(s,o,a,0,5,D,S);for(let e=0;e<h;++e){const t=(e+1)/h;C(s,o,a,t,-5,D,S),C(s,o,a,t,5,D,S)}}G(y,w+x,y,w,x),_=G(y,_-x,y,_,x)}}function G(e,t,r,i,n){for(let s=0;s<n;s++)r[i++]=e[t++];return i}function H(e,t,r){return k(e,t.get("position").data,r?r.get("position"):null)}function k(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}const B=Object(l["f"])(),$=Object(l["f"])(),Z=Object(l["f"])(),X=Object(l["f"])(),Q=Object(l["f"])(),Y=Object(o["d"])(),J=Object(o["d"])(),K=Object(l["f"])(),ee=Object(l["f"])(),te=Object(d["d"])(),re=Object(d["d"])(),ie=Object(l["f"])(),ne=Object(l["f"])(),se=Object(l["f"])(),oe=[Object(o["d"])(),Object(o["d"])(),Object(o["d"])(),Object(o["d"])()],ae=[Object(l["f"])(),Object(l["f"])(),Object(l["f"])(),Object(l["f"])()],ce=Object(u["d"])(),le=Object(u["d"])(),de=Object(u["d"])(),ue=Object(u["d"])()},"8c4b":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("38a4");function n(e,t,r){var n;const l=e.byteLength/(4*t),d=new Uint32Array(e,0,l*t);let u=new Uint32Array(l);const h=null!=(n=null==r?void 0:r.minReduction)?n:0,p=(null==r?void 0:r.originalIndices)||null,f=p?p.length:0,b=(null==r?void 0:r.componentOffsets)||null;let m=0;if(b)for(let i=0;i<b.length-1;i++){const e=b[i+1]-b[i];e>m&&(m=e)}else m=l;const g=Math.floor(1.1*m)+1;(null==c||c.length<2*g)&&(c=new Uint32Array(Object(i["j"])(2*g)));for(let i=0;i<2*g;i++)c[i]=0;let v=0;const O=!!b&&!!p,j=O?f:l,y=O?new Uint32Array(f):null,x=1.96;let _=0!==h?Math.ceil(4*x*x/(h*h)*h*(1-h)):j,w=1,S=b?b[1]:j;for(let i=0;i<j;i++){if(i===_){const e=1-v/i;if(e+x*Math.sqrt(e*(1-e)/i)<h)return null;_*=2}if(i===S){for(let e=0;e<2*g;e++)c[e]=0;if(p)for(let e=b[w-1];e<b[w];e++)y[e]=u[p[e]];S=b[++w]}const e=O?p[i]:i,r=e*t,n=a(d,r,t);let o=n%g,l=v;for(;0!==c[2*o+1];){if(c[2*o]===n){const e=c[2*o+1]-1;if(s(d,r,e*t,t)){l=u[e];break}}o++,o>=g&&(o-=g)}l===v&&(c[2*o]=n,c[2*o+1]=e+1,v++),u[e]=l}if(0!==h&&1-v/l<h)return null;if(O){for(let e=b[w-1];e<y.length;e++)y[e]=u[p[e]];u=y}const C=new Uint32Array(t*v);v=0;for(let i=0;i<j;i++)u[i]===v&&(o(d,(O?p[i]:i)*t,C,v*t,t),v++);if(p&&!O){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=u[p[t]];u=e}return{buffer:C.buffer,indices:u,uniqueCount:v}}function s(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function o(e,t,r,i,n){for(let s=0;s<n;s++)r[i+s]=e[t+s]}function a(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},9250:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return j}));var i=r("b2b2"),n=r("d791"),s=r("afe1"),o=r("e431"),a=r("0b2d"),c=r("7577"),l=r("0fc4"),d=r("d18f");class u{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}r("0d9f");function h(e){return Object(i["l"])(e)&&Object(i["l"])(e.dist)}Object(a["f"])();var p=r("89bf"),f=r("b623");const b=1e-5;class m{constructor(e){this.options=new u,this._results=new v,this.transform=new p["a"],this.tolerance=b,this.verticalOffset=null,this._ray=Object(d["c"])(),this._rayEnd=Object(a["f"])(),this._rayBeginTransformed=Object(a["f"])(),this._rayEndTransformed=Object(a["f"])(),this.viewingMode=null==e?1:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay(Object(d["e"])(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&Object(d["b"])(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(o["f"])(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,n,s){this.point=t,this.filterPredicate=n,this.tolerance=null==r?b:r;const o=Object(p["c"])(this.verticalOffset);if(Object(i["l"])(e)&&e.length>0){const t=s?e=>{s(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator&&r.getSpatialQueryAccelerator();Object(i["l"])(e)?(Object(i["l"])(o)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll(e=>t(e))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const r=e.transformation,n=Object(p["c"])(this.verticalOffset);for(const a of t){const{geometry:t,material:c,instanceParameters:l}=a;if(Object(f["d"])(l))continue;const d=t.id;this.transform.setAndInvalidateLazyTransforms(r,a.getShaderTransformation()),Object(o["q"])(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Object(o["q"])(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const u=this.transform.transform;Object(i["l"])(n)&&(n.objectTransform=this.transform),c.intersect(t,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,r,n,o,a,c)=>{if(t>=0){if(Object(i["l"])(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;if(o){if(null==this._results.hud.dist||t<this._results.hud.dist){const i={object:e,geometryId:d,triangleNr:n,center:c};this._results.hud.set(1,i,t,r,s["a"],a)}return}const l=i=>i.set(0,{object:e,geometryId:d,triangleNr:n},t,r,u,a);if((null==this._results.min.drapedLayerOrder||a>=this._results.min.drapedLayerOrder)&&(null==this._results.min.dist||t<this._results.min.dist)&&l(this._results.min),0!==this.options.store&&(null==this._results.max.drapedLayerOrder||a<this._results.max.drapedLayerOrder)&&(null==this._results.max.dist||t>this._results.max.dist)&&l(this._results.max),2===this.options.store){const i=j(this._ray);i.set(0,{object:e,geometryId:d,triangleNr:n},t,r,u),this._results.all.push(i)}}},a.shaderTransformation)}}sortResults(){this._results.all.sort((e,t)=>e.dist!==t.dist?Object(i["u"])(e.dist,0)-Object(i["u"])(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?Object(i["u"])(e.drapedLayerOrder,Number.MAX_VALUE)-Object(i["u"])(t.drapedLayerOrder,Number.MAX_VALUE):Object(i["u"])(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-Object(i["u"])(e.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function g(e){return new m(e)}class v{constructor(){this._min=new O(Object(d["c"])()),this._max=new O(Object(d["c"])()),this._hud=new O(Object(d["c"])()),this._ground=new O(Object(d["c"])())}get min(){return this._min}get max(){return this._max}get hud(){return this._hud}get ground(){return this._ground}init(e){this._min.init(e),this._max.init(e),this._hud.init(e),this._ground.init(e),this.all=[]}}class O{constructor(e){this.intersector=0,this.normal=Object(a["f"])(),this.transformation=Object(s["d"])(),this._ray=Object(d["c"])(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return Object(i["l"])(this.dist)?(Object(o["e"])(y,this.ray.direction,this.dist),Object(o["p"])(y)):null}getIntersectionPoint(e){return!!h(this)&&(Object(o["e"])(y,this.ray.direction,this.dist),Object(o["f"])(e,this.ray.origin,y),!0)}getTransformedNormal(e){return Object(o["k"])(x,this.normal),x[3]=0,Object(c["m"])(x,x,this.transformation),Object(o["k"])(e,x),Object(o["r"])(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=0,Object(d["b"])(e,this._ray)}set(e,t,r,c,l,d,u){this.intersector=e,this.dist=r,Object(o["k"])(this.normal,Object(i["u"])(c,a["b"])),Object(n["d"])(this.transformation,Object(i["u"])(l,s["a"])),this.target=t,this.drapedLayerOrder=d,this.drapedLayerGraphicOrder=u}copy(e){Object(d["b"])(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(o["k"])(this.normal,e.normal),Object(n["d"])(this.transformation,e.transformation)}}function j(e){return new O(e)}const y=Object(a["f"])(),x=Object(l["e"])()},9617:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));var i=r("d047"),n=r("3886");function s(e){e.include(i["a"]),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(n["a"]`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function o(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},9812:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i,n,s,o={exports:{}};i=o,n=function(){function e(e,r,n){n=n||2;var s,o,a,l,d,u,h,p=r&&r.length,f=p?r[0]*n:e.length,b=t(e,0,f,n,!0),m=[];if(!b||b.next===b.prev)return m;if(p&&(b=c(e,r,b,n)),e.length>80*n){s=a=e[0],o=l=e[1];for(var g=n;g<f;g+=n)(d=e[g])<s&&(s=d),(u=e[g+1])<o&&(o=u),d>a&&(a=d),u>l&&(l=u);h=0!==(h=Math.max(a-s,l-o))?1/h:0}return i(b,m,n,s,o,h),m}function t(e,t,r,i,n){var s,o;if(n===A(e,t,r,i)>0)for(s=t;s<r;s+=i)o=D(s,e[s],e[s+1],o);else for(s=r-i;s>=t;s-=i)o=D(s,e[s],e[s+1],o);if(o&&y(o,o.next)){var a=o.next;E(o),o=a}return o}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!y(i,i.next)&&0!==j(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(E(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,c,l,d,u,h){if(e){!h&&u&&f(e,l,d,u);for(var p,b,m=e;e.prev!==e.next;)if(p=e.prev,b=e.next,u?s(e,l,d,u):n(e))t.push(p.i/c),t.push(e.i/c),t.push(b.i/c),E(e),e=b.next,m=b.next;else if((e=b)===m){h?1===h?i(e=o(r(e),t,c),t,c,l,d,u,2):2===h&&a(e,t,c,l,d,u):i(r(e),t,c,l,d,u,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(j(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(v(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&j(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,r,i){var n=e.prev,s=e,o=e.next;if(j(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,c=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,l=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,d=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,u=m(a,c,t,r,i),h=m(l,d,t,r,i),p=e.prevZ,f=e.nextZ;p&&p.z>=u&&f&&f.z<=h;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&j(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=h;){if(f!==e.prev&&f!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&j(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function o(e,t,i){var n=e;do{var s=n.prev,o=n.next.next;!y(s,o)&&x(s,n,n.next,o)&&C(s,o)&&C(o,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(o.i/i),E(n),E(n.next),n=e=o),n=n.next}while(n!==e);return r(n)}function a(e,t,n,s,o,a){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&O(c,l)){var d=P(c,l);return c=r(c,c.next),d=r(d,d.next),i(c,t,n,s,o,a),void i(d,t,n,s,o,a)}l=l.next}c=c.next}while(c!==e)}function c(e,i,n,s){var o,a,c,d=[];for(o=0,a=i.length;o<a;o++)(c=t(e,i[o]*s,o<a-1?i[o+1]*s:e.length,s,!1))===c.next&&(c.steiner=!0),d.push(g(c));for(d.sort(l),o=0;o<d.length;o++)n=r(n=u(d[o],n),n.next);return n}function l(e,t){return e.x-t.x}function d(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function u(e,t){var i=h(e,t);if(!i)return t;var n=P(i,e),s=r(i,i.next);let o=d(n);return r(o,o.next),s=d(s),d(t===i?s:t)}function h(e,t){var r,i=t,n=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;var c,l=r,d=r.x,u=r.y,h=1/0;i=r;do{n>=i.x&&i.x>=d&&n!==i.x&&v(s<u?n:o,s,d,u,s<u?o:n,s,i.x,i.y)&&(c=Math.abs(s-i.y)/(n-i.x),C(i,e)&&(c<h||c===h&&(i.x>r.x||i.x===r.x&&p(r,i)))&&(r=i,h=c)),i=i.next}while(i!==l);return r}function p(e,t){return j(e.prev,e,t.prev)<0&&j(t.next,e,e.next)<0}function f(e,t,r,i){var n=e;do{if(null===n.z&&(n.z=m(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,f(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,b(n)}function b(e){var t,r,i,n,s,o,a,c,l=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,i=r,a=0,t=0;t<l&&(a++,i=i.nextZ);t++);for(c=l;a>0||c>0&&i;)0!==a&&(0===c||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,c--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,l*=2}while(o>1);return e}function m(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function v(e,t,r,i,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function O(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!S(e,t)&&(C(e,t)&&C(t,e)&&T(e,t)&&(j(e.prev,e,t.prev)||j(e,t.prev,t))||y(e,t)&&j(e.prev,e,e.next)>0&&j(t.prev,t,t.next)>0)}function j(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,r,i){var n=w(j(e,t,r)),s=w(j(e,t,i)),o=w(j(r,i,e)),a=w(j(r,i,t));return n!==s&&o!==a||!(0!==n||!_(e,r,t))||!(0!==s||!_(e,i,t))||!(0!==o||!_(r,e,i))||!(0!==a||!_(r,t,i))}function _(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function w(e){return e>0?1:e<0?-1:0}function S(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&x(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function C(e,t){return j(e.prev,e,e.next)<0?j(e,t,e.next)>=0&&j(e,e.prev,t)>=0:j(e,t,e.prev)<0||j(e,e.next,t)<0}function T(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function P(e,t){var r=new R(e.i,e.x,e.y),i=new R(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function D(e,t,r,i){var n=new R(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,r,i){for(var n=0,s=t,o=r-i;s<r;s+=i)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,o=Math.abs(A(e,0,s,r));if(n)for(var a=0,c=t.length;a<c;a++){var l=t[a]*r,d=a<c-1?t[a+1]*r:e.length;o-=Math.abs(A(e,l,d,r))}var u=0;for(a=0;a<i.length;a+=3){var h=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;u+=Math.abs((e[h]-e[f])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[f+1]-e[h+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)r.vertices.push(e[n][s][o]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e},void 0!==(s=n())&&(i.exports=s);const a=o.exports},"9a68":function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return b}));var i=r("d272"),n=r("e6aa"),s=r("c2d1"),o=r("d047"),a=r("6750"),c=r("c6d7"),l=r("c51b"),d=r("ebd5"),u=r("4377"),h=r("3886"),p=r("690a");const f=1;function b(e){const t=new p["a"],r=e.stippleEnabled&&e.roundCaps,b=e.falloffEnabled||r,m=e.innerColorEnabled,g=e.stippleEnabled&&e.stippleScaleWithLineWidth||e.roundCaps,v=e.stippleEnabled&&e.stippleScaleWithLineWidth;return t.extensions.add("GL_OES_standard_derivatives"),t.include(l["a"]),t.include(n["a"],e),t.include(a["a"],{...e,stippleRequiresStretchMeasure:r}),1===e.output&&t.include(s["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),g&&t.varyings.add("vLineWidth","float"),v&&t.varyings.add("vLineSizeInv","float"),m&&t.varyings.add("vLineDistance","float"),b&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),e.roundCaps&&t.varyings.add("vCapPosition","vec2"),r&&t.varyings.add("vStipplePatternStretch","float"),t.vertex.code.add(h["a"]`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(h["a"]`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(h["a"]`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(h["a"]`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;
    vpos = position;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${g?h["a"]`vLineWidth = lineWidth;`:""}
      ${v?h["a"]`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),e.stippleEnabled&&t.vertex.code.add(h["a"]`float isEndVertex = float(!isStartVertex);
vec4 segmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), isEndVertex);
vec2 segmentOrigin = segmentInfo.xy;
vec2 segment = segmentInfo.zw;`),t.vertex.code.add(h["a"]`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(h["a"]`
        vec2 startDir;
        vec2 endDir;

        if (leftLen < 0.001) {
          startDir = right;
        }
        else{
          startDir = left;
        }
        startDir = normalize(startDir);
        startDir = PERPENDICULAR(startDir);

        if (rightLen < 0.001) {
          endDir = left;
        }
        else{
          endDir = right;
        }
        endDir = normalize(endDir);
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?h["a"]`min(1.0, subdivisionFactor * ${h["a"].float((f+2)/(f+1))})`:h["a"]`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):t.vertex.code.add(h["a"]`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(h["a"]`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;
capDisplacementDir *= subdivisionFactor;
}`),t.vertex.code.add(h["a"]`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${b||m?h["a"]`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${m?h["a"]`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${b?h["a"]`vLineDistanceNorm = lineDistNorm;`:""}

    ${e.roundCaps?h["a"]`vCapPosition = isJoin ? vec2(0.0) : dpos;`:""}

    pos.xy += dpos;
  `),e.stippleEnabled&&(e.draped||t.vertex.code.add(h["a"]`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(h["a"]`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));`),e.draped?t.vertex.code.add(h["a"]`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):t.vertex.code.add(h["a"]`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(h["a"]`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      // The 0.5 factor on the screen length is to correct for pixel ratio (it is calculated at double resolution)
      ${r?h["a"]`
            vec3 stippleSegmentInfo = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
            vStippleDistanceLimits = stippleSegmentInfo.xy;
            vStipplePatternStretch = stippleSegmentInfo.z;`:h["a"]`
            vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);`}

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;
    `)),t.vertex.code.add(h["a"]`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`),e.multipassTerrainEnabled&&(t.fragment.include(o["a"]),t.include(c["b"],e)),t.include(i["a"],e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(u["a"]),t.fragment.code.add(h["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.roundCaps&&t.fragment.code.add(h["a"]`
    float fragmentRadius = length(vCapPosition);
    float fragmentSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
    float capCoverage = clamp(0.5 - fragmentSDF, 0.0, 1.0);
    if (capCoverage < ${h["a"].float(d["c"])}) {
      discard;
    }
  `),r?t.fragment.code.add(h["a"]`
      vec2 stipplePosition = vec2(
        max(1.0 - getStippleSDF() * 2.0 * vStipplePatternStretch, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${h["a"].float(d["c"])}, stippleCoverage);
    `):t.fragment.code.add(h["a"]`float stippleAlpha = getStippleAlpha();`),t.fragment.code.add(h["a"]`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),t.fragment.uniforms.add("pixelRatio","float"),e.innerColorEnabled&&t.fragment.code.add(h["a"]`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),t.fragment.code.add(h["a"]`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(h["a"]`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`),t.fragment.code.add(h["a"]`
    if (finalColor.a < ${h["a"].float(d["c"])}) {
      discard;
    }

    ${7===e.output?h["a"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?h["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?h["a"]`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?h["a"]`outputDepth(linearDepth);`:""}
  }
  `),t}const m=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:f,build:b})},a6c9:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return l}));r("c120");var i=r("661c");function n(e,t,r){switch(e){case"circle":default:return s(t,r);case"square":return o(t,r);case"cross":return c(t,r);case"x":return l(t,r);case"kite":return a(t,r);case"triangle":return d(t,r)}}function s(e,t){const r=e,n=new Uint8Array(4*r*r),s=r/2-.5,o=t/2;for(let a=0;a<r;a++)for(let t=0;t<r;t++){const c=t+r*a,l=t-s,d=a-s;let u=Math.sqrt(l*l+d*d)-o;u=u/e+.5,Object(i["a"])(u,n,4*c)}return n}function o(e,t){return u(e,t,!1)}function a(e,t){return u(e,t,!0)}function c(e,t){return h(e,t,!1)}function l(e,t){return h(e,t,!0)}function d(e,t){const r=new Uint8Array(4*e*e),n=1,s=-.5,o=Math.sqrt(n*n+s*s),a=(e-t)/2;for(let c=0;c<e;c++)for(let l=0;l<e;l++){const d=c*e+l,u=(l-a)/t,h=(c-a+.75)/t,p=-(n*u+s*h)/o,f=(n*(u-1)+s*-h)/o,b=-h,m=Math.max(p,f,b);Object(i["a"])(m*t/e+.5,r,4*d)}return r}function u(e,t,r){r&&(t/=Math.SQRT2);const n=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let o=0;o<e;o++){let a=o-.5*e+.25,c=.5*e-s-.75;const l=s*e+o;if(r){const e=(a+c)/Math.SQRT2;c=(c-a)/Math.SQRT2,a=e}let d=Math.max(Math.abs(a),Math.abs(c))-.5*t;d=d/e+.5,Object(i["a"])(d,n,4*l)}return n}function h(e,t,r){r&&(t*=Math.SQRT2);const n=.5*t,s=new Uint8Array(4*e*e);for(let o=0;o<e;o++)for(let t=0;t<e;t++){let a=t-.5*e,c=.5*e-o-1;const l=o*e+t;if(r){const e=(a+c)/Math.SQRT2;c=(c-a)/Math.SQRT2,a=e}let d;a=Math.abs(a),c=Math.abs(c),d=a>c?a>n?Math.sqrt((a-n)*(a-n)+c*c):c:c>n?Math.sqrt(a*a+(c-n)*(c-n)):a,d=d/e+.5,Object(i["a"])(d,s,4*l)}return s}},adf1:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r("b2b2"),n=r("f2e0"),s=r("afe1"),o=r("e431"),a=r("0b2d"),c=r("8188"),l=r("0278"),d=r("7abc"),u=r("5a22"),h=r("748f"),p=r("86ba");class f{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Object(n["a"])()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){if(Object(i["l"])(b))return this._origins.set(this._rootOriginId,Object(d["a"])(b[0],b[1],b[2],this._rootOriginId)),this.getOrigin(e);const t=Object(d["a"])(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,t),t}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),a=Math.round(e[2]/r),c=`${n}/${s}/${a}`;let l=this._origins.get(c);const u=.5*r;if(Object(o["j"])(m,e,t.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),m[0]<u&&m[1]<u&&m[2]<u){if(l){const t=Math.max(...m);if(Object(o["j"])(m,e,l.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),Math.max(...m)<t)return l}return t}return l||(l=Object(d["a"])(n*r,s*r,a*r,c),this._origins.set(c,l)),l}_drawOriginBox(e,t=[1,1,0,1]){const r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new p["a"]({width:2,color:t}),i.add(this._material);const e=new h["a"]({isPickable:!1}),r=new u["a"]({castShadow:!1});i.add(r),e.add(r),i.add(e),this._objects.set(n,r)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],d=a.length,f=new Array(3*d),b=new Uint16Array(2*(d-1)),m=.5*this._gridSize;for(let s=0;s<d;s++)f[3*s+0]=e[0]+(1&a[s]?m:-m),f[3*s+1]=e[1]+(2&a[s]?m:-m),f[3*s+2]=e[2]+(4&a[s]?m:-m),s>0&&(b[2*s+0]=s-1,b[2*s+1]=s);Object(c["k"])(f,this._originSR,0,f,r.renderSpatialReference,0,d);const g=new l["a"]([["position",{size:3,data:f,exclusive:!0}]],[["position",b]],2);i.add(g),o.addGeometry(g,this._material,s["a"])}}let b=null;const m=Object(a["f"])()},b061:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r("b2b2");class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach((e,t)=>{Object(i["l"])(e)&&this._repository.release(this._material,s(t))})}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,s(t)));const r=this._map.get(t);if(Object(i["l"])(r)){if(2===r.ensureResources(e))return r;this._repository.requestRender()}return null}}function s(e){switch(e){default:case 0:return 0;case 1:return 7;case 4:case 7:case 6:return 3;case 3:return 2;case 2:return 1;case 5:return 4}}},b4c8:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n=r("dae5"),s=r("47f8");!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(s["c"])(1,1,1),vvSizeMaxSize:Object(s["c"])(100,100,100),vvSizeOffset:Object(s["c"])(0,0,0),vvSizeFactor:Object(s["c"])(1,1,1),vvSizeValue:Object(s["c"])(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(n["b"])()}}(i||(i={}));const o=i},b855:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var i=r("02f1"),n=r("35b3");const s={waveStrength:.06,waveTextureRepeat:32,waveDirection:Object(i["e"])(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...n["b"]},o={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}},ba58:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return D})),r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return E})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return P})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return R})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return T}));var i=r("b2b2"),n=r("d791"),s=r("afe1"),o=r("02f1"),a=r("0b2d"),c=r("7577"),l=r("0fc4"),d=r("8188"),u=r("4261"),h=r("9180"),p=r("57e5"),f=r("32ed"),b=r("1a54"),m=r("d3cf");function g(e,t){if("point"===e.type)return y(e,t,!1);if(Object(m["d"])(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(v(e),t,!0);case"mesh":return y(e.origin,t,!1)}else switch(e.type){case"extent":return y(O(e),t,!0);case"polygon":return y(j(e),t,!0);case"polyline":return y(v(e),t,!0)}}function v(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=Object(f["f"])(t,Object(f["e"])(t)/2);return Object(b["g"])(r[0],r[1],r[2],e.spatialReference)}function O(e){const t=isFinite(e.zmin);return Object(b["g"])(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function j(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=Object(p["b"])(e.rings,e.hasZ);return Object(b["g"])(r[0],r[1],r[2],e.spatialReference)}function y(e,t,r){const i=r?e:Object(m["a"])(e);return t&&e?Object(d["m"])(e,i,t)?i:null:i}function x(e,t,r,i=0){if(e){t||(t=Object(h["l"])());const n=e;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),Object(c["l"])(t,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),t}return null}function _(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute("auxpos1");i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[r]))}}function w(e,t){const r=Object(l["d"])(l["a"]);return Object(i["l"])(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),Object(i["l"])(t)?r[3]=t:Object(i["l"])(e)&&e.length>3&&(r[3]=e[3]),r}function S(e=a["a"],t,r,n=1){const s=new Array(3);if(Object(i["k"])(t)||Object(i["k"])(r))s[0]=1,s[1]=1,s[2]=1;else{let i,n=0;for(let o=2;o>=0;o--){const a=e[o];let c;const l=null!=a,d=0===o&&!i&&!l,u=r[o];"symbol-value"===a||d?c=0!==u?t[o]/u:1:l&&"proportional"!==a&&isFinite(a)&&(c=0!==u?a/u:1),null!=c&&(s[o]=c,i=c,n=Math.max(n,Math.abs(c)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=i:0===s[e]&&(s[e]=.001*n)}for(let i=2;i>=0;i--)s[i]/=n;return Object(a["g"])(s)}function C(e){return null!=e.isPrimitive}function T(e){return C(e)&&(e=[e.width,e.depth,e.height]),P(e)?null:"Symbol sizes may not be negative values"}function P(e){if(Array.isArray(e)){for(const t of e)if(!P(t))return!1;return!0}return null==e||e>=0}function D(e,t,r,i=Object(s["d"])()){const o=e||0,a=t||0,c=r||0;return 0!==o&&Object(n["r"])(i,i,-o/180*Math.PI),0!==a&&Object(n["e"])(i,i,a/180*Math.PI),0!==c&&Object(n["k"])(i,i,c/180*Math.PI),i}function E(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(u["s"])(e)?t.minDemResolutionForPoints:.01*Object(u["t"])(e)}const R={"bottom-left":Object(o["e"])(0,0),bottom:Object(o["e"])(.5,0),"bottom-right":Object(o["e"])(1,0),left:Object(o["e"])(0,.5),center:Object(o["e"])(.5,.5),right:Object(o["e"])(1,.5),"top-left":Object(o["e"])(0,1),top:Object(o["e"])(.5,1),"top-right":Object(o["e"])(1,1)}},bea9:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("f2e0");class n{constructor(e){this.channel=e,this.id=Object(i["a"])()}}},caf7:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i,n=r("e431"),s=r("47f8"),o=r("0b2d"),a=r("7289"),c=r("d18f");!function(e){function t(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)}function r(e,t){const r=e[t],i=e[t+1],n=e[t+2],s=1/Math.sqrt(r*r+i*i+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s}function i(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r}function n(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]+r[i],n[s+1]=e[t+1]+r[i+1],n[s+2]=e[t+2]+r[i+2]}function s(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]-r[i],n[s+1]=e[t+1]-r[i+1],n[s+2]=e[t+2]-r[i+2]}e.length=t,e.normalize=r,e.scale=i,e.add=n,e.subtract=s}(i||(i={}));var l=r("0278"),d=r("1038"),u=r("1153");const h=i;var p,f,b,m;!function(e){const t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],s=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)o[6*l+e]=l;const a=new Uint16Array(36);for(let l=0;l<6;l++)a[6*l+0]=0,a[6*l+1]=1,a[6*l+2]=2,a[6*l+3]=2,a[6*l+4]=3,a[6*l+5]=0;function c(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let i=0;i<8;i++)t[3*i]=r[i][0]*e[0],t[3*i+1]=r[i][1]*e[1],t[3*i+2]=r[i][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}],["uv0",{size:2,data:n}]],[["position",s],["normal",o],["uv0",a]])}e.createGeometry=c}(p||(p={})),function(e){const t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),s=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let i=0;i<6;i++)t[3*i]=r[i][0]*e[0],t[3*i+1]=r[i][1]*e[1],t[3*i+2]=r[i][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}]],[["position",n],["normal",s]])}e.createGeometry=o}(f||(f={})),function(e){const t=.5,r=0,i=Object(s["c"])(-t,r,-t),o=Object(s["c"])(t,r,-t),a=Object(s["c"])(0,r,t),c=Object(s["c"])(0,r+t,0),d=Object(s["b"])(),u=Object(s["b"])(),h=Object(s["b"])(),p=Object(s["b"])(),f=Object(s["b"])();Object(n["j"])(d,i,c),Object(n["j"])(u,i,o),Object(n["g"])(h,d,u),Object(n["r"])(h,h),Object(n["j"])(d,o,c),Object(n["j"])(u,o,a),Object(n["g"])(p,d,u),Object(n["r"])(p,p),Object(n["j"])(d,a,c),Object(n["j"])(u,a,i),Object(n["g"])(f,d,u),Object(n["r"])(f,f);const b=[i,o,a,c],m=[0,-1,0,h[0],h[1],h[2],p[0],p[1],p[2],f[0],f[1],f[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function O(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let r=0;r<4;r++)t[3*r]=b[r][0]*e[0],t[3*r+1]=b[r][1]*e[1],t[3*r+2]=b[r][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:m}]],[["position",new Uint16Array(g)],["normal",new Uint16Array(v)]])}e.createGeometry=O}(b||(b={})),function(e){function t(e,t,r,i={uv:!0}){const n=-Math.PI,s=2*Math.PI,o=-Math.PI/2,a=Math.PI,c=Math.max(3,Math.floor(t)),d=Math.max(2,Math.floor(r)),u=(c+1)*(d+1),h=new Float32Array(3*u),p=new Float32Array(3*u),f=new Float32Array(2*u),b=[];let m=0;for(let l=0;l<=d;l++){const t=[],r=l/d,i=o+r*a,u=Math.cos(i);for(let o=0;o<=c;o++){const a=o/c,l=n+a*s,d=Math.cos(l)*u,b=Math.sin(i),g=-Math.sin(l)*u;h[3*m]=d*e,h[3*m+1]=b*e,h[3*m+2]=g*e,p[3*m]=d,p[3*m+1]=b,p[3*m+2]=g,f[2*m]=a,f[2*m+1]=r,t.push(m),++m}b.push(t)}const g=new Uint32Array(2*c*(d-1)*3);m=0;for(let l=0;l<d;l++)for(let e=0;e<c;e++){const t=b[l][e],r=b[l][e+1],i=b[l+1][e+1],n=b[l+1][e];0===l?(g[m++]=t,g[m++]=i,g[m++]=n):l===d-1?(g[m++]=t,g[m++]=r,g[m++]=i):(g[m++]=t,g[m++]=r,g[m++]=i,g[m++]=i,g[m++]=n,g[m++]=t)}const v=[["position",g],["normal",g]],O=[["position",{size:3,data:h,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]];return i.uv&&(O.push(["uv0",{size:2,data:f,exclusive:!0}]),v.push(["uv0",g])),i.offset&&(v[0][0]="offset",O[0][0]="offset",v.push(["position",new Uint32Array(g.length)]),O.push(["position",{size:3,data:Float64Array.from(i.offset),exclusive:!0}])),new l["a"](O,v)}function r(e,t,r){const i=e;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let l=0;l<n.length;l+=3)h.scale(n,l,e/h.length(n,l));let o={};function a(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(o[i])return o[i];let s=n.length;return n.length+=3,h.add(n,3*t,n,3*r,n,s),h.scale(n,s,e/h.length(n,s)),s/=3,o[i]=s,s}for(let l=0;l<t;l++){const e=s.length,t=new Uint32Array(4*e);for(let r=0;r<e;r+=3){const e=s[r],i=s[r+1],n=s[r+2],o=a(e,i),c=a(i,n),l=a(n,e),d=4*r;t[d]=e,t[d+1]=o,t[d+2]=l,t[d+3]=i,t[d+4]=c,t[d+5]=o,t[d+6]=n,t[d+7]=l,t[d+8]=c,t[d+9]=o,t[d+10]=c,t[d+11]=l}s=t,o={}}const c=new Float32Array(n);for(let l=0;l<c.length;l+=3)h.normalize(c,l);const d=[["position",s],["normal",s]],u=[["position",{size:3,data:new Float32Array(n),exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}]];return new l["a"](u,d)}function i(e,t,r,i,n,s,o){const a=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];s=s||[0,0];const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],u=null!=i&&2===i.length?i:[1,1],h=[["position",{size:3,data:a,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:s.length,data:s}],["color",{size:4,data:d,exclusive:!0}],["size",{size:2,data:u}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);h.push(["auxpos1",{size:4,data:e}])}if(null!=o){const e=new Float32Array([o[0],o[1],o[2],o[3]]);h.push(["auxpos2",{size:4,data:e}])}return new l["a"](h,null,1)}function m(e,t,r,i,n,s,o,a){if(null!=e){const{data:t}=a.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=a.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=r){const{data:e}=a.getMutableAttribute("color");e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3]}if(null!=i){const{data:e}=a.getMutableAttribute("size");e[0]=i[0],e[1]=i[1]}if(null!=n){const{data:e}=a.getMutableAttribute("auxpos1");e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=s){const{data:e}=a.getMutableAttribute("uv0");e[0]=s[0],e[1]=s[1]}if(null!=o){const{data:e}=a.getMutableAttribute("auxpos2");e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3]}}function O(e,t){const r=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let o=0;o<e.length;o++)r[3*o]=e[o][0],r[3*o+1]=e[o][1],r[3*o+2]=e[o][2],t&&(i[3*o]=t[o][0],i[3*o+1]=t[o][1],i[3*o+2]=t[o][2]),n[o]=o,s[o]=0;return t||(i[0]=0,i[1]=1,i[2]=0),new l["a"]([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",n],["normal",t?n:s],["uv0",s]],1)}function j(){const e=[0,0,0,0,0,100,100,0,0],t=new Uint16Array([0,1,2]),r=[0,1,0],i=new Uint16Array([0,0,0]),n=[0,0],s=new Uint16Array([0,0,0]);return new l["a"]([["position",{size:3,data:e,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:n,exclusive:!0}]],[["position",t],["normal",i],["uv0",s]])}e.createBoxGeometry=p.createGeometry,e.createDiamondGeometry=f.createGeometry,e.createTetrahedronGeometry=b.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=r,e.createPointGeometry=i,e.updatePointGeometry=m,e.createPointArrayGeometry=O,e.createTriangleGeometry=j;const y=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function x(e=y){const t=new Array(12);for(let s=0;s<4;s++)for(let r=0;r<3;r++)t[3*s+r]=e[s][r];const r=new Uint32Array([0,1,2,2,3,0]),i=[0,0,1],n=new Uint32Array([0,0,0,0,0,0]);return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",r],["normal",n],["uv0",r],["color",n]])}function _(e,t,r,i,n=!0,o=!0){let a=0;const c=t,d=e;let u=Object(s["c"])(0,a,0),h=Object(s["c"])(0,a+d,0),p=Object(s["c"])(0,-1,0),f=Object(s["c"])(0,1,0);i&&(a=d,h=Object(s["c"])(0,0,0),u=Object(s["c"])(0,a,0),p=Object(s["c"])(0,1,0),f=Object(s["c"])(0,-1,0));const b=[h,u],m=[p,f],g=r+2,v=Math.sqrt(d*d+c*c);if(i)for(let l=r-1;l>=0;l--){const e=l*(2*Math.PI/r),t=Object(s["c"])(Math.cos(e)*c,a,Math.sin(e)*c);b.push(t);const i=Object(s["c"])(d*Math.cos(e)/v,-c/v,d*Math.sin(e)/v);m.push(i)}else for(let l=0;l<r;l++){const e=l*(2*Math.PI/r),t=Object(s["c"])(Math.cos(e)*c,a,Math.sin(e)*c);b.push(t);const i=Object(s["c"])(d*Math.cos(e)/v,c/v,d*Math.sin(e)/v);m.push(i)}const O=new Uint32Array(2*(r+2)*3),j=new Uint32Array(2*(r+2)*3);let y=0,x=0;if(n){for(let e=3;e<b.length;e++)O[y++]=1,O[y++]=e-1,O[y++]=e,j[x++]=0,j[x++]=0,j[x++]=0;O[y++]=b.length-1,O[y++]=2,O[y++]=1,j[x++]=0,j[x++]=0,j[x++]=0}if(o){for(let e=3;e<b.length;e++)O[y++]=e,O[y++]=e-1,O[y++]=0,j[x++]=e,j[x++]=e-1,j[x++]=1;O[y++]=0,O[y++]=2,O[y++]=b.length-1,j[x++]=1,j[x++]=2,j[x++]=m.length-1}const _=new Float32Array(3*g);for(let s=0;s<g;s++)_[3*s]=b[s][0],_[3*s+1]=b[s][1],_[3*s+2]=b[s][2];const w=new Float32Array(3*g);for(let s=0;s<g;s++)w[3*s]=m[s][0],w[3*s+1]=m[s][1],w[3*s+2]=m[s][2];return new l["a"]([["position",{size:3,data:_,exclusive:!0}],["normal",{size:3,data:w,exclusive:!0}]],[["position",O],["normal",j]])}function w(e,t,r,i,o,a){const c=i?Object(s["a"])(i):Object(s["c"])(1,0,0),d=o?Object(s["a"])(o):Object(s["c"])(0,0,0);a=null==a||a;const u=Object(s["b"])();Object(n["r"])(u,c);const h=Object(s["b"])();Object(n["e"])(h,u,Math.abs(e));const p=Object(s["b"])();Object(n["e"])(p,h,-.5),Object(n["f"])(p,p,d);const f=Object(s["c"])(0,1,0);Math.abs(1-Object(n["h"])(u,f))<.2&&Object(n["w"])(f,0,0,1);const b=Object(s["b"])();Object(n["g"])(b,u,f),Object(n["r"])(b,b),Object(n["g"])(f,b,u);const m=2*r+(a?2:0),g=r+(a?2:0),v=new Float32Array(3*m),O=new Float32Array(3*g),j=new Float32Array(2*m),y=new Uint32Array(3*r*(a?4:2)),x=new Uint32Array(3*r*(a?4:2));a&&(v[3*(m-2)+0]=p[0],v[3*(m-2)+1]=p[1],v[3*(m-2)+2]=p[2],j[2*(m-2)]=0,j[2*(m-2)+1]=0,v[3*(m-1)+0]=v[3*(m-2)+0]+h[0],v[3*(m-1)+1]=v[3*(m-2)+1]+h[1],v[3*(m-1)+2]=v[3*(m-2)+2]+h[2],j[2*(m-1)]=1,j[2*(m-1)+1]=1,O[3*(g-2)+0]=-u[0],O[3*(g-2)+1]=-u[1],O[3*(g-2)+2]=-u[2],O[3*(g-1)+0]=u[0],O[3*(g-1)+1]=u[1],O[3*(g-1)+2]=u[2]);const _=function(e,t,r){y[e]=t,x[e]=r};let w=0;const S=Object(s["b"])(),C=Object(s["b"])();for(let s=0;s<r;s++){const e=s*(2*Math.PI/r);Object(n["e"])(S,f,Math.sin(e)),Object(n["e"])(C,b,Math.cos(e)),Object(n["f"])(S,S,C),O[3*s+0]=S[0],O[3*s+1]=S[1],O[3*s+2]=S[2],Object(n["e"])(S,S,t),Object(n["f"])(S,S,p),v[3*s+0]=S[0],v[3*s+1]=S[1],v[3*s+2]=S[2],j[2*s+0]=s/r,j[2*s+1]=0,v[3*(s+r)+0]=v[3*s+0]+h[0],v[3*(s+r)+1]=v[3*s+1]+h[1],v[3*(s+r)+2]=v[3*s+2]+h[2],j[2*(s+r)+0]=s/r,j[2*s+1]=1;const i=(s+1)%r;_(w++,s,s),_(w++,s+r,s),_(w++,i,i),_(w++,i,i),_(w++,s+r,s),_(w++,i+r,i)}if(a){for(let e=0;e<r;e++){const t=(e+1)%r;_(w++,m-2,g-2),_(w++,e,g-2),_(w++,t,g-2)}for(let e=0;e<r;e++){const t=(e+1)%r;_(w++,e+r,g-1),_(w++,m-1,g-1),_(w++,t+r,g-1)}}return new l["a"]([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:O,exclusive:!0}],["uv0",{size:2,data:j,exclusive:!0}]],[["position",y],["normal",x],["uv0",y]])}function S(t,r,i,n,s){i=i||10,n=null==n||n,Object(u["a"])(t.length>1);const o=[[0,0,0]],a=[],c=[];for(let e=0;e<i;e++){a.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;c.push([Math.cos(t)*r,Math.sin(t)*r])}return e.createPathExtrusionGeometry(c,t,o,a,n,s)}function C(e,t,r,i,d,u=Object(s["c"])(0,0,0)){const h=e.length,p=new Float32Array(t.length*h*3+(6*r.length||0)),f=new Float32Array(t.length*h*3+(r?6:0)),b=(t.length-1)*h*6+3*i.length*2,m=new Uint32Array(b),v=new Uint32Array(b);let O=0,j=0,y=0,x=0;const _=Object(s["b"])(),w=Object(s["b"])(),S=Object(s["b"])(),C=Object(s["b"])(),T=Object(s["b"])(),P=Object(s["b"])(),D=Object(s["b"])(),E=Object(o["f"])(),R=Object(s["b"])(),z=Object(s["b"])(),M=Object(s["b"])(),L=Object(s["b"])(),F=Object(s["b"])(),I=Object(a["d"])();Object(n["w"])(R,0,1,0),Object(n["j"])(w,t[1],t[0]),Object(n["r"])(w,w),d?(Object(n["f"])(E,t[0],u),Object(n["r"])(S,E)):Object(n["w"])(S,0,0,1),A(w,S,R,R,T,S,g),Object(n["k"])(C,S),Object(n["k"])(L,T);for(let s=0;s<r.length;s++)Object(n["e"])(P,T,r[s][0]),Object(n["e"])(E,S,r[s][2]),Object(n["f"])(P,P,E),Object(n["f"])(P,P,t[0]),p[O++]=P[0],p[O++]=P[1],p[O++]=P[2];f[j++]=-w[0],f[j++]=-w[1],f[j++]=-w[2];for(let n=0;n<i.length;n++)m[y++]=i[n][0]>0?i[n][0]:-i[n][0]-1+r.length,m[y++]=i[n][1]>0?i[n][1]:-i[n][1]-1+r.length,m[y++]=i[n][2]>0?i[n][2]:-i[n][2]-1+r.length,v[x++]=0,v[x++]=0,v[x++]=0;let U=r.length;const V=r.length-1;for(let s=0;s<t.length;s++){let r=!1;s>0&&(Object(n["k"])(_,w),s<t.length-1?(Object(n["j"])(w,t[s+1],t[s]),Object(n["r"])(w,w)):r=!0,Object(n["f"])(z,_,w),Object(n["r"])(z,z),Object(n["f"])(M,t[s-1],C),Object(a["g"])(t[s],z,I),Object(a["m"])(I,Object(c["g"])(M,_),E)?(Object(n["j"])(E,E,t[s]),Object(n["r"])(S,E),Object(n["g"])(T,z,S),Object(n["r"])(T,T)):A(z,C,L,R,T,S,g),Object(n["k"])(C,S),Object(n["k"])(L,T)),d&&(Object(n["f"])(E,t[s],u),Object(n["r"])(F,E));for(let i=0;i<h;i++)if(Object(n["e"])(P,T,e[i][0]),Object(n["e"])(E,S,e[i][1]),Object(n["f"])(P,P,E),Object(n["r"])(D,P),f[j++]=D[0],f[j++]=D[1],f[j++]=D[2],Object(n["f"])(P,P,t[s]),p[O++]=P[0],p[O++]=P[1],p[O++]=P[2],!r){const e=(i+1)%h;m[y++]=U+i,m[y++]=U+h+i,m[y++]=U+e,m[y++]=U+e,m[y++]=U+h+i,m[y++]=U+h+e;for(let t=0;t<6;t++)v[x++]=m[y-6+t]-V}U+=h}const N=t[t.length-1];for(let s=0;s<r.length;s++)Object(n["e"])(P,T,r[s][0]),Object(n["e"])(E,S,r[s][1]),Object(n["f"])(P,P,E),Object(n["f"])(P,P,N),p[O++]=P[0],p[O++]=P[1],p[O++]=P[2];const q=j/3;f[j++]=w[0],f[j++]=w[1],f[j++]=w[2];const W=U-h;for(let n=0;n<i.length;n++)m[y++]=i[n][0]>=0?U+i[n][0]:-i[n][0]-1+W,m[y++]=i[n][2]>=0?U+i[n][2]:-i[n][2]-1+W,m[y++]=i[n][1]>=0?U+i[n][1]:-i[n][1]-1+W,v[x++]=q,v[x++]=q,v[x++]=q;return new l["a"]([["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:f,exclusive:!0}]],[["position",m],["normal",v]])}function T(e,t,r){Object(u["a"])(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(u["a"])(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(u["a"])(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(u["a"])(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const i=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let s=0,o=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)i[s++]=e[l][t];l>0&&(n[o++]=l-1,n[o++]=l)}const a=[],c=[];if(a.push(["position",n]),c.push(["position",{size:3,data:i,exclusive:!0}]),t){const r=new Float32Array(3*t.length);let i=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)r[i++]=t[n][e];a.push(["normal",n]),c.push(["normal",{size:3,data:r,exclusive:!0}])}return r&&(c.push(["color",{size:4,data:r}]),a.push(["color",Object(d["d"])(r.length/4)])),new l["a"](c,a,2)}function P(e,t,r,i,n=0){const s=new Array(18),o=[[-t,n,i/2],[r,n,i/2],[0,e+n,i/2],[-t,n,-i/2],[r,n,-i/2],[0,e+n,-i/2]],a=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)s[3*c]=o[c][0],s[3*c+1]=o[c][1],s[3*c+2]=o[c][2];return new l["a"]([["position",{size:3,data:s,exclusive:!0}]],[["position",a]])}function D(e,t){const r=e.getMutableAttribute("position").data;for(let i=0;i<r.length;i+=3){const e=r[i],s=r[i+1],o=r[i+2];Object(n["w"])(v,e,s,o),Object(n["q"])(v,v,t),r[i]=v[0],r[i+1]=v[1],r[i+2]=v[2]}}function E(e,t=e){const r=e.vertexAttributes,i=r.get("position").data,n=r.get("normal").data;if(n){const e=t.getMutableAttribute("normal").data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute("position").data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}return t}function R(e,t,r,i,s){return!(Math.abs(Object(n["h"])(t,e))>s)&&(Object(n["g"])(r,e,t),Object(n["r"])(r,r),Object(n["g"])(i,r,e),Object(n["r"])(i,i),!0)}function A(e,t,r,i,n,s,o){return R(e,t,n,s,o)||R(e,r,n,s,o)||R(e,i,n,s,o)}e.createSquareGeometry=x,e.createConeGeometry=_,e.createCylinderGeometry=w,e.createTubeGeometry=S,e.createPathExtrusionGeometry=C,e.createPolylineGeometry=T,e.createExtrudedTriangle=P,e.transformInPlace=D,e.cgToGIS=E,e.makeOrthoBasisDirUp=R,e.makeOrthoBasisDirUpFallback=A}(m||(m={}));const g=.99619469809,v=Object(s["b"])(),O=m},d0cb:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var i=r("2f98"),n=r("3886");function s(e,t){const r=e;r.include(i["a"]),r.attributes.add("position","vec3"),r.attributes.add("normal","vec3"),r.attributes.add("auxpos1","vec4"),r.vertex.uniforms.add("proj","mat4"),r.vertex.uniforms.add("view","mat4"),r.vertex.uniforms.add("viewNormal","mat4"),r.vertex.uniforms.add("viewport","vec4"),r.vertex.uniforms.add("camPos","vec3"),r.vertex.uniforms.add("polygonOffset","float"),r.vertex.uniforms.add("cameraGroundRelative","float"),r.vertex.uniforms.add("pixelRatio","float"),r.vertex.uniforms.add("perDistancePixelRatio","float"),r.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&r.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),r.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),r.vertex.constants.add("smallOffsetAngle","float",.984807753012208),r.vertex.code.add(n["a"]`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.vertex.code.add(n["a"]`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||r.vertex.code.add(n["a"]`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),r.vertex.code.add(n["a"]`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?n["a"]`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?n["a"]`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.vertex.code.add(n["a"]`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function o(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},d359:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return v})),r.d(t,"e",(function(){return g}));var i=r("2119"),n=r("d791"),s=r("e431"),o=r("0b2d"),a=r("7577"),c=r("0fc4"),l=r("4f8b"),d=r("7289"),u=r("7361");function h(e){return e?[Object(d["d"])(e[0]),Object(d["d"])(e[1]),Object(d["d"])(e[2]),Object(d["d"])(e[3]),Object(d["d"])(e[4]),Object(d["d"])(e[5])]:[Object(d["d"])(),Object(d["d"])(),Object(d["d"])(),Object(d["d"])(),Object(d["d"])(),Object(d["d"])()]}function p(){return[Object(o["f"])(),Object(o["f"])(),Object(o["f"])(),Object(o["f"])(),Object(o["f"])(),Object(o["f"])(),Object(o["f"])(),Object(o["f"])()]}function f(e,t=h()){for(let r=0;r<6;r++)Object(d["c"])(e[r],t[r])}function b(e,t,r,i=j){const o=Object(n["n"])(u["a"].get(),t,e);Object(n["c"])(o,o);for(let n=0;n<8;++n){const e=Object(a["m"])(u["e"].get(),O[n],o);Object(s["w"])(i[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}m(r,i)}function m(e,t){Object(d["f"])(t[4],t[0],t[3],e[0]),Object(d["f"])(t[1],t[5],t[6],e[1]),Object(d["f"])(t[4],t[5],t[1],e[2]),Object(d["f"])(t[3],t[2],t[6],e[3]),Object(d["f"])(t[0],t[1],t[2],e[4]),Object(d["f"])(t[5],t[4],t[7],e[5])}function g(e,t){for(let r=0;r<6;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function v(e,t){for(let r=0;r<6;r++){const i=e[r];if(!Object(d["b"])(i,t))return!1}return!0}const O=[Object(c["g"])(-1,-1,-1,1),Object(c["g"])(1,-1,-1,1),Object(c["g"])(1,1,-1,1),Object(c["g"])(-1,1,-1,1),Object(c["g"])(-1,-1,1,1),Object(c["g"])(1,-1,1,1),Object(c["g"])(1,1,1,1),Object(c["g"])(-1,1,1,1)],j=(new i["a"](l["a"]),p())},d36e:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var i=r("d7f7"),n=r("b061"),s=r("35b3"),o=r("7438"),a=r("8675"),c=r("7c51"),l=r("a4ee"),d=r("d272"),u=r("6a07"),h=r("c6d7"),p=r("8e97"),f=r("c3a4"),b=r("ca98"),m=r("da35"),g=r("fa1e"),v=r("c829"),O=r("87b7"),j=r("1962"),y=r("189c");class x extends b["a"]{initializeProgram(e){const t=x.shader.get(),r=this.configuration,i=t.build({output:r.output,OITEnabled:0===r.transparencyPassType,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new v["a"](e.rctx,i,g["a"])}bindPass(e,t){Object(p["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(u["b"])(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(h["a"])(this.program,t))}bindDraw(e){Object(p["d"])(this.program,e),this.program.rebindTextures(),Object(d["c"])(this.program,this.configuration,e)}createPipeline(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(y["f"])({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?o["g"]:Object(o["a"])(e),culling:Object(y["b"])(r.cullFace),depthTest:{func:Object(o["b"])(e)},depthWrite:i||n?r.writeDepth&&y["d"]:null,colorWrite:y["c"],stencilWrite:r.sceneHasOcludees?O["h"]:null,stencilTest:r.sceneHasOcludees?t?O["d"]:O["c"]:null,polygonOffset:i||n?r.polygonOffset&&_:Object(o["h"])(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.createPipeline(this.configuration.transparencyPassType,!0),this.createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}x.shader=new f["a"](j["a"],()=>r.e("chunk-2d0de726").then(r.bind(null,"864f")));const _={factor:1,units:1};class w extends m["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(l["a"])([Object(m["b"])({count:8})],w.prototype,"output",void 0),Object(l["a"])([Object(m["b"])({count:3})],w.prototype,"cullFace",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"slicePlaneEnabled",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"vertexColors",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"transparent",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"polygonOffset",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"enableOffset",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"writeDepth",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"sceneHasOcludees",void 0),Object(l["a"])([Object(m["b"])({count:4})],w.prototype,"transparencyPassType",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"multipassTerrainEnabled",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"cullAboveGround",void 0);class S extends s["a"]{constructor(e){super(e,T),this.supportsEdges=!0,this.techniqueConfig=new w}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<o["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,r,i,n,s,o){Object(c["f"])(e,t,i,n,s,void 0,o)}requiresSlot(e,t){return 20===e||(4===Object(n["b"])(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.parameters.writeLinearDepth?new C(e):null}createBufferWriter(){return new a["a"](a["b"])}}class C extends i["a"]{updateParameters(e){return this.ensureTechnique(x,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const T={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...s["b"]}},d3cf:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return l}));var i=r("8d60"),n=(r("c120"),r("7ffa")),s=r("b2b2"),o=r("a21b"),a=r("a9ab"),c=r("1a54");function l(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if(u(e))return e;const r=new i["a"]({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=Object(n["a"])(e.symbol),r.attributes=Object(n["a"])(e.attributes),r.geometry=p(e.geometry),r}function p(e){return Object(s["k"])(e)?null:l(e)?e:Object(a["a"])(f(e))}function f(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:r,y:i,z:n,m:s}=e;return{x:r,y:i,z:n,m:s,spatialReference:t}}case"polygon":{const{rings:r,hasZ:i,hasM:n}=e;return{rings:b(r),hasZ:i,hasM:n,spatialReference:t}}case"polyline":{const{paths:r,hasZ:i,hasM:n}=e;return{paths:b(r),hasZ:i,hasM:n,spatialReference:t}}case"extent":{const{xmin:r,xmax:i,ymin:n,ymax:s,zmin:o,zmax:a,mmin:c,mmax:l,hasZ:d,hasM:u}=e;return{xmin:r,xmax:i,ymin:n,ymax:s,zmin:o,zmax:a,mmin:c,mmax:l,hasZ:d,hasM:u,spatialReference:t}}case"multipoint":{const{points:r,hasZ:i,hasM:n}=e;return{points:v(r)?m(r):r,hasZ:i,hasM:n,spatialReference:t}}default:return}}function b(e){return g(e)?e.map(e=>m(e)):e}function m(e){return e.map(e=>Object(o["n"])(e))}function g(e){for(const t of e)if(0!==t.length)return v(t);return!1}function v(e){return e.length&&(Object(o["d"])(e[0])||Object(o["e"])(e[0]))}function O(e,t){if(!e)return null;let r;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=Object(c["g"])(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}},d408:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return M}));r("c120");var i=r("38a4"),n=r("b2b2"),s=r("a21b"),o=r("3349"),a=r("e431"),c=r("0b2d"),l=r("8188"),d=r("f694"),u=r("1666"),h=r("ed70"),p=r("2e0f"),f=r("7585"),b=r("0278");function m(e){const t=[],r=[];j(e,r,t);const i=r[0][1].data,n=t[0][1].length,s=new Uint16Array(n);return y(e,r,t),x(e,r,t,s),w(e,r,t,s),_(e,r,t,s),S(e,r,t,s),C(e,r,t,s),T(e,r,t,i),P(e,r,t,i),new b["a"](r,t,2)}function g(e,t,r,i){const n="polygon"===e.type?1:0,s="polygon"===e.type?e.rings:e.paths,{position:o,outlines:a}=Object(u["a"])(s,e.hasZ,n),c=new Float64Array(o.length),l=Object(p["d"])(o,e.spatialReference,0,c,0,o,0,o.length/3,t,r,i),d=null!=l;return{lines:d?v(a,o,c):[],projectionSuccess:d,sampledElevation:l}}function v(e,t,r){const i=new Array;for(const{index:n,count:s}of e){if(s<=1)continue;const e=3*n,o=e+3*s;i.push({position:t.subarray(e,o),mapPosition:r?r.subarray(e,o):void 0})}return i}function O(e,t){const r="polygon"===e.type?1:0,i="polygon"===e.type?e.rings:e.paths,{position:n,outlines:s}=Object(u["a"])(i,!1,r),o=Object(l["k"])(n,e.spatialReference,0,n,t,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=f["a"];return{lines:o?v(s,n):[],projectionSuccess:o}}function j(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=e,o=E(i)&&1===n,a=i.length/3-(o?1:0),c=new Uint32Array(2*(a-1)),l=o?Object(s["m"])(i,0,i.length-3):i;let d=0;for(let s=0;s<a-1;s++)c[d++]=s,c[d++]=s+1;t.push(["position",{size:3,data:l,exclusive:o}]),r.push(["position",c])}function y(e,t,r){const i=e.attributeData.mapPosition;Object(n["k"])(i)||(r.push(["mapPos",r[0][1]]),t.push(["mapPos",{size:3,data:i}]))}function x(e,t,r,i){if(Object(n["l"])(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push(["color",{size:4,data:Object(n["u"])(s,h["c"])}]),r.push(["color",i])}function _(e,t,r,i){const s=e.attributeData.colorFeature;Object(n["k"])(s)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([s])}]),r.push(["color",i]))}function w(e,t,r,i){if(Object(n["l"])(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push(["size",{size:1,data:[Object(n["u"])(s,1)]}]),r.push(["size",i])}function S(e,t,r,i){const s=e.attributeData.sizeFeature;Object(n["k"])(s)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([s])}]),r.push(["sizeFeatureAttribute",i]))}function C(e,t,r,i){const s=e.attributeData.opacityFeature;Object(n["k"])(s)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([s])}]),r.push(["opacityFeatureAttribute",i]))}function T(e,t,r,s){if("round"!==e.join)return;const o=s.length/3,c=new Float32Array(o),l=R,d=A;Object(a["w"])(l,0,0,0);const u=Object(n["u"])(e.uniformSize,1);for(let n=-1;n<o;++n){const e=n<0?o+n:n,t=(n+1)%o;if(Object(a["w"])(d,s[3*t+0]-s[3*e+0],s[3*t+1]-s[3*e+1],s[3*t+2]-s[3*e+2]),Object(a["r"])(d,d),n>=0){const e=(Math.PI-Object(i["a"])(Object(a["h"])(l,d)))*z*1*D(u);c[n]=Math.max(Math.floor(e),0)}Object(a["e"])(l,d,-1)}t.push(["subdivisions",{size:1,data:c}]),r.push(["subdivisions",r[0][1]])}function P(e,t,r,i){if(Object(n["k"])(e.overlayInfo)||1!==e.overlayInfo.renderCoordsHelper.viewingMode||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(i.length),c=Object(d["e"])(e.overlayInfo.spatialReference);for(let n=0;n<s.length;n+=3)Object(l["h"])(i,n,s,n,c);const u=i.length/3,h=new Float32Array(u+1);let p=R,f=A,b=0,m=0;Object(a["w"])(p,s[m++],s[m++],s[m++]),h[0]=0;for(let n=1;n<u+1;++n)n===u&&(m=0),Object(a["w"])(f,s[m++],s[m++],s[m++]),b+=Object(o["d"])(p,f),h[n]=b,[p,f]=[f,p];t.push(["distanceToStart",{size:1,data:h}]),r.push(["distanceToStart",r[0][1]])}function D(e){return 1.863798+-2.0062872/(1+e/18.2313)**.8856294}function E(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const R=Object(c["f"])(),A=Object(c["f"])(),z=4/Math.PI;function M(e){switch(e){case"butt":return 0;case"square":return 1;case"round":return 2;default:return null}}},d981:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r("3886");function n(e){e.fragment.code.add(i["a"]`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function s(e){e.fragment.code.add(i["a"]`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},df77:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c}));var i=r("d047"),n=r("3886");function s(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n["a"]`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function o(e,t){e.bindTexture(t.lastFrameColorTexture,"lastFrameColorMap"),e.setUniformMatrix4fv("reprojectionMat",t.reprojectionMatrix),e.setUniformMatrix4fv("rpProjectionMat",t.camera.projectionMatrix)}function a(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(i["a"]),e.include(s),e.fragment.code.add(n["a"]`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function c(e,t){t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),o(e,t))}},e550:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r("d981"),n=r("3886");function s(e){e.fragment.code.add(n["a"]`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var o=r("5d5f"),a=r("df77");function c(e,t){e.include(o["a"],t),e.include(s),e.include(i["a"]),t.ssrEnabled&&e.include(a["a"],t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(n["a"]`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(n["a"]`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`),t.ssrEnabled?e.fragment.code.add(n["a"]`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):e.fragment.code.add(n["a"]`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)}},e6aa:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(i["a"]`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add("size","float"),e.vertex.code.add(i["a"]`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(i["a"]`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(i["a"]`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(i["a"]`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add("color","vec4"),e.vertex.code.add(i["a"]`vec4 getColor(){
return applyOpacity(color);
}`))}},e9d6:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return p}));var i=r("e92d"),n=r("d3cf"),s=r("82fa");const o=i["a"].getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function a(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,r){const i=e&&e.expression;if("string"!=typeof i)return null;const n=b(i);if(null!=n)return{cachedResult:n};const o=await Object(s["e"])(),a=o.arcadeUtils,c=a.createSyntaxTree(i);return a.dependsOnView(c)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(c),context:a.createExecContext(null,{sr:t}),modules:o}}}function l(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function d(e,t){if(null!=e&&!f(e)){if(!t||!e.arcade)return void o.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=Object(n["b"])(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function u(e){if(null!=e){if(f(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function h(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||"0"===i||(r=null),r}const p={cachedResult:0};function f(e){return null!=e.cachedResult}function b(e){return"0"===e?0:null}},ea44:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return g}));var i=r("bd75"),n=r("d272"),s=r("4db9"),o=r("6a07"),a=r("d047"),c=r("c6d7"),l=r("040b"),d=r("d017"),u=r("e550"),h=r("33e2"),p=r("ebd5"),f=r("4377"),b=r("3886"),m=r("690a");function g(e){const t=new m["a"];return t.include(s["a"],{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(l["a"],e),t.include(i["a"],e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(b["a"]`
      void main(void) {
        if (waterColor.a < ${b["a"].float(p["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===e.output?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(a["a"]),t.include(c["b"],e)),7===e.output&&(t.include(n["a"],e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b["a"]`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),0===e.output&&(t.include(h["a"],e),t.include(n["a"],e),e.receiveShadows&&t.include(d["a"],e),t.include(u["a"],e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(f["a"]),t.fragment.code.add(b["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${e.receiveShadows?b["a"]`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),2===e.output&&(t.include(l["a"],e),t.include(h["a"],e),t.include(n["a"],e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b["a"]`
        void main(void) {
          if (waterColor.a < ${b["a"].float(p["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(b["a"]`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(b["a"]`
        void main(void) {
          if (waterColor.a < ${b["a"].float(p["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b["a"]`void main() {
gl_FragColor = waterColor;
}`)),4===e.output&&(t.include(o["a"]),t.varyings.add("vpos","vec3"),t.vertex.code.add(b["a"]`
      void main(void) {
        if (waterColor.a < ${b["a"].float(p["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n["a"],e),t.fragment.code.add(b["a"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const v=Object.freeze({__proto__:null,build:g})},ed70:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o}));var i=r("0fc4");const n=1.2,s=i["b"],o=i["a"]},f0b9:function(e,t,r){"use strict";function i(e){return 32+e.length}function n(){return 16}function s(e){if(!e)return 0;let t=32;for(const r in e)if(e.hasOwnProperty(r)){const s=e[r];switch(typeof s){case"string":t+=i(s);break;case"number":t+=n();break;case"boolean":t+=4}}return t}function o(e,t){return 32+e.length*t}r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}))}}]);
//# sourceMappingURL=chunk-526022d6.79a0f4d3.js.map