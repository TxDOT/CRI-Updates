(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Login"],{a55b:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-dialog",{attrs:{persistent:"","max-width":"500",id:"cardDisplay"},model:{value:t.disagree,callback:function(e){t.disagree=e},expression:"disagree"}},[s("v-card",{staticClass:"login-card",attrs:{height:"250"}},[s("v-card-actions",[!1===t.certify?s("div",{attrs:{id:"loginBannerPos"}},[s("v-alert",{attrs:{color:"#14375A",border:"top",dark:"",id:"loginBannerTxt"},domProps:{innerHTML:t._s(t.statusMessageFalse)}})],1):t._e(),s("div",{staticClass:"black--text mb-3",attrs:{id:"loginTxt"}},[s("v-card-text",{staticStyle:{color:"black"},domProps:{innerHTML:t._s(t.disagreeTxt)}})],1),s("div",{attrs:{id:"loginBtnPos"}},[s("v-btn",{attrs:{id:"loginButton",outlined:"",tile:"",color:"#14375A"},on:{click:function(e){t.disagree=!1,t.logMeIn()}}},[s("u",[t._v("Login")])])],1),s("v-btn",{attrs:{id:"SignupBtnPos",depressed:"",text:"",tile:"",color:"black","x-small":"",onclick:"window.open('https://www.txdot.gov/data-maps/roadway-inventory/cri-form.html','_blank')"},on:{click:function(e){t.signup=!0,t.login=!1}}},[t._v(" Sign-Up ")])],1)],1)],1)},a=[],r=s("3514"),o=s("0fc3"),n=s("9e3e"),u=s("1baa"),c=s("f793"),l=s("d81c8"),d=s("0224"),g=s("69dd"),h={name:"Login",props:["id"],data(){return{statusMessageTrue:"",statusMessageFalse:"",certify:!1,disagree:!0,countyPopup:!1,disagreeTxt:"<br><br>Click the Login button and use your TxDOT-provided credentials to access the County Road Inventory Map. If you do not have an account, click the Sign-Up button to register.",judgeName:"",county:"",auth:{},cntyNme:"",login:!0,loginToMap:!1,isCertify:!1,signup:!1,formDisabled:!0,firstName:"",firstNameRequired:[t=>!t.length||"First Name is required",t=>t.length>=3||"First Name must be greater than 3 characters"],lastName:"",lastNameRequired:[t=>!!t||"Last Name is required",t=>t.length>=3||"Last Name must be greater than 3 characters"],email:"",emailRequired:[t=>!!/.+@.+\..+/.test(t)||"E-mail must be valid"]}},beforeRouteLeave(t,e,s){this.loginToMap?s():s(!1)},mounted(){this.auth=new c["a"]({appId:"9XWrQUJ2eX0jXEAW",expiration:10080,popup:!1}),l["default"].registerOAuthInfos([this.auth]),l["default"].checkSignInStatus("https://txdot.maps.arcgis.com/sharing").then(()=>{this.handleSignedIn()}).catch(t=>{console.warn("logged out",t)}),this.certify=!1;const t=new Date;this.certiAlert=`<p>By clicking submit, you are certifying the mileage for your county and completing the process for ${t.getFullYear()-1}.<br> Edits made in ${t.getFullYear()} after certifying are allowed, but will need to be recertified by the county judge prior to <DATE> in order to be accepted.`,t.toDateString(),this.statusMessageFalse="The TxDOT County Road Inventory Map"},methods:{async getCountyJudge(t){let e=`CNTY_NBR = '${t}'`;const s=new g["a"];s.where=e,s.outFields=["*"];let i=await r["countyOfficialInfo"].queryFeatures(s);return this.countyNumber=t,this.judgeCntyOid=i.features[0].attributes["OBJECTID"],this.judgeNameSend=i.features[0].attributes["JUDGE_NM"],this.judgeEmailSend=i.features[0].attributes["JUDGE_EML"],this.isCertify="Y"===i.features[0].attributes["CERTFD"],i.features[0].attributes["TOT_MLGE"]},checkLocalStorage(){let t=JSON.parse(localStorage.getItem("county"));return this.getCountyJudge(t[1]),t},logMeIn(){l["default"].getCredential(this.auth.portalUrl+"/sharing")},async loadMap(t,e){const s=await Object(n["b"])(t,e),[i,a]=Object(o["e"])();0===s&&8===i&&(a>=1||a<15)?this.$router.push("/EOY"):(this.$router.push("/map"),this.loginToMap=!1)},handleSignedIn(){const t=new d["a"];this.loginToMap=!0,t.load().then(async()=>{if(this.isCertify)return void this.$router.push("/EOY");this.usrEmail=t.user.email,this.$router.push("/load"),Object(n["c"])(t.user.fetchGroups()),this.userName=t.user.username;let e=localStorage.getItem("county")?this.checkLocalStorage():await this.getCountyInfo(t.user.username);if(!e)return;let s=e[1],i=e[0];this.countyName=i,this.countyNumber=s,this.countyMiles=e[2],this.loadMap(i,s)})},async getCountyInfo(t){let e,s=Object.keys(u["a"][0]).find(s=>{let i=t.split("_");if(i[1].toLowerCase()===u["a"][0][s].replace(/\s/,"").toLowerCase())return e=u["a"][0][s],u["a"][0]});if(s){let t=await this.getCountyJudge(s);return localStorage.setItem("county",JSON.stringify([e,s,t])),[e,Number(s),t]}this.$router.push({name:"PickCounty"})}},watch:{formDisabled:{handler:function(){return!(this.firstNameRequired&&this.lastNameRequired&&this.emailRequired)},immediate:!0}},computed:{setLogOut:{get(){return this.$store.state.isLoggedOut},set(t){this.$store.commit("setIsLoggedOut",t)}},countyName:{get(){return this.$store.state.cntyName},set(t){this.$store.commit("setCntyName",t)}},countyNumber:{get(){return this.$store.state.cntyNmbr},set(t){this.$store.commit("setCntyNmbr",t)}},countyMiles:{get(){return this.$store.state.cntyMiles},set(t){this.$store.commit("setCntyMiles",t)}},userName:{get(){return this.$store.state.username},set(t){this.$store.commit("setUserName",t)}},usrEmail:{get(){return this.$store.state.userEmail},set(t){this.$store.commit("setUserEmail",t)}},logIn:{get(){return this.$store.state.isLoggedIn},set(t){this.$store.commit("setIsLoggedIn",t)}},judgeNameSend:{get(){return this.$store.state.judgeName},set(t){this.$store.commit("setJudgeName",t)}},judgeEmailSend:{get(){return this.$store.state.judgeEmail},set(t){this.$store.commit("setJudgeEmail",t)}},judgeCntyOid:{get(){return this.$store.state.judgeObjectId},set(t){this.$store.commit("setJudgeObjectId",t)}}}},m=h,p=(s("d6db"),s("2877")),y=Object(p["a"])(m,i,a,!1,null,null,null);e["default"]=y.exports},d6db:function(t,e,s){"use strict";s("e67a")},e67a:function(t,e,s){}}]);
//# sourceMappingURL=Login.ad016b17.js.map