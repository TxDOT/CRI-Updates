(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Login"],{a55b:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-dialog",{attrs:{persistent:"","max-width":"500",id:"cardDisplay"},model:{value:t.disagree,callback:function(e){t.disagree=e},expression:"disagree"}},[r("v-card",{staticClass:"login-card",attrs:{height:"250"}},[r("v-card-actions",[!1===t.certify?r("div",{attrs:{id:"loginBannerPos"}},[r("v-alert",{attrs:{color:"#14375A",border:"top",dark:"",id:"loginBannerTxt"},domProps:{innerHTML:t._s(t.statusMessageFalse)}})],1):t._e(),r("div",{staticClass:"black--text mb-3",attrs:{id:"loginTxt"}},[r("v-card-text",{staticStyle:{color:"black"},domProps:{innerHTML:t._s(t.disagreeTxt)}})],1),r("div",{attrs:{id:"loginBtnPos"}},[r("v-btn",{attrs:{id:"loginButton",outlined:"",tile:"",color:"#14375A"},on:{click:function(e){t.disagree=!1,t.logMeIn()}}},[r("u",[t._v("Login")])])],1),r("v-btn",{attrs:{id:"SignupBtnPos",depressed:"",text:"",tile:"",color:"black","x-small":"",onclick:"window.open('https://www.txdot.gov/data-maps/roadway-inventory/cri-form.html','_blank')"},on:{click:function(e){t.signup=!0,t.login=!1}}},[t._v(" Sign-Up ")])],1)],1)],1)},a=[],s=r("3835"),i=r("1da1"),o=(r("96cf"),r("ac1f"),r("00b4"),r("99af"),r("7db0"),r("d3b7"),r("b64b"),r("1276"),r("5319"),r("e9c4"),r("a9e3"),r("3514")),u=r("0fc3"),c=r("9e3e"),d=r("1baa"),l=r("f793"),g=r("d81c8"),m=r("0224"),f=r("69dd"),h={name:"Login",props:["id"],data:function(){return{statusMessageTrue:"",statusMessageFalse:"",certify:!1,disagree:!0,countyPopup:!1,disagreeTxt:"<br><br>Click the Login button and use your TxDOT-provided credentials to access the County Road Inventory Map. If you do not have an account, click the Sign-Up button to register.",judgeName:"",county:"",auth:{},cntyNme:"",login:!0,loginToMap:!1,isCertify:!1,signup:!1,formDisabled:!0,firstName:"",firstNameRequired:[function(t){return console.log(t),!t.length||"First Name is required"},function(t){return t.length>=3||"First Name must be greater than 3 characters"}],lastName:"",lastNameRequired:[function(t){return!!t||"Last Name is required"},function(t){return t.length>=3||"Last Name must be greater than 3 characters"}],email:"",emailRequired:[function(t){return!!/.+@.+\..+/.test(t)||"E-mail must be valid"}]}},beforeRouteLeave:function(t,e,r){this.loginToMap?r():r(!1)},mounted:function(){var t=this;this.auth=new l["a"]({appId:"9XWrQUJ2eX0jXEAW",expiration:10080,popup:!1}),g["default"].registerOAuthInfos([this.auth]),g["default"].checkSignInStatus("https://txdot.maps.arcgis.com/sharing").then((function(){t.handleSignedIn()})).catch((function(t){console.warn("logged out",t)})),this.certify=!1;var e=new Date;this.certiAlert="<p>By clicking submit, you are certifying the mileage for your county and completing the process for ".concat(e.getFullYear()-1,".<br> Edits made in ").concat(e.getFullYear()," after certifying are allowed, but will need to be recertified by the county judge prior to <DATE> in order to be accepted."),e.toDateString(),this.statusMessageFalse="The TxDOT County Road Inventory Map"},methods:{getCountyJudge:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n="CNTY_NBR = '".concat(t,"'"),a=new f["a"],a.where=n,a.outFields=["*"],r.next=6,o["countyOfficialInfo"].queryFeatures(a);case 6:return s=r.sent,e.countyNumber=t,e.judgeCntyOid=s.features[0].attributes["OBJECTID"],e.judgeNameSend=s.features[0].attributes["JUDGE_NM"],e.judgeEmailSend=s.features[0].attributes["JUDGE_EML"],e.isCertify="Y"===s.features[0].attributes["CERTFD"],r.abrupt("return",s.features[0].attributes["TOT_MLGE"]);case 13:case"end":return r.stop()}}),r)})))()},checkLocalStorage:function(){var t=JSON.parse(localStorage.getItem("county"));return this.getCountyJudge(t[1]),t},logMeIn:function(){g["default"].getCredential(this.auth.portalUrl+"/sharing")},loadMap:function(t,e){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,i,o,d,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(c["b"])(t,e);case 2:if(a=n.sent,i=Object(u["e"])(),o=Object(s["a"])(i,2),d=o[0],l=o[1],console.log(d,l),0!==a||8!==d||!(l>=1||l<15)){n.next=8;break}return r.$router.push("/EOY"),n.abrupt("return");case 8:r.$router.push("/map"),r.loginToMap=!1;case 10:case"end":return n.stop()}}),n)})))()},handleSignedIn:function(){var t=this,e=new m["a"];this.loginToMap=!0,e.load().then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.isCertify){r.next=3;break}return t.$router.push("/EOY"),r.abrupt("return");case 3:if(t.usrEmail=e.user.email,t.$router.push("/load"),Object(c["c"])(e.user.fetchGroups()),t.userName=e.user.username,!localStorage.getItem("county")){r.next=11;break}r.t0=t.checkLocalStorage(),r.next=14;break;case 11:return r.next=13,t.getCountyInfo(e.user.username);case 13:r.t0=r.sent;case 14:if(n=r.t0,n){r.next=17;break}return r.abrupt("return");case 17:a=n[1],s=n[0],t.countyName=s,t.countyNumber=a,t.countyMiles=n[2],t.loadMap(s,a);case 23:case"end":return r.stop()}}),r)}))))},getCountyInfo:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=Object.keys(d["a"][0]).find((function(e){var r=t.split("_");if(r[1].toLowerCase()===d["a"][0][e].replace(/\s/,"").toLowerCase())return n=d["a"][0][e],d["a"][0]})),!a){r.next=9;break}return r.next=4,e.getCountyJudge(a);case 4:return s=r.sent,localStorage.setItem("county",JSON.stringify([n,a,s])),r.abrupt("return",[n,Number(a),s]);case 9:return e.$router.push({name:"PickCounty"}),r.abrupt("return");case 11:case"end":return r.stop()}}),r)})))()}},watch:{formDisabled:{handler:function(){return!(this.firstNameRequired&&this.lastNameRequired&&this.emailRequired)},immediate:!0}},computed:{setLogOut:{get:function(){return this.$store.state.isLoggedOut},set:function(t){this.$store.commit("setIsLoggedOut",t)}},countyName:{get:function(){return this.$store.state.cntyName},set:function(t){this.$store.commit("setCntyName",t)}},countyNumber:{get:function(){return this.$store.state.cntyNmbr},set:function(t){this.$store.commit("setCntyNmbr",t)}},countyMiles:{get:function(){return this.$store.state.cntyMiles},set:function(t){this.$store.commit("setCntyMiles",t)}},userName:{get:function(){return this.$store.state.username},set:function(t){this.$store.commit("setUserName",t)}},usrEmail:{get:function(){return this.$store.state.userEmail},set:function(t){this.$store.commit("setUserEmail",t)}},logIn:{get:function(){return this.$store.state.isLoggedIn},set:function(t){this.$store.commit("setIsLoggedIn",t)}},judgeNameSend:{get:function(){return this.$store.state.judgeName},set:function(t){this.$store.commit("setJudgeName",t)}},judgeEmailSend:{get:function(){return this.$store.state.judgeEmail},set:function(t){this.$store.commit("setJudgeEmail",t)}},judgeCntyOid:{get:function(){return this.$store.state.judgeObjectId},set:function(t){this.$store.commit("setJudgeObjectId",t)}}}},p=h,b=(r("d6db"),r("2877")),y=Object(b["a"])(p,n,a,!1,null,null,null);e["default"]=y.exports},d6db:function(t,e,r){"use strict";r("e67a")},e67a:function(t,e,r){}}]);
//# sourceMappingURL=Login.8fa0209c.js.map