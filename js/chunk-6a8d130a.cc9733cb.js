(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a8d130a"],{2252:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var a=i("3886");function n(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(a["a"]`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function r(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},2698:function(e,t,i){"use strict";function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return a}))},"33b0":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return c}));var a=i("38a4"),n=i("04f0"),r=i("b139"),s=i("e431");function o(e=b){return[e[0],e[1],e[2],e[3]]}function c(e,t,i=o()){return Object(s["k"])(h(i),e),i[3]=t,i}function l(e,t,i=o()){return Object(n["h"])(g,h(e),u(e)),Object(n["h"])(m,h(t),u(t)),Object(n["f"])(g,m,g),p(i,Object(a["l"])(Object(n["b"])(h(i),g)))}function h(e){return e}function d(e){return e[3]}function u(e){return Object(a["f"])(e[3])}function p(e,t){return e[3]=t,e}const b=[0,0,1,0],g=Object(r["b"])(),m=Object(r["b"])();o()},"3cde":function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var a=i("a4ee"),n=i("fc29"),r=i("ce6d"),s=i("b2b2"),o=i("a915"),c=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),h=i("3349"),d=i("e431"),u=i("0b2d"),p=i("8188"),b=i("f408"),g=i("a6c1"),m=i("fd14"),f=i("e94b");let O=class extends n["a"]{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new r["a"].EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(b["f"])(this.graphic),i=e?e.offset:0;return new m["a"]({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(Object(s["k"])(i))return null;const a=this._get("focusedSymbol"),n=Object(s["l"])(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(s["l"])(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(s["l"])(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",e=>{Object(s["l"])(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(s["l"])(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))},!0)}detachSymbolChanged(){Object(s["l"])(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(s["l"])(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||Object(g["h"])(i),Object(s["k"])(a))return null;const n=1;let r=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return Object(f["b"])(t,i,e)?n:null;if(Object(s["k"])(r)||!r.originalPoint.equals(i)){const t=i,n=e.spatialReference;if(Object(p["a"])(t.spatialReference,n)){const e=Object(p["i"])(t,n);r={originalPoint:t.clone(),mapPoint:e,radiusPx:Object(o["g"])(a.size)},this._circleCollisionCache=r}}if(Object(s["l"])(r)){const i=Object(o["i"])(t,_),s=e.toScreen(r.mapPoint),c=r.radiusPx,l=s.x+Object(o["g"])(a.xoffset),d=s.y-Object(o["g"])(a.yoffset);return Object(h["a"])(i,[l,d])<c*c?n:null}return null}_intersectDistance3D(e,t,i){const a=e.toMap(t,{include:[i]});return a&&Object(p["n"])(a,v,e.renderSpatialReference)?Object(d["m"])(v,e.state.camera.eye):null}};Object(a["a"])([Object(c["b"])({constructOnly:!0,nonNullable:!0})],O.prototype,"graphic",null),Object(a["a"])([Object(c["b"])({readOnly:!0})],O.prototype,"elevationInfo",null),Object(a["a"])([Object(c["b"])({constructOnly:!0,nonNullable:!0})],O.prototype,"view",void 0),Object(a["a"])([Object(c["b"])({value:null})],O.prototype,"focusedSymbol",null),Object(a["a"])([Object(c["b"])({constructOnly:!0})],O.prototype,"layer",void 0),Object(a["a"])([Object(c["b"])()],O.prototype,"interactive",void 0),Object(a["a"])([Object(c["b"])()],O.prototype,"selectable",void 0),Object(a["a"])([Object(c["b"])()],O.prototype,"grabbable",void 0),Object(a["a"])([Object(c["b"])({value:!1})],O.prototype,"grabbing",null),Object(a["a"])([Object(c["b"])()],O.prototype,"dragging",void 0),Object(a["a"])([Object(c["b"])()],O.prototype,"hovering",null),Object(a["a"])([Object(c["b"])({value:!1})],O.prototype,"selected",null),Object(a["a"])([Object(c["b"])()],O.prototype,"cursor",void 0),O=Object(a["a"])([Object(l["a"])("esri.views.interactive.GraphicManipulator")],O);const v=Object(u["f"])(),_=Object(o["f"])()},"438e":function(e,t,i){"use strict";i.r(t),i.d(t,"DrawGraphicTool3D",(function(){return ci})),i.d(t,"GraphicMoveTool",(function(){return xn})),i.d(t,"GraphicReshapeTool",(function(){return qn})),i.d(t,"GraphicTransformTool",(function(){return dr})),i.d(t,"ExtentTransformTool",(function(){return Bs}));var a=i("a4ee"),n=i("c649"),r=i("b2b2"),s=i("3795"),o=i("59b2"),c=(i("b50f"),i("c120")),l=i("cea0"),h=i("d386"),d=i("f408"),u=i("fd14"),p=i("9ef0"),b=i("e431"),g=i("0b2d"),m=i("af40"),f=i("7577"),O=i("5ef2"),v=i("4f8b"),_=i("d359"),y=i("bd7e"),j=i("d18f");class M{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var w=i("38a4"),x=i("02f1"),S=i("0fc4"),E=i("7289"),P=i("f895"),D=i("2ebb"),R=i("fc00"),A=i("d791"),C=i("afe1"),T=i("c3a4"),V=i("ca98"),G=i("da35"),k=i("c829"),z=i("56d6"),I=i("189c");class L extends V["a"]{initializeProgram(e){const t=L.shader.get(),i=this.configuration,a=t.build(i);return new k["a"](e.rctx,a,L.attributeLocations)}bind(e,t,i){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",i.projectionMatrix),Object(A["b"])(H,i.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",H),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}initializePipeline(){return Object(I["f"])({blending:Object(I["h"])(1,771),colorWrite:I["c"]})}}L.shader=new T["a"](z["a"],()=>i.e("chunk-2d22cca6").then(i.bind(null,"f578"))),L.attributeLocations=new Map([["start",0],["end",1],["up",2],["extrude",3]]);class F extends G["a"]{constructor(){super(...arguments),this.contrastControlEnabled=!1}}Object(a["a"])([Object(G["b"])()],F.prototype,"contrastControlEnabled",void 0);const H=Object(C["d"])();var U=i("7ce4"),q=i("0fa6");class B{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=Object(g["f"])(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const a of e)t[i++]=a[0],t[i++]=a[1],t[i++]=a[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);Object(b["w"])(this._origin,e[t+0],e[t+1],e[t+2])}else Object(b["w"])(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this.ensureVAO(e);Object(r["l"])(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}dispose(){Object(r["l"])(this._vao)&&this._vao.dispose()}ensureVAO(e){return Object(r["k"])(this._buffers)?null:(Object(r["k"])(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const i=this.createDataBuffer(t);return this._dirty=!1,new q["a"](e,L.attributeLocations,{data:Object(D["a"])(Z)},{data:U["a"].createVertex(e,35044,i)})}ensureVertexData(e,t){if(!this._dirty)return;const i=this.createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}numberOfRenderVertices(e){return 2*(e.length/3-1)*3}createDataBuffer(e){const t=e.reduce((e,t)=>e+this.numberOfRenderVertices(t),0);this._count=t;const i=Z.createBuffer(t),a=this._origin;let n=0,r=0;for(const s of e){for(let e=0;e<s.length;e+=3){const t=Object(b["w"])(N,s[e+0],s[e+1],s[e+2]);0===e?r=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,r);const o=this._renderCoordsHelper.worldUpAtPosition(t,W),c=n+2*e,l=Object(b["j"])(N,t,a);if(e<s.length-3){i.up.setVec(c,o),i.up.setVec(c+3,o),i.up.setVec(c+5,o);for(let e=0;e<6;e++)i.start.setVec(c+e,l);i.extrude.setValues(c+0,0,-1),i.extrude.setValues(c+1,1,-1),i.extrude.setValues(c+2,1,1),i.extrude.setValues(c+3,0,-1),i.extrude.setValues(c+4,1,1),i.extrude.setValues(c+5,0,1)}if(e>0){i.up.setVec(c-2,o),i.up.setVec(c-4,o),i.up.setVec(c-5,o);for(let e=-6;e<0;e++)i.end.setVec(c+e,l)}}n+=this.numberOfRenderVertices(s)}return i.buffer}}const W=Object(g["f"])(),N=Object(g["f"])(),Z=Object(R["a"])().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");var X=i("d5f7"),Y=i("1153"),Q=i("7c51"),K=i("fa1e"),J=i("a997");class $ extends V["a"]{initializeProgram(e){const t=$.shader.get(),i=this.configuration,a=t.build(i);return new k["a"](e.rctx,a,K["a"])}bind(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);const i=null!=e.angleCutoff?e.angleCutoff:J["c"];this.program.setUniform2f("angleCutoff",Math.cos(i),Math.cos(Math.max(0,i-Object(w["f"])(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}initializePipeline(){return Object(I["f"])({blending:Object(I["h"])(1,771),colorWrite:I["c"]})}}$.shader=new T["a"](J["a"],()=>i.e("chunk-2d2248f1").then(i.bind(null,"e13b")));class ee extends G["a"]{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1}}Object(a["a"])([Object(G["b"])()],ee.prototype,"heightManifoldEnabled",void 0),Object(a["a"])([Object(G["b"])()],ee.prototype,"pointDistanceEnabled",void 0),Object(a["a"])([Object(G["b"])()],ee.prototype,"lineVerticalPlaneEnabled",void 0),Object(a["a"])([Object(G["b"])()],ee.prototype,"intersectsLineEnabled",void 0),Object(a["a"])([Object(G["b"])()],ee.prototype,"contrastControlEnabled",void 0);const te=Object(g["f"])(),ie=Object(S["e"])(),ae={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Object(w["f"])(6),globalAlphaContrastBoost:2};function ne(e,t,i,a){const n=te,r=ie;Object(b["q"])(n,t,a),Object(b["k"])(r,i),r[3]=0,Object(f["m"])(r,r,a),Object(E["g"])(n,r,e)}class re{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=Object(S["e"])(),this._zScale=Object(x["a"])(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=Object(g["f"])(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=Object(g["f"])(),this._pointDistanceTarget=Object(g["f"])(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=Object(y["d"])(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=Object(y["d"])(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=Object(g["f"])(),this._tempDir=Object(g["f"])(),this._tempUp=Object(g["f"])(),this._tempVec3A=Object(g["f"])(),this._tempVec3B=Object(g["f"])(),this._tempVec4=Object(S["e"])(),this._tempPlane=Object(E["d"])(),this._tempSphere=Object(P["c"])(),this._params=Object(Q["c"])(t,ae)}get renderSlots(){return[this._config.contrastControlEnabled?15:14]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){Object(b["k"])(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){Object(b["k"])(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){Object(b["k"])(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){Object(y["c"])(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){Object(y["c"])(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,Object(r["l"])(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){Object(r["k"])(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new B(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){Object(r["k"])(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new B(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){Object(Q["h"])(this._params,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=Object(X["b"])(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new ee;const i=new F;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(L,i)}uninitializeRenderContext(){this._quadVAO=Object(r["f"])(this._quadVAO),this._technique=Object(r["r"])(this._technique),this._pathVerticalPlaneData=Object(r["f"])(this._pathVerticalPlaneData),this._pathTechnique=Object(r["r"])(this._pathTechnique)}render(e){const t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,i=this.pathVerticalPlaneEnabled;if(!t&&!i)return!1;const a=e.camera;return Object(Y["f"])(a.projectionMatrix,a.fullWidth,a.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),i&&this.renderPath(e),!0}renderUnified(e){const t=e.rctx,i=this._selectTechnique(),a=i.program;t.useProgram(a),i.bindPipelineState(t),this._bindGlobalUniforms(e,a),this.bindHeightManifoldUniforms(e,a),this.bindPointDistanceUniforms(e,a),this.bindLineVerticalPlaneUniforms(e,a),this.bindIntersectsLineUniforms(e,a),i.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}renderPath(e){if(Object(r["k"])(this._pathVerticalPlaneData)||Object(r["k"])(this._pathTechnique))return;const t=e.rctx,i=this._pathTechnique,a=i.program;t.useProgram(a),i.bindPipelineState(t),this._bindGlobalUniforms(e,a),i.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,a=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),ne(a,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",a)}bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,a=this._tempSphere;Object(b["k"])(a,this._pointDistanceOrigin),Object(b["q"])(a,a,i.viewMatrix),a[3]=Object(b["m"])(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",a[0],a[1],a[2],a[3])}bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,a=e.camera,n=this._tempPlane,r=this._tempVec3A,s=this._tempUp,o=this._tempDir,c=this._tempNormal;Object(y["h"])(this._lineVerticalPlaneSegment,.5,r),i.worldUpAtPosition(r,s),Object(b["r"])(o,this._lineVerticalPlaneSegment.vector),Object(b["g"])(c,s,o),Object(b["r"])(c,c),ne(n,this._lineVerticalPlaneSegment.origin,c,a.viewMatrix),t.setUniform4fv("lineVerticalPlane",n);const l=this._tempVec3A;Object(b["k"])(l,this._lineVerticalPlaneSegment.origin),i.setAltitude(l,0),Object(b["q"])(l,l,a.viewMatrix),t.setUniform3fv("lineVerticalStart",l);const h=this._tempVec3B;Object(b["f"])(h,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(h,0),Object(b["q"])(h,h,a.viewMatrix),t.setUniform3fv("lineVerticalEnd",h)}bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=oe,a=ce;if(this._intersectsLineInfinite){const t=e.camera;if(Object(v["c"])(Object(j["g"])(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),se),se.c0=-Number.MAX_VALUE,!Object(_["d"])(t.frustum,se))return;Object(v["e"])(se,i),Object(v["d"])(se,a)}else Object(b["k"])(i,this._intersectsLineSegment.origin),Object(b["f"])(a,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const n=this._tempVec3A;Object(b["q"])(n,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",n);const r=this._tempVec4;Object(b["k"])(r,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Object(f["m"])(this._tempVec4,this._tempVec4,e.camera.viewMatrix),Object(b["q"])(a,a,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",a),Object(b["r"])(r,r),t.setUniform3f("intersectsLineDirection",r[0],r[1],r[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}_bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",i.near,i.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor")}_requestRender(){this._context&&this._context.requestRender()}_selectTechnique(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire($,this._techniqueConfig,this._technique),this._technique}}const se=Object(v["a"])(),oe=Object(g["f"])(),ce=Object(g["f"])();class le extends M{constructor(e){super(e.view),this._angleCutoff=J["c"],this._style={},this._heightManifoldTarget=Object(g["f"])(),this._heightManifoldEnabled=!1,this._intersectsLine=Object(y["d"])(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this.ensureRenderer()}destroyResources(){this.disposeRenderer()}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this.syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){Object(r["l"])(e)?(Object(b["k"])(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(Object(r["k"])(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,he);this.intersectsLine=Object(y["g"])(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){Object(r["l"])(e)?(Object(y["c"])(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=Object(r["l"])(e)?Object(y["c"])(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=Object(r["l"])(e)?{origin:Object(g["d"])(e.origin),target:Object(g["d"])(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||Object(r["l"])(this._pointDistanceLine)||Object(r["l"])(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}ensureRenderer(){Object(r["l"])(this.renderer)||(this.renderer=new re(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}syncStyle(){Object(r["k"])(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}syncAngleCutoff(){Object(r["k"])(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff})}syncHeightManifold(){Object(r["k"])(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}syncIntersectsLine(){Object(r["k"])(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}syncIntersectsLineInfinite(){Object(r["k"])(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}syncPathVerticalPlane(){Object(r["k"])(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=Object(r["l"])(this._pathVerticalPlaneBuffers)&&this.visible,Object(r["l"])(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}syncLineVerticalPlane(){Object(r["k"])(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=Object(r["l"])(this._lineVerticalPlaneSegment)&&this.visible,Object(r["l"])(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}syncPointDistance(){Object(r["k"])(this.renderer)||(this.renderer.pointDistanceEnabled=Object(r["l"])(this._pointDistanceLine)&&this.visible,Object(r["l"])(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}disposeRenderer(){Object(r["l"])(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const he=Object(g["f"])();var de=i("5a22"),ue=i("748f");class pe extends M{constructor(e){super(e.view),this._resources=null,this._transform=Object(C["d"])()}get object(){return Object(r["l"])(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(A["d"])(this._transform,e),Object(r["l"])(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(r["k"])(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new ue["a"]({isPickable:!1,updatePolicy:1});e.add(t);const i=new de["a"]({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial(t=>e.add(t)),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(r["k"])(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(r["k"])(this._resources)||this._resources.object.setVisible(e)}}var be=i("caf7"),ge=i("86ba");class me extends pe{constructor(e){super(e),this._ray=Object(j["c"])(),this._externalResources=null,this._handles=new m["a"],this._isWorldDown=!1,this._start=Object(g["f"])(),this._end=Object(g["h"])(1,0,0),this._width=1,this._color=Object(O["c"])(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Object(O["c"])(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=je,this.applyProps(e)}createExternalResources(){const e=new ge["a"](this.materialParameters);this._handles.add(this.view.state.watch("camera",()=>{this.updateGeometry()}));const t=new le({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){Object(r["l"])(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){Object(r["l"])(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[Object(g["f"])(),Object(g["f"])()],i=3===this.extensionType;i&&t.push(Object(g["f"])(),Object(g["f"])());const a=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=be["a"].createPolylineGeometry(t,null,a);e.addGeometry(n,Object(r["t"])(this._externalResources).material),this.updateVertices(e)}updateVisibility(e){super.updateVisibility(e),Object(r["l"])(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,Object(b["k"])(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(b["j"])(this._end,e,this._end),Object(j["e"])(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,Object(b["o"])(this._start,e)||(Object(b["k"])(this._start,e),Object(j["e"])(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,Object(b["o"])(this._end,e)||(Object(b["k"])(this._end,e),Object(j["e"])(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(f["g"])(e,this._color)||(Object(f["c"])(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(f["g"])(e,this._innerColor)||(Object(f["c"])(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(r["l"])(e)!==Object(r["l"])(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(r["k"])(e)||Object(r["k"])(this._stippleOffColor)||!Object(f["g"])(e,this._stippleOffColor))&&(this._stippleOffColor=Object(r["l"])(e)?Object(O["a"])(e):null,this.updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&Object(r["l"])(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,Object(r["l"])(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(r["l"])(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(r["l"])(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Object(r["u"])(e,je),this.recreateGeometry()}updateMaterial(){Object(r["k"])(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){Object(r["l"])(this.object)&&this.updateVertices(this.object)}updateVertices(e){const t=3===this._extensionType?this.updateLineSegmentFinite(_e):this.updateLineSegmentInfinite(this._extensionType,_e);this.updateVertexAttributes(e,t),Object(r["l"])(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}updateLineSegmentFinite(e){return Object(y["f"])(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Object(v["c"])(this._ray,fe),e){case 0:fe.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=Object(r["u"])(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&Object(b["s"])(fe.ray.direction,fe.ray.direction),2===this._extensionType&&null!=t&&(fe.c1=Math.abs(i-t));break}}if(!Object(_["d"])(i.frustum,fe))return Object(y["f"])(this._start,this._end,t);const a=Object(v["e"])(fe,Oe),n=Object(v["d"])(fe,ve);return Object(y["f"])(a,n,t)}updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute("position").data;if(3===this.extensionType){const e=Object(y["h"])(t,-this.fadedExtensions.start,Oe);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=Object(y["h"])(t,0,Oe);i[3]=a[0],i[4]=a[1],i[5]=a[2];const n=Object(y["h"])(t,1,Oe);i[6]=n[0],i[7]=n[1],i[8]=n[2];const r=Object(y["h"])(t,1+this.fadedExtensions.end,Oe);i[9]=r[0],i[10]=r[1],i[11]=r[2]}else{const e=Object(y["h"])(t,0,Oe);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=Object(y["h"])(t,1,Oe);i[3]=a[0],i[4]=a[1],i[5]=a[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const fe=Object(v["a"])(),Oe=Object(g["f"])(),ve=Object(g["f"])(),_e=Object(y["d"])(),ye=1/3,je={start:ye,end:ye};var Me=i("a915"),we=i("3349");class xe extends pe{constructor(e){super(e),this._handles=new m["a"],this._location=Object(g["f"])(),this._direction=Object(g["h"])(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Object(O["c"])(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){Object(b["o"])(this._location,e)||(Object(b["k"])(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){Object(b["o"])(this._direction,e)||(Object(b["k"])(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,t){Object(b["r"])(this._direction,Object(b["j"])(this._direction,t,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){Object(f["g"])(e,this._color)||(Object(f["c"])(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new ge["a"](this.materialParameters);this._handles.add(this.view.state.watch("camera",()=>{this.updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=be["a"].createPolylineGeometry([Object(g["f"])(),Object(g["f"])()]),i=be["a"].createPolylineGeometry([Object(g["f"])(),Object(g["f"])()]),a=Object(r["t"])(this._externalResources).material;e.addGeometry(t,a),e.addGeometry(i,a),this.updateVertices(e)}forEachExternalMaterial(e){Object(r["l"])(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){Object(r["k"])(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;Object(r["k"])(e)||this.updateVertices(e)}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,Ee),Object(b["f"])(Se,this.location,this.direction),t.projectToScreen(Se,Pe),Object(we["i"])(Pe,Object(we["f"])(Pe,Pe,Ee)),this.updateVertexAttributes(t,e,0,Ee,Pe,1),this.updateVertexAttributes(t,e,1,Ee,Pe,-1)}updateVertexAttributes(e,t,i,a,n,r){const s=t.geometryRecords[i],o=s.geometry.getMutableAttribute("position").data,c=Object(we["g"])(De,Object(we["s"])(De,n[1]*r,n[0]*-r),this.offset+this.width/2),l=Object(we["m"])(Re,Object(we["m"])(Re,Object(we["m"])(Re,a,Object(we["g"])(Re,n,this.length/2)),c),c),h=Object(we["m"])(Ae,l,Object(we["g"])(Ae,n,-this.length));e.unprojectFromScreen(l,Se),o[0]=Se[0],o[1]=Se[1],o[2]=Se[2],e.unprojectFromScreen(h,Se),o[3]=Se[0],o[4]=Se[1],o[5]=Se[2],t.geometryVertexAttrsUpdated(s)}}const Se=Object(g["f"])(),Ee=Object(Me["f"])(),Pe=Object(Me["f"])(),De=Object(Me["f"])(),Re=Object(Me["f"])(),Ae=Object(Me["f"])();var Ce=i("8188"),Te=i("4261"),Ve=i("7361");class Ge{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return Object(r["l"])(this._resources)?this._resources.object:null}get resources(){return Object(r["l"])(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(Object(r["k"])(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach(t=>{2===t.type&&e.remove(t)}),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new ue["a"]({isPickable:!1,updatePolicy:1});e.add(t);const i=new de["a"]({castShadow:!1}),a=this.resourceFactory.createResources(i,t);a.forEach(t=>e.add(t)),e.add(i),t.add(i),this._syncVisible();const n=this.resourceFactory.cameraChanged?Object(s["a"])(this.resourceFactory.view.state,"camera",e=>this.resourceFactory.cameraChanged(e)):null;this._resources={layer:t,object:i,external:a,cameraHandle:n}}_destroyResources(){if(Object(r["k"])(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach(t=>{null==e||e.remove(t),"dispose"in t&&t.dispose()}),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){Object(r["k"])(this._resources)||this._resources.object.setVisible(this._visible)}}var ke=i("2e0f"),ze=i("0eb9"),Ie=i("a6c9"),Le=i("1e2c"),Fe=i("2df1");class He{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=Object(S["g"])(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(S["g"])(1,1,1,1),this._elevationInfo=null,this.resources=new Ge({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),Object(r["l"])(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(r["l"])(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){Object(f["g"])(e,this._color)||(Object(f["c"])(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,Object(r["l"])(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(f["g"])(e,this._outlineColor)||(Object(f["c"])(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;Object(r["k"])(e)||e.material.setParameters(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(Object(r["k"])(e)||Object(r["k"])(t))return;const i=e.geometry;if(Object(r["k"])(i))return;const a=i.getMutableAttribute("size").data,n=this.geometrySize;a[0]=n,a[1]=n,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:qe,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/Ue}recreateGeometry(e,t){const i=this.createRenderGeometry();return Object(r["l"])(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new Fe["a"](this.materialParameters(t.id)),a=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:a,forEach(e){e(t),e(i),Object(r["l"])(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return Object(w["d"])(Object(w["j"])(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new Le["a"](Object(Ie["f"])(this._primitive,e,e*Ue),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if(Object(r["k"])(this.resources.resources)||Object(r["k"])(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get("position");return Object(Ce["r"])(t.data,this.view.renderCoordsHelper.spatialReference,Be,this.view.spatialReference),Object(Te["k"])(e,Be),!0}createRenderGeometry(){const e=this.geometry;if(Object(r["k"])(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,a=Object(ke["f"])(e,i,ze["a"].fromElevationInfo(this.elevationInfo),t),n=Object(b["w"])(Ve["d"].get(),e.x,e.y,a),s=Ve["d"].get();Object(Ce["r"])(n,e.spatialReference,s,t.spatialReference);const o=this.geometrySize;return be["a"].createPointGeometry(null,s,null,[o,o],[0,0,0,1])}}const Ue=.5,qe=[Ue/2,Ue/2,1-Ue/2,1-Ue/2],Be=Object(g["f"])();var We=i("0278"),Ne=i("d36e");class Ze extends pe{constructor(e){super(e),this._handles=new m["a"],this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=Object(g["f"])(),this._up=Object(g["f"])(),this._right=Object(g["f"])(),this._renderOccluded=4,this._color=Object(O["c"])(1,0,0,1),this._outlineColor=Object(O["c"])(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Object(f["c"])(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(f["c"])(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Object(b["m"])(t,e),Object(b["m"])(t,i))/3,Object(b["r"])(this._up,Object(b["j"])(this._up,e,t)),Object(b["r"])(this._right,Object(b["j"])(this._right,i,t)),Object(b["k"])(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Ne["a"](this.quadMaterialParameters),this._outlineMaterial=new ge["a"](this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",()=>this._updateTransform()))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=Object(b["f"])(Ve["d"].get(),this._up,this._right),i=be["a"].createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,i);Object(A["j"])(Xe),Object(A["b"])(Xe,Xe,this._position),Object(A["g"])(Xe,Xe,[a,a,a]),Object(r["l"])(e)&&(e.transformation=Xe)}_quadGeometryData(e,t){const i=Object(b["f"])(Ve["d"].get(),e,t);return new We["a"]([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const Xe=Object(C["d"])();var Ye=i("c9fb"),Qe=i("6706"),Ke=i("65a7");class Je extends Ke["a"]{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return Object(n["a"])(new He({view:r,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:a,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:p["a"].toUnitRGBA(Ye["a"].orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return Object(n["a"])(new He({view:r,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:a,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:p["a"].toUnitRGBA(Ye["a"].orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return Object(n["a"])(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,a,r,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t,s=Object(Qe["a"])(e.lineStart,i,a,t.view),o=Object(Qe["a"])(e.lineEnd,i,a,t.view),c=Object(b["i"])(o,s,o,.5),l=new xe({view:r,attached:!1,offset:Ye["a"].parallelLineHintOffset,length:Ye["a"].parallelLineHintLength,width:Ye["a"].parallelLineHintWidth,color:p["a"].toUnitRGBA(Ye["a"].orange),location:c,renderOccluded:16});return l.setDirectionFromPoints(s,c),l.attached=!0,Object(n["a"])(l)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return Object(n["a"])(new Ze({view:r,attached:!0,color:p["a"].toUnitRGBA(Ye["a"].orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:p["a"].toUnitRGBA(Ye["a"].orange),outlineSize:Ye["a"].rightAngleHintOutlineSize,size:Ye["a"].rightAngleHintSize,geometry:{previous:Object(Qe["a"])(e.previousVertex,i,a,r),center:Object(Qe["a"])(e.centerVertex,i,a,r),next:Object(Qe["a"])(e.nextVertex,i,a,r)}}))}createLineSegmentHintFromMap(e,t,i,a,n,r,s=!0,o=!0){const c=Object(g["f"])(),l=Object(g["f"])();return Object(Qe["c"])(t,i,a,n,r,c,l),this.createLineSegmentHint(e,r,c,l,s,o)}createLineSegmentHint(e,t,i,a,n=!0,r=!0){const s=new me({view:t,extensionType:3,start:i,end:a,color:p["a"].toUnitRGBA(Ye["a"].orange),renderOccluded:16});switch(e){case 0:s.width=Ye["a"].lineHintWidthTarget,s.fadedExtensions={start:0,end:Ye["a"].lineHintFadedExtensions};break;case 2:s.width=Ye["a"].lineHintWidthReference,s.fadedExtensions={start:0,end:0};break;case 1:s.width=Ye["a"].lineHintWidthReference,s.fadedExtensions={start:n?Ye["a"].lineHintFadedExtensions:0,end:r?Ye["a"].lineHintFadedExtensions:0}}return s.attached=!0,s}}var $e=i("d329"),et=i("3544");const tt={main:new p["a"]([255,127,0]),selected:new p["a"]([255,255,255]),staged:new p["a"]([12,207,255]),outline:new p["a"]([0,0,0,.5]),selectedOutline:new p["a"]([255,255,255])},it=.3;function at(e,t){const i=e.clone();return i.a*=t,i}function nt(e,t){const i=e.clone(),a=Object($e["b"])(i);a.s*=t;const n=Object($e["e"])(a);return i.r=n.r,i.g=n.g,i.b=n.b,i}function rt(e,t){if(t)for(const i in t)e[i]=t[i]}class st{constructor(e){this.color=tt.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,rt(this,e)}}class ot{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=tt.main,this.outlineColor=tt.outline,this.renderOccluded=16,this.hoverOutlineColor=tt.selectedOutline,rt(this,e)}apply(e,t){const i=this[e];t.setParameters({color:Ot(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class ct{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=at(tt.main,.5),this.hoverColor=tt.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,rt(this,e)}apply(e,t){const i=this[e];t.setParameters({color:Ot(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class lt{constructor(e){this.vertex=new ot({color:tt.main,outlineColor:tt.outline}),this.edge=new ot({color:nt(at(tt.main,2/3),.5),outlineColor:at(tt.outline,.5),size:8,collisionPadding:8}),this.selected=new ot({color:tt.selected,outlineColor:tt.outline}),this.edgeOffset=new ct,rt(this,e)}}class ht{constructor(e){this.color=tt.selected,this.width=1.5,this.stipplePattern=Object(et["a"])(5),this.stippleOffColor=tt.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=tt.selected,this.renderOccluded=4,rt(this,e)}apply(e){e.color=Ot(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Ot(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Ot(this.innerColor),e.renderOccluded=this.renderOccluded}}class dt{constructor(e){this.color=tt.selected,this.size=4,this.outlineSize=1,this.outlineColor=tt.outline,this.shape="square",rt(this,e)}apply(e){e.color=Ot(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Ot(this.outlineColor),e.primitive=this.shape}}class ut{constructor(e){this.innerColor=tt.selected,this.innerWidth=1,this.glowColor=tt.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=it,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=tt.main,rt(this,e)}apply(e,t=1){const i={glowColor:p["a"].toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:p["a"].toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class pt{constructor(e){this.outline=new ht({color:tt.outline,renderOccluded:8,stippleOffColor:tt.selected,stipplePattern:Object(et["a"])(5),width:1.5,innerWidth:0}),this.staged=new ht({color:tt.selected,renderOccluded:8,innerColor:tt.staged,stippleOffColor:tt.outline,stipplePattern:Object(et["a"])(5),width:1.5}),this.shadowStyle=new ut({globalAlpha:it,glowColor:tt.main,glowFalloff:8,glowWidth:8,innerColor:tt.selected,innerWidth:1}),rt(this,e)}}class bt{constructor(e){this.outline=new dt({color:tt.selected,outlineColor:tt.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ut({globalAlpha:it,glowColor:tt.main,glowFalloff:1.5,glowWidth:6,innerColor:tt.selected,innerWidth:1,radius:2}),rt(this,e)}}class gt extends ht{constructor(e){super(),this.extensionType=2,rt(this,e)}}class mt{constructor(e){this.lineGraphics=new pt,this.pointGraphics=new bt,this.heightPlane=new ut({globalAlpha:it,glowColor:tt.main,glowFalloff:8,glowWidth:8,innerColor:tt.selected,innerWidth:1}),this.heightBox=new ut({globalAlpha:it,glowColor:tt.main,glowFalloff:8,glowWidth:8,innerColor:tt.selected,innerWidth:0,heightFillColor:tt.main}),this.zVerticalLine=new gt({color:at(tt.main,5*it/3),falloff:2,innerColor:at(tt.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,rt(this,e)}}class ft{constructor(e){this.visualElements=new mt,this.reshapeManipulators=new lt,this.zManipulator=new st,rt(this,e)}colorToVec4(e){return Ot(e)}}function Ot(e){return Object(S["f"])(p["a"].toUnitRGBA(e))}const vt=new ft;var _t=i("ce6d"),yt=i("1a54"),jt=i("fc29"),Mt=i("a5d8");class wt{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(r["l"])(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(r["k"])(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(r["k"])(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new xt({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(Object(r["k"])(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!Object(r["k"])(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){Object(r["k"])(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let xt=class extends(Object(Mt["a"])(jt["a"])){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1}};Object(a["a"])([Object(o["b"])({constructOnly:!0})],xt.prototype,"view",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],xt.prototype,"drapeSourceType",void 0),xt=Object(a["a"])([Object(h["a"])("DrapedVisualElementLayerView")],xt);var St=i("d408"),Et=i("1038"),Pt=i("6061");class Dt{constructor(e){this.view=null,this._attachmentOrigin=Object(yt["g"])(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new _t["a"],this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(O["c"])(1,0,1,1),this._innerWidth=0,this._innerColor=Object(O["c"])(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new Ge({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new wt({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new le({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(r["l"])(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(f["g"])(e,this._color)||(Object(f["c"])(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(f["g"])(e,this._innerColor)||(Object(f["c"])(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(r["l"])(e)!==Object(r["l"])(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(f["g"])(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(O["a"])(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(r["l"])(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(r["l"])(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(b["w"])(Ct,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get("position"),a=i.indices.get("position"),n=Object(r["t"])(this.resources.resources).material.isClosed(e.data,a);Object(Et["a"])(e,a,n,At)&&(Object(b["f"])(Ct,Ct,At),t++)}return 0===t?null:(Object(b["e"])(Ct,Ct,1/t),this.view.renderCoordsHelper.fromRenderCoords(Ct,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){Object(r["l"])(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),Object(r["l"])(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return Object(r["l"])(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const a=this.createRenderGeometries();for(const n of a)e.addGeometry(n,t),i.push(n);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new ge["a"](this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new ge["a"](this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(Object(r["k"])(t))return[];const i=Object(St["c"])(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:n}of i.lines){const t={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this.isClosed?1:0},i=new Pt["a"](Object(St["a"])(t),e),r=Object(Te["h"])(Rt);Object(Te["k"])(r,n),Object(f["l"])(i.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1]))),a.push(i)}return a}calculateMapBounds(e){if(Object(r["k"])(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const a=i.vertexAttributes.get("position"),n=new Float64Array(a.data.length);Object(Ce["k"])(a.data,t.spatialReference,0,n,this.view.spatialReference,0,a.data.length/3),Object(Te["k"])(e,n)}return!0}createRenderGeometries(){var e;const t=this.geometry;if(Object(r["k"])(t))return[];const i=Object(St["b"])(t,this.view.elevationProvider,this.view.renderCoordsHelper,ze["a"].fromElevationInfo(null!=(e=this.elevationInfo)?e:new u["a"]({mode:Object(d["d"])(t,null)}))),a=[],n=[];for(const{position:r,mapPosition:s}of i.lines){const e={overlayInfo:null,attributeData:{position:r,mapPosition:s},removeDuplicateStartEnd:this.isClosed?1:0};a.push(Object(St["a"])(e)),n.push(r)}return this._laserline.pathVerticalPlane=n,a}}const Rt=Object(Te["f"])(),At=Object(g["f"])(),Ct=Object(g["f"])();var Tt=i("5241"),Vt=i("8190"),Gt=i("d7f7"),kt=i("b061"),zt=i("35b3"),It=i("5957"),Lt=i("2252"),Ft=i("d272"),Ht=i("c6d7"),Ut=i("8e97"),qt=i("7438"),Bt=i("692f");class Wt extends V["a"]{initializeProgram(e){const t=Wt.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new k["a"](e.rctx,a,Zt)}bindPass(e,t){const{screenSizeEnabled:i,shadingEnabled:a}=this.configuration,{color:n,shadingTint:r,shadingDirection:s}=e;Object(Ut["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",n),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Ht["a"])(this.program,t)),a&&(this.program.setUniform4fv("shadedColor",this.blendColor(Xt,r,n)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(Lt["b"])(this.program,e,t)}bindDraw(e){Object(Ut["d"])(this.program,e),Object(Ut["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(Ft["c"])(this.program,this.configuration,e),this.program.rebindTextures()}blendColor(e,t,i){const a=1-t[3],n=t[3]+i[3]*a;return 0===n?(e[3]=n,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*a)/n,e[1]=(t[1]*t[3]+i[1]*i[3]*a)/n,e[2]=(t[2]*t[3]+i[2]*i[3]*a)/n,e[3]=i[3],e)}setPipelineState(e){const t=this.configuration,i=3===e,a=2===e;return Object(I["f"])({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?qt["g"]:Object(qt["a"])(e),culling:Object(I["b"])(t.cullFace),depthTest:{func:a?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&I["d"]:Object(qt["c"])(e),colorWrite:I["c"],polygonOffset:i||a?null:qt["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}Wt.shader=new T["a"](Bt["a"],()=>i.e("chunk-2d2219c9").then(i.bind(null,"caa6")));class Nt extends G["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(a["a"])([Object(G["b"])({count:8})],Nt.prototype,"output",void 0),Object(a["a"])([Object(G["b"])({count:3})],Nt.prototype,"cullFace",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"slicePlaneEnabled",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"transparent",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"writeDepth",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"screenSizeEnabled",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"shadingEnabled",void 0),Object(a["a"])([Object(G["b"])({count:4})],Nt.prototype,"transparencyPassType",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"multipassTerrainEnabled",void 0),Object(a["a"])([Object(G["b"])()],Nt.prototype,"cullAboveGround",void 0);const Zt=new Map([["position",0],["normal",1],["offset",2]]),Xt=Object(S["e"])();class Yt extends zt["a"]{constructor(e){super(e,Kt),this.supportsEdges=!0,this.techniqueConfig=new Nt,this._vertexAttributeLocations=Zt}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,a,n,r,s){if(this.parameters.screenSizeEnabled){const i=e.vertexAttributes.get("offset"),o={applyToVertex:(e,t,n,r)=>{const s=Object(b["w"])($t,i.data[3*r+0],i.data[3*r+1],i.data[3*r+2]),o=Object(b["w"])(ei,e,t,n);return Object(b["e"])(s,s,this.parameters.screenSize*a.camera.computeRenderPixelSizeAt(s)),Object(b["f"])(o,o,s),[o[0],o[1],o[2]]},applyToAabb:e=>{const t=Object(Te["d"])(e,$t);return Object(Te["v"])(e,this.parameters.screenSize*a.camera.computeRenderPixelSizeAt(t))}};Object(Q["f"])(e,t,a,n,r,o,s)}else Object(Q["f"])(e,t,a,n,r,void 0,s)}requiresSlot(e,t){if(4===Object(kt["b"])(t))return 2===e;let i=2;return this.parameters.transparent&&(i=this.parameters.writeDepth?4:7),e===i||20===e}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new Qt(e):null}createBufferWriter(){return new Jt(this.parameters.screenSizeEnabled)}}class Qt extends Gt["a"]{updateParameters(e){return this.ensureTechnique(Wt,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const Kt={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(b["r"])(Object(g["f"])(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...zt["b"]};class Jt{constructor(e){this.screenSizeEnabled=e;const t=Object(R["a"])().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,a){if(Object(It["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const n=t.vertexAttributes.get("offset"),r=t.indices.get("offset");Object(Y["a"])(3===n.size);const s=i.getField("offset",Vt["u"]);if(!s)throw new Error("unable to acquire view for offset");Object(It["e"])(r,n.data,e.invTranspTransformation,s,a)}}}}const $t=Object(g["f"])(),ei=Object(g["f"])();class ti extends pe{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=vt.colorToVec4(vt.reshapeManipulators.vertex.color),this._size=vt.reshapeManipulators.vertex.size,this._outlineColor=vt.colorToVec4(vt.reshapeManipulators.vertex.outlineColor),this._outlineSize=vt.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(f["g"])(e,this._color)||(Object(f["c"])(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(f["g"])(e,this._outlineColor)||(Object(f["c"])(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(Object(r["k"])(e)||0===e.length)return[];const t=.5,i=.5,a=Object(Tt["c"])(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ze["a"].fromElevationInfo(this.elevationInfo)),n=[],s=a.numVertices,o=a.position;for(let r=0;r<s;++r){const e=Object(b["w"])(ii,o[3*r+0],o[3*r+1],o[3*r+2]),a=ai(t,e),s=ai(i,e);n.push({vertexGeometry:a,vertexOutlineGeometry:s})}return n}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new Yt({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new Yt({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const ii=Object(g["f"])();function ai(e,t){return be["a"].createSphereGeometry(e,16,16,{offset:t})}let ni=class extends _t["a"].EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(a["a"])([Object(o["b"])({constructOnly:!0})],ni.prototype,"graphic",void 0),Object(a["a"])([Object(o["b"])()],ni.prototype,"tracking",void 0),Object(a["a"])([Object(o["b"])()],ni.prototype,"displaying",void 0),Object(a["a"])([Object(o["b"])()],ni.prototype,"isDraped",void 0),ni=Object(a["a"])([Object(h["a"])("esri.views.3d.layers.graphics.GraphicState")],ni);var ri=i("ae3c"),si=i("e7e3"),oi=i("5bab");let ci=class extends ri["a"]{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new u["a"]({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){var t;const i=null==(t=e.hasZ)||t;return{...e,elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}}}return e}initializeGraphic(e){return this._createGraphicState=new ni({graphic:e}),Object(n["b"])([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),Object(s["a"])(this._createGraphicState,"isDraped",e=>{Object(r["l"])(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)})])}makeDrawOperation(){return new si["a"]({view:this.view,manipulators:this.manipulators,geometryType:Object(ri["b"])(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new oi["c"](this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new oi["a"](this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Je})}onActiveVertexChanged(e){return Object(r["l"])(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new ti({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:vt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=vt.colorToVec4(vt.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,Object(n["c"])(()=>{this._activeVertexVisualElement=Object(r["e"])(this._activeVertexVisualElement)}))}onOutlineChanged(e){if(Object(r["l"])(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Dt({view:this.view,geometry:e,elevationInfo:t,isDraped:Object(r["l"])(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(d["c"])(this.hasZ,t),attached:!1}),vt.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),vt.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Object(n["c"])(()=>{this._outlineVisualElement=Object(r["e"])(this._outlineVisualElement)})}onRegularVerticesChanged(e){return Object(r["l"])(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new ti({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:vt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Object(n["c"])(()=>{this._verticesVisualElement=Object(r["e"])(this._verticesVisualElement)}))}};Object(a["a"])([Object(o["b"])({constructOnly:!0})],ci.prototype,"elevationInfo",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],ci.prototype,"geometryType",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],ci.prototype,"type",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],ci.prototype,"view",void 0),ci=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],ci);var li=i("2c4f"),hi=i("9096"),di=i("d3cf"),ui=(i("e06a"),i("6c97")),pi=i("4c37"),bi=i("1c92"),gi=i("dae5"),mi=i("f694"),fi=i("9180"),Oi=i("0cb9");function vi(e,t,i){return _i(e,e.screenToRender(t,Object(Me["b"])(Ve["d"].get())),i)}function _i(e,t,i){const a=Object(Me["b"])(Object(we["c"])(Ve["d"].get(),t));if(a[2]=0,!e.unprojectFromRenderScreen(a,i.origin))return null;const n=Object(Me["b"])(Object(we["c"])(Ve["d"].get(),t));n[2]=1;const s=e.unprojectFromRenderScreen(n,Ve["d"].get());return Object(r["k"])(s)?null:(Object(b["j"])(i.direction,s,i.origin),i)}var yi=i("171c"),ji=i("4ae5");class Mi{constructor(e){this.camera=new yi["a"],this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(C["d"])(),this._worldFrame=null,this._renderLocation=Object(g["f"])(),this._renderLocationDirty=!0,this._location=new ji["a"]({x:0,y:0,z:0}),this._elevationAlignedLocation=new ji["a"],this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new _t["a"].EventEmitter,this._screenLocation={screenPointArray:Object(Me["f"])(),renderScreenPointArray:Object(Me["d"])(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(pi["d"])(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){wi(e)&&(this._screenLocationDirty=!0),Object(A["d"])(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(C["d"])()),xi(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(di["a"])(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(di["a"])(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=Object(r["l"])(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,wi(this._modelTransform)){const t=this._calculateModelTransformOffset(Ii);e=Object(b["f"])(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=Object(Me["i"])(e,Si),a=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(we["a"])(this.screenLocation.screenPointArray,i)<a*a)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(t,Ai),o=a*this.screenLocation.pixelSize,c=vi(this.camera,i,Pi);if(Object(r["k"])(c))return null;for(const i of e){if(0===i.length)continue;const e=Object(b["q"])(Ti,i[0],s);for(let t=1;t<i.length;t++){const a=Object(b["q"])(Vi,i[t],s),r=Object(y["b"])(Object(y["f"])(e,a,Ei),c);if(null!=r&&r<o*o){const t=Object(b["f"])(Ve["d"].get(),e,a);Object(b["e"])(t,t,.5);const i=Object(Me["a"])(Ve["d"].get());return this.camera.projectToRenderScreen(t,i),i[2]+n}Object(b["k"])(e,a)}}break}case"disc":{var s;const e=this.collisionType.direction,t=null!=(s=this.collisionType.offset)?s:g["c"],o=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(o,Ai),l=a*this.screenLocation.pixelSize,h=vi(this.camera,i,Pi);if(Object(r["k"])(h))return null;const d=Object(bi["f"])(Di,c),u=Object(b["x"])(ki,e,d),p=Object(b["q"])(zi,t,c);Object(E["g"])(p,u,Ci);const m=Gi;if(Object(E["m"])(Ci,h,m)&&Object(b["l"])(m,p)<l*l)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,s=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(s,Ai),c=a*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=vi(this.camera,i,Pi);if(Object(r["k"])(l))return null;const h=Object(bi["f"])(Di,o),d=Object(b["x"])(ki,t,h),u=this._calculateModelTransformPosition(zi);Object(E["g"])(u,d,Ci);const p=Gi;if(!Object(E["m"])(Ci,l,p))break;for(const i of e){if(0===i.length)continue;const e=Object(b["q"])(Ti,i[0],o);for(let t=1;t<i.length;t++){const a=Object(b["q"])(Vi,i[t],o),r=Object(y["e"])(Object(y["f"])(e,a,Ei),p);if(null!=r&&r<c*c){const t=Object(b["f"])(Ve["d"].get(),e,a);Object(b["e"])(t,t,.5);const i=Object(Me["a"])(Ve["d"].get());return this.camera.projectToRenderScreen(t,i),i[2]+n}Object(b["k"])(e,a)}}break}default:Object(ui["a"])(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(Object(r["k"])(i.engineLayerId)){const e=new ue["a"]({isPickable:!1,updatePolicy:1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(r["k"])(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(Ce["a"])(this._location.spatialReference,this.view.spatialReference)||(this.location=new ji["a"]({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(Ce["m"])(this.location,Li,e.spatialReference),Object(fi["h"])(e.extent,Li)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(r["k"])(this.elevationInfo))return!1;let t=null,i=0;const a=Object(r["u"])(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(r["u"])(Object(Oi["b"])(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(r["u"])(Object(Oi["b"])(this.view.elevationProvider,e,"ground"),0)+a;break;case"relative-to-scene":i=Object(r["u"])(Object(Oi["b"])(this.view.elevationProvider,e,"scene"),0)+a;break;case"absolute-height":i=a}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=Ai;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),a=(this.focused?2:1)|(this.selected?8:4),n=this._noDisplayCount>0;for(const{stateMask:r,objects:s}of i){if(n){for(const e of s)e.setVisible(!1);continue}const e=!(0!=(15&r))||(a&r)==(15&r),i=!(0!=(65520&r))||(this.state&r)==(65520&r);if(e&&i)for(const a of s)a.setVisible(!0),a.transformation=t;else for(const t of s)t.setVisible(!1)}}_ensureEngineResources(){if(Object(r["k"])(this._engineResources)){const e=Object(r["t"])(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach(({material:e})=>{i.has(e)||(t.push(e),i.add(e))});const a=(e,t)=>{const{geometry:i,material:a,transform:n}=t;Array.isArray(i)?i.forEach(t=>e.addGeometry(t,a,n)):e.addGeometry(i,a,n)},n=new Map;this._renderObjects.forEach(e=>{const t=new de["a"]({castShadow:!1});a(t,e);const i=e.stateMask||0,r=n.get(i)||[];r.push(t),n.set(i,r)});const s=[];n.forEach((e,t)=>s.push({stateMask:t,objects:e})),this._engineResources={objectsByState:s,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(r["k"])(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach(e=>{const t=Object(r["t"])(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)}),e.forEach(({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||Object(r["k"])(this._engineResources))return;const{objectsByState:t,layer:i,materials:a}=this._engineResources;t.forEach(({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)}),a.forEach(e=>{const t=Object(r["t"])(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)}),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,Ri);return Object(b["w"])(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Object(b["j"])(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(A["s"])(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(A["n"])(t,t,this._worldFrame),Object(A["n"])(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(r["l"])(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(Object(r["l"])(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function wi(e){return 0!==e[12]||0!==e[13]||0!==e[14]}function xi(e,t,i){switch(e.viewingMode){case"local":return Object(A["j"])(i),!0;case"global":{const a=Object(mi["e"])(e.renderCoordsHelper.spatialReference);return Object(Ce["t"])(t,0,Ti,0,a.radius),Object(Ce["b"])(Object(w["f"])(Ti[0]),Object(w["f"])(Ti[1]),i),!0}}}const Si=Object(Me["f"])(),Ei=Object(y["d"])(),Pi=Object(j["c"])(),Di=Object(gi["b"])(),Ri=Object(C["d"])(),Ai=Object(C["d"])(),Ci=Object(E["d"])(),Ti=Object(g["f"])(),Vi=Object(g["f"])(),Gi=Object(g["f"])(),ki=Object(g["f"])(),zi=Object(g["f"])(),Ii=Object(g["f"])(),Li=new ji["a"]({x:0,y:0,z:0,spatialReference:null});var Fi=i("ba58");function Hi(e,t=4,i=!0){const a=Object(S["g"])(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return i?new Yt({color:a,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t}):new Ne["a"]({color:a,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t})}function Ui(e,t=4){const i=Object(S["g"])(e[0],e[1],e[2],4===e.length?e[3]:1);return new Ne["a"]({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function qi(e,t,i,a){const n=Object(b["j"])(Ve["d"].get(),e,i),r=Bi(n,Object(b["g"])(Ve["d"].get(),a,n),i,Ve["a"].get());Object(A["c"])(r,r);const s=Object(b["q"])(Ve["d"].get(),t,r);return Math.atan2(s[1],s[0])}function Bi(e,t,i,a){const n=Object(b["r"])(Ve["d"].get(),e),r=Object(b["r"])(Ve["d"].get(),t),s=Object(b["g"])(Ve["d"].get(),n,r);return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=0,a[4]=r[0],a[5]=r[1],a[6]=r[2],a[7]=0,a[8]=s[0],a[9]=s[1],a[10]=s[2],a[11]=0,a[12]=i[0],a[13]=i[1],a[14]=i[2],a[15]=1,a}function Wi(e,t){const i=e.getViewForGraphic(t);return Object(r["l"])(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function Ni(e,t,i){const a=Wi(e,i);Object(r["l"])(a)?t.elevationAlignedLocation=a:Zi(t,i.geometry)}function Zi(e,t){if(Object(r["k"])(t))return;const i="mesh"===t.type?t.anchor:Object(Fi["a"])(t);Object(r["k"])(i)||(e.location=Object(di["b"])(i))}function Xi(e,t=Object(d["e"])(e)){return"on-the-ground"!==t.mode&&!(Object(r["k"])(e.geometry)||!e.geometry.hasZ)}class Yi{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof Mi&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(r["k"])(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}})}}function Qi(e){const{view:t,graphic:i}=e,a=new ni({graphic:i}),r=Ki(e,a),s=[r,Ji(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>Object(n["b"])(s).remove()}}function Ki(e,t){const{view:i,graphic:a}=e,r=new Dt({view:i,geometry:ta(a)?a.geometry:null,elevationInfo:Object(d["e"])(a),attached:!1});vt.visualElements.lineGraphics.shadowStyle.apply(r);const s=()=>{r.attached=t.displaying};vt.visualElements.lineGraphics.outline.apply(r);const o=[t.watch("displaying",s),t.watch("isDraped",e=>r.isDraped=e),t.on("changed",()=>r.geometry=ta(a)?a.geometry:null),Object(n["a"])(r)];return s(),{visualElement:r,remove:()=>Object(n["b"])(o).remove()}}function Ji(e,t,i){const{graphic:a,view:r}=e,s=[],o=Object(d["e"])(a),c="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,l=new Yi,h=new me({view:r,extensionType:vt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});vt.visualElements.pointGraphics.shadowStyle.apply(h);const u=Object(w["f"])(vt.visualElements.heightPlaneAngleCutoff),p=new le({view:r,attached:!1,angleCutoff:u});vt.visualElements.heightPlane.apply(p);let b=1,g=1;const m=()=>{if(l.update(e),!i.displaying||c&&(i.isDraped||!ta(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(p.attached=!1);t.laserlineEnabled=!0;{const e=4&l.grabbingState?vt.visualElements.laserlineAlphaMultiplier:1;e!==b&&(b=e,vt.visualElements.lineGraphics.shadowStyle.apply(t,e),vt.visualElements.pointGraphics.shadowStyle.apply(h,e))}{const e=2&l.grabbingState?vt.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,vt.visualElements.heightPlane.apply(p,e))}$i(h,l),ea(e,t,p,l)};vt.visualElements.zVerticalLine.apply(h),s.push(i.on("changed",m),i.watch("displaying",m),t.events.on("attachment-origin-changed",m),Object(n["a"])(h),Object(n["a"])(p));const f=[],O=()=>{Object(n["b"])(f).remove(),f.length=0,e.forEachManipulator(e=>f.push(e.events.on("grab-changed",m))),e.forEachManipulator(e=>f.push(e.events.on("select-changed",m))),m()};return O(),s.push(e.onManipulatorsChanged(O),Object(n["d"])(()=>Object(n["b"])(f))),Object(n["b"])(s)}function $i(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(r["l"])(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(r["l"])(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}function ea(e,t,i,a){if(a.numSelected>0){Object(b["w"])(ia,0,0,0);let t=0;e.forEachManipulator((e,i)=>{1===i&&e.selected&&e instanceof Mi&&(Object(b["f"])(ia,ia,e.renderLocation),t++)}),t>0?(i.heightManifoldTarget=Object(b["e"])(ia,ia,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;Object(r["l"])(a)&&e.view.renderCoordsHelper.toRenderCoords(a,ia)?(i.heightManifoldTarget=ia,i.attached=!0):i.attached=!1}}function ta(e){return Object(r["l"])(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ia=Object(g["f"])();function aa(e){const{view:t,graphic:i}=e,a=new ni({graphic:i}),r=[],s=ra(e,a,r);return na(e,a,r,s),r.push(t.trackGraphicState(a)),{visualElement:s,remove(){Object(n["b"])(r).remove()}}}function na(e,t,i,a){const{view:s,graphic:o}=e,c=new me({view:s,extensionType:vt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});vt.visualElements.zVerticalLine.apply(c);const l=new le({view:s,intersectsLineInfinite:!0,attached:!1});vt.visualElements.pointGraphics.shadowStyle.apply(l);const h=Object(w["f"])(vt.visualElements.heightPlaneAngleCutoff),u=new le({view:s,attached:!1,angleCutoff:h});vt.visualElements.heightPlane.apply(u);const p=Object(d["e"])(e.graphic),g=ze["a"].fromElevationInfo(p),m="on-the-ground"===p.mode||!p.offset&&"absolute-height"!==p.mode,f=new Yi;let O=1,v=1;const _=()=>{f.update(e);const i=sa(o),n=m&&(t.isDraped||Object(r["k"])(i)||!i.hasZ);let h=!0;if(!n&&Object(r["l"])(i)){const e=Object(ke["f"])(i,s.elevationProvider,g,s.renderCoordsHelper);Object(b["w"])(ha,i.x,i.y,e),Object(Ce["r"])(ha,i.spatialReference,ha,s.renderCoordsHelper.spatialReference),c.setStartEndFromWorldDownAtLocation(ha),l.intersectsWorldUpAtLocation=ha}else h=!1;const d=2&f.grabbingState?vt.visualElements.laserlineAlphaMultiplier:1;d!==O&&(O=d,vt.visualElements.heightPlane.apply(u,d));const p=Object(Te["h"])(da);!n&&t.displaying&&a.calculateMapBounds(p)&&Object(Ce["r"])(Object(Te["q"])(p,ha),s.spatialReference,ha,s.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=ha,u.attached=!0):u.attached=!1;const _=4&f.grabbingState?vt.visualElements.laserlineAlphaMultiplier:1;_!==v&&(v=_,vt.visualElements.pointGraphics.shadowStyle.apply(l,_));const y=h&&t.displaying&&!n;l.attached=y,c.attached=y};i.push(t.watch(["displaying","isDraped"],_),t.on("changed",_)),e.forEachManipulator(e=>{i.push(e.events.on("grab-changed",_))}),i.push(Object(n["a"])(l)),i.push(Object(n["a"])(c)),i.push(Object(n["a"])(u)),_()}function ra(e,t,i){const{view:a,graphic:r}=e,s=new He({view:a,geometry:sa(r),elevationInfo:Object(d["e"])(r),attached:!1});return oa(e,s,t,i),i.push(Object(n["a"])(s)),s}function sa(e){const t=e.geometry;return Object(r["k"])(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}function oa(e,t,i,a){const n=()=>t.attached=i.displaying;ca(e,t,i,a),vt.visualElements.pointGraphics.outline.apply(t),a.push(Object(s["a"])(i,"displaying",n))}function ca(e,t,i,a){const{view:s,graphic:o}=e;let c=null;const l=e=>{Object(r["l"])(c)&&(c.remove(),c=null),i.isDraped&&Object(r["l"])(e)&&(c=la(s,e,()=>{t.geometry=e}))},h=()=>{const e=sa(o);l(e),t.geometry=e};a.push(i.on("changed",h),Object(n["d"])(()=>c)),h()}function la(e,t,i){const a=e.elevationProvider.spatialReference;Object(Ce["n"])(t,ha,a);const n=ha[0],r=ha[1];return e.elevationProvider.on("elevation-change",e=>{Object(fi["j"])(e.extent,n,r)&&i()})}const ha=Object(g["f"])(),da=Object(Te["f"])();function ua(e){switch(Object(r["t"])(e.graphic.geometry).type){case"point":case"mesh":return aa(e);case"polygon":case"polyline":return Qi(e);default:return null}}const pa=[1,.5,0],ba=128,ga=70,ma=80,fa=.02,Oa=54,va=100,_a=Math.ceil(ga/3*2),ya=160,ja=.5,Ma=24,wa=9,xa=ya+30,Sa=ya+53,Ea=60,Pa=23,Da=5*Math.PI/12,Ra=1*Math.PI/3,Aa=10,Ca=.2,Ta=30,Va=53,Ga=.2,ka=.3,za=200,Ia=3,La=1e6;class Fa{constructor(){this._available=!0}set location(e){this.forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this.forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this.forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this.forEachManipulator3D(t=>{e||(e=t.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D(t=>t.available=e)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(i=>{!t&&e(i)&&(t=!0)}),t}forEachManipulator3D(e){this.forEachManipulator((t,i)=>{t instanceof Mi&&e(t,i)})}}var Ha=i("a1b1"),Ua=(i("9250"),i("89bf"),i("c20d"));function qa(e,t){return Wa(e,()=>t)}function Ba(e){return Wa(e,e=>e.plane)}function Wa(e,t){const i=Object(g["f"])(),a=Object(g["f"])();let n=!1;return s=>{const o=t(s);if("start"===s.action){const t=Object(Me["i"])(s.screenStart,Object(Me["c"])(Ve["c"].get())),a=vi(e.state.camera,t,an);Object(r["l"])(a)&&(n=Object(E["m"])(o,a,i))}if(!n)return null;const c=Object(Me["i"])(s.screenEnd,Object(Me["c"])(Ve["c"].get())),l=vi(e.state.camera,c,an);return Object(r["k"])(l)?null:Object(E["m"])(o,l,a)?{...s,renderStart:i,renderEnd:a,plane:o,ray:l}:null}}function Na(e,t,i,a=null,n=null){let s=null;return o=>{if("start"===o.action&&(s=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(Me["f"])(o.screenStart.x,o.screenStart.y),t,i,n),Object(r["l"])(s)&&Object(r["l"])(a)&&!Object(Ce["m"])(s,s,a)))return null;if(Object(r["k"])(s))return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(Me["f"])(o.screenEnd.x,o.screenEnd.y),t,i,n);return Object(r["l"])(c)?Object(r["l"])(a)&&!Object(Ce["m"])(c,c,a)?null:{...o,mapStart:s,mapEnd:c}:null}}function Za(e,t,i,a=null,n=null){return Na(e,i,Object(d["g"])(t,e,i),a,n)}function Xa(e,t,i,a=null,n=null){return Za(e,i,Object(d["e"])(t),a,n)}function Ya(e,t,i,a){const n=t.toMap(e.screenStart,{include:[i]});return Object(r["l"])(n)?Xa(t,i,n,a):null}function Qa(e,t){const i=en,a=tn,n=Object(E["d"])();e.renderCoordsHelper.worldUpAtPosition(t,i);const r=Object(b["g"])(n,i,Object(b["j"])(a,t,e.state.camera.eye));return Object(b["g"])(r,r,i),Object(E["g"])(t,r,n)}function Ka(e,t,i){let a=null;const n=new Ua["a"];return n.next(qa(e,Qa(e,t))).next(Ja(e,t)).next($a(e,i)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,a=e}),e=>(a=null,n.execute(e),a)}function Ja(e,t){const i=Object(g["f"])(),a=Object(b["p"])(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const n=Object(g["f"])(),r=Object(g["f"])(),s=n=>(Object(b["j"])(n,n,t),Object(Ha["c"])(i,n,n),"global"===e.viewingMode&&Object(b["p"])(n)*Math.sign(Object(b["h"])(i,n))<.001-a&&Object(b["j"])(n,Object(b["e"])(n,i,.001),t),Object(b["f"])(n,n,t),n);return e=>(e.renderStart=s(Object(b["k"])(n,e.renderStart)),e.renderEnd=s(Object(b["k"])(r,e.renderEnd)),e)}function $a(e,t){const i=e.renderCoordsHelper;return e=>{const a=i.fromRenderCoords(e.renderStart,t),n=i.fromRenderCoords(e.renderEnd,t);return Object(r["l"])(a)&&Object(r["l"])(n)?{...e,mapStart:a,mapEnd:n}:null}}const en=Object(g["f"])(),tn=Object(g["f"])(),an=Object(j["c"])();function nn(e,t,i,a){const n=e.graphic,r=(e,i)=>t({action:e,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i((e,t,i)=>{const s=t.next(e=>("start"===e.action&&r("start",e),e)).next(Object(Ua["g"])(n,a)).next(e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e});return i.next(Object(Ua["i"])(n)).next(()=>{r("end",{screenDeltaX:0,screenDeltaY:0})}),s})}function rn(e){if(Object(r["k"])(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}class sn extends Fa{constructor(e){super(),this._handles=new m["a"],this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=ga,this._updateAfterDrag=!1,this.events=new _t["a"],this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._handles=Object(r["e"])(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,1)}createGraphicDragPipeline(e,t,i){const a=t.graphic,n=Object(d["e"])(a),s=Object(r["t"])(a.geometry).spatialReference;return nn(t,i,t=>this.createDragPipeline((i,a,n,r,s)=>t(i,e(i,a,n,r,s),n),n,s,a),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){return Object(n["b"])(this._arrowManipulatorInfos.map(({manipulator:n},r)=>Object(Ua["e"])(n,(n,s,o,c,l)=>{const h=s.next(e=>({...e,manipulatorType:1})).next(Object(Ua["f"])(this._view,n.elevationAlignedLocation)).next(Za(this._view,n.elevationAlignedLocation,t,i,a)).next(Object(Ua["d"])(n.location,this.angle+(r+1)*Math.PI*.5)).next(Object(Ua["c"])());e(n,h,o,c,l)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const a=this._radius/ga,n=Oa*a,r=n*Math.sqrt(3)/2,s=be["a"].createExtrudedTriangle(r,n/2,n/2,fa);be["a"].transformInPlace(s,Object(A["v"])(Ve["a"].get(),Object(b["w"])(Ve["d"].get(),0,-r/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],e.radius=r/3*2*1.2;const o=Object(A["j"])(Ve["a"].get());Object(A["a"])(o,i*Math.PI/2);const c=Object(A["j"])(Ve["a"].get());Object(A["v"])(c,Object(b["w"])(Ve["d"].get(),0,va*a,0)),Object(A["n"])(t,o,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(A["j"])(Ve["a"].get());Object(A["f"])(t,t,e,Object(g["h"])(0,0,1));const i=Object(A["w"])(Ve["a"].get(),Object(b["w"])(Ve["d"].get(),this.displayScale,this.displayScale,this.displayScale)),a=Object(A["j"])(Ve["a"].get());Object(A["n"])(a,i,t);for(const n of this._arrowManipulatorInfos){const e=Object(A["n"])(Ve["a"].get(),a,n.transform);n.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new Mi({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(g["h"])(0,0,1)}}),i={manipulator:t,transform:Object(C["d"])()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),i}createMaterial(e=1){const t=p["a"].toUnitRGBA(tt.main);return t[3]*=e,new Ne["a"]({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}}class on{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Ua["a"],this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(r["l"])(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(Object(r["l"])(i)){const a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}snap(e){const t=Object(r["l"])(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(r["l"])(t)&&Object(r["l"])(this.view)&&(t.z=Object(d["g"])(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return Object(r["l"])(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class cn extends Fa{constructor(e){super(),this._handles=new m["a"],this._snapToScene=new on,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=ga,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const a=t.graphic,n=Object(d["e"])(a),s=Object(r["t"])(a.geometry).spatialReference;return nn(t,i,t=>this.createDragPipeline((i,a,n,r,s)=>t(i,e(i,a,n,r,s),n),n,s,a),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){const n=this._view;return Object(Ua["e"])(this._manipulator,(r,s,o,c,l)=>{const h=s.next(Object(Ua["f"])(n,r.elevationAlignedLocation)).next(Za(n,r.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(n,t),this._snapToScene.next).next(e=>({...e,manipulatorType:1})).next(Object(Ua["c"])());e(r,h,o,c,l)})}_updateManipulatorTransform(){const e=Object(A["w"])(Ve["a"].get(),Object(b["w"])(Ve["d"].get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Mi({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(g["h"])(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=be["a"].createCylinderGeometry(fa,1,ba,Object(g["h"])(0,0,1),Object(g["h"])(0,0,0)),t=Object(A["w"])(Object(C["d"])(),Object(g["h"])(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=ma*(this._radius/ga)}_createMaterial(e=1){const t=p["a"].toUnitRGBA(tt.main);return t[3]*=e,new Ne["a"]({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class ln extends Fa{constructor(e){super(),this._handles=new m["a"],this._radius=ga,this.events=new _t["a"],this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){const a=Object(r["t"])(t.graphic.geometry).spatialReference;return nn(t,i,t=>this.createDragPipeline((i,a,n,r,s)=>t(i,e(i,a,n,r,s),n),a),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return Object(Ua["e"])(this._manipulator,(a,n,r,s,o)=>{const c=n.next(e=>({...e,manipulatorType:0})).next(Ka(i,a.renderLocation,t)).next(Object(Ua["c"])());e(a,c,r,s,o)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/ga,t=vt.zManipulator.height*e,i=vt.zManipulator.coneHeight*e,a=vt.zManipulator.coneWidth*e,n=vt.zManipulator.width*e,r=[Object(g["h"])(0,0,0),Object(g["h"])(0,0,t)],s=be["a"].createTubeGeometry(r,n/2,16,!1),o=be["a"].createConeGeometry(i,a/2,16,!1),c=[Object(g["h"])(0,0,0),Object(g["h"])(0,0,t+i)],l=e=>{const i=Object(C["d"])();if(Object(A["b"])(i,i,[0,0,t]),Object(A["e"])(i,i,Math.PI/2),e){const t=1+2*e/a;Object(A["g"])(i,i,[t,t,t])}return i},h=l(0),d=(e,t)=>{const i=Object($e["a"])(vt.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,vt.zManipulator.color.a*e]},u=Hi(d(1,.25),1),p=Hi(d(1,0),1),b=Hi(d(.7,0),vt.zManipulator.renderOccluded),m=Hi(d(.85,0),vt.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:h,material:u,stateMask:1},{geometry:s,material:u,stateMask:1},{geometry:o,transform:h,material:p,stateMask:2},{geometry:s,material:p,stateMask:2},{geometry:o,transform:h,material:b,stateMask:1},{geometry:s,material:b,stateMask:1},{geometry:o,transform:h,material:m,stateMask:2},{geometry:s,material:m,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}createManipulator(){const e=new Mi({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=hn;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=Object(b["n"])(t.eye,i),n=t.computeRenderPixelSizeAtDist(a),r=Object(b["j"])(dn,i,t.eye);Object(b["r"])(r,r);const s=un;this._view.renderCoordsHelper.worldUpAtPosition(hn,s);const o=Math.abs(Object(b["h"])(r,s)),c=Object(b["g"])(dn,r,s),l=Object(b["g"])(dn,c,s),h=Object(w["d"])(o,.01,1),d=1-Math.sqrt(1-h*h)/h/t.fullWidth,u=this._radius/ga,p=vt.zManipulator.width*u;Object(b["e"])(l,Object(b["r"])(l,l),(1/d-1)*a+n*p),e[12]-=dn[0],e[13]-=dn[1],e[14]-=dn[2]},this._manipulator=e,this.updateManipulator()}get test(){return{manipulator:this._manipulator}}}const hn=Object(g["f"])(),dn=Object(g["f"])(),un=Object(g["f"])();class pn extends Fa{constructor(e){super(),this._handles=new m["a"],this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:n}=e;this._view=i,this.xyManipulation=new cn({tool:t,view:i,snapToScene:a,radius:n}),this.xyAxisManipulation=new sn({tool:t,view:i,radius:n}),this.zManipulation=new ln({tool:t,view:i,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator(e=>{this._handles.add(e.events.on("grab-changed",()=>this.updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(n["b"])([this.xyManipulation.createGraphicDragPipeline((t,i,a,n,r)=>e(0,t,i,a,n,r),t,i),this.xyAxisManipulation.createGraphicDragPipeline((t,i,a,n,r)=>e(1,t,i,a,n,r),t,i),this.zManipulation.createGraphicDragPipeline((t,i,a,n,r)=>e(2,t,i,a,n,r),t,i)])}createDragPipeline(e,t,i,a){return Object(n["b"])([this.xyManipulation.createDragPipeline((t,i,a,n,r)=>e(0,t,i,a,n,r),t,i,a),this.xyAxisManipulation.createDragPipeline((t,i,a,n,r)=>e(1,t,i,a,n,r),t,i,a),this.zManipulation.createDragPipeline((t,i,a,n,r)=>e(2,t,i,a,n,r),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,1)),this.xyAxisManipulation.forEachManipulator(t=>e(t,1)),this.zManipulation.forEachManipulator(t=>e(t,0))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator(e=>e.focused)||this.xyAxisManipulation.someManipulator(e=>e.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(c["a"])("esri-mobile"))return;const i=[];t.forEachManipulator(e=>i.push(e)),e.forEachManipulator(e=>i.push(e));const a=()=>{const t=[];this.xyAxisVisible?Object(r["l"])(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator(e=>t.push(e.disableDisplay())),this._handles.remove(bn),this._handles.add(t,bn)};for(const n of i)this._handles.add(n.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=Object(r["l"])(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some(e=>"icon"===e.type)?_a:ga}}const bn="disable-xy-axis-display";var gn=i("3cde");class mn extends Fa{constructor(e){super(),this._handles=new m["a"],this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return nn(this._graphicState,e,e=>this.createDragPipeline(e),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=Object(r["l"])(i.geometry)?i.geometry.spatialReference:null;return Object(Ua["e"])(this._manipulator,(n,r,s,o,c)=>{const l=r.next(Ya(c,t,i,a)).next(Object(Ua["b"])()).next(Object(Ua["c"])());e(n,l,s,o,c)})}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new gn["a"]({graphic:t,view:e,selectable:!0,cursor:"move"})}}var fn=i("243f"),On=i("4772"),vn=i("2c8f"),_n=i("1f1c"),yn=i("8a19");class jn{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Mn{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class wn{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let xn=class extends(Object(hi["b"])(_t["a"].EventedMixin(On["a"]))){constructor(e){super(e),this.graphics=new li["a"],this.enableZ=!0,this.type="move-3d",this._toolHandles=new m["a"],this.snappingPipeline=new yn["a"]}initialize(){this._toolHandles.add([this.graphics.on("change",()=>this._refreshManipulators())]),this._refreshManipulators(),this.complete()}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(e=>0===Object(fn["a"])(e)).map(e=>new Sn(e));e.length&&(this.createManipulators(e),this.createVisualElements(e),this.handles.add(e.map(e=>this.view.trackGraphicState(e.state))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new mn({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator(e=>this.handles.add(e.events.on("immediate-click",e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))),this.handles.add(t.manipulationXY.createDragPipeline((t,i,a,n)=>this.buildDragEventPipeline(e,0,t,i,a,n)))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new pn({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?pn.radiusForSymbol(e[0].graphic.symbol):ga});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(e=>{this.handles.add(e.events.on("immediate-click",i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()}))});const i=()=>this.updateMoveManipulation(e);for(const n of e)this.handles.add([n.state.on("changed",i),n.state.watch("displaying",i)]);const a=e[e.length-1];this.handles.add(a.state.on("changed",()=>this.updateMoveManipulationAngle(a))),this.handles.add(t.createDragPipeline((t,i,a,n,r)=>this.buildDragEventPipeline(e,t,i,a,n,r),Object(d["e"])(a.graphic),Object(r["t"])(a.graphic.geometry).spatialReference,a.graphic)),this.updateMoveManipulationAngle(a)}createVisualElements(e){for(const t of e){const i=t.graphic,a=ua({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(n["c"])()});Object(r["k"])(a)||(t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof Dt&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this.updateMoveManipulation(e)}),t.state.watch("isDraped",()=>this.updateMoveManipulation(e))]),this.handles.add(a))}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>rn(e.graphic.geometry)}updateMoveManipulation(e){const t=Object(yt["g"])(0,0,0,this.view.spatialReference);let i=0,a=!1;const n=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const e=s.state.graphic;this.enableZ&&Xi(e)&&(a=!0);const n=s.geometryRepresentation instanceof Dt&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Wi(this.view,e);Object(r["l"])(n)&&(t.x+=n.x,t.y+=n.y,t.z+=n.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,n.location=t,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=a):n.available=!1}buildDragEventPipeline(e,t,i,a,n,r){const s=[],o=[];let c=null,l=null;const h=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){const t=e[0].graphic;a=this.buildSnappingPipelineSteps(t,Object(d["e"])(t),a,n,r)}const u=a.next(t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(Ua["h"])(o,this.view.state.viewingMode),l=Object(Ua["j"])(o),this.emit("graphic-move-start",new jn(o)),this.destroyed))return null}return 0!==o.length?t:null}).next(e=>c(e)).next(e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,n=i.y-t.y;if(this.emit("graphic-move",new Mn(a,n,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new wn(o)),this.destroyed)return null;h()}});return n.next(e=>l(e)).next(()=>{if(this.emit("graphic-move-stop",new wn(o)),this.destroyed)return null;h()}),u}buildSnappingPipelineSteps(e,t,i,a,n){const s=e.geometry;if(Object(r["k"])(s)||"point"!==s.type&&"mesh"!==s.type)return i;const o=("point"===s.type?s:s.anchor).clone(),c=new _n["a"]({elevationInfo:t,pointer:n,editGeometryOperations:vn["a"].fromGeometry(o,this.view.state.viewingMode),visualizer:new Je,excludeFeature:e}),l=this.snappingManager;return i.next(t=>(o.z=Object(d["a"])(this.view,o,Object(d["e"])(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:c.coordinateHelper.pointToVector(o)})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:a,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xn.prototype,"view",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],xn.prototype,"graphics",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xn.prototype,"enableZ",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],xn.prototype,"snappingManager",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],xn.prototype,"type",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],xn.prototype,"updating",null),xn=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],xn);class Sn{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ni({graphic:e})}get graphic(){return this.state.graphic}}var En=i("240c"),Pn=i("521c"),Dn=i("ac8e"),Rn=i("5414");function An(e,t,i){const a="on-the-ground"===i.mode?1:0;return new Rn["a"](e,a,t,0)}function Cn(e,t,i){const a=Object(g["f"])();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;const n=Tn(e,t,Object(E["q"])(i.plane)),s=Tn(e,t,i.edgeDirection);if(Object(r["k"])(n)||Object(r["k"])(s))return null;const o=Object(b["g"])(Object(g["f"])(),n,s);return Object(E["g"])(a,o,Object(E["d"])())}function Tn(e,t,i){const a=Object(yt["g"])(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=Object(g["f"])(),r=Object(g["f"])();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(a,r)?Object(b["v"])(r,n,r):null}function Vn(e,t,i){const a=Object(E["q"])(e),n=Object(b["v"])(Object(g["f"])(),t,i),r=Object(b["g"])(Object(g["f"])(),n,a),s=Object(b["g"])(Object(g["f"])(),n,r);return Object(C["e"])(n[0],n[1],n[2],0,r[0],r[1],r[2],0,s[0],s[1],s[2],0,0,0,0,1)}function Gn(e,t,i){const a=i.projectToRenderScreen(e,Object(Me["d"])()),n=i.projectToRenderScreen(t,Object(Me["d"])());return Object(r["l"])(a)&&Object(r["l"])(n)?Object(b["t"])(Object(b["j"])(a,a,n)):0}let kn=class extends(_t["a"].EventedMixin(hi["a"])){constructor(e){super(e),this._vertexManipulatorMaterial=Hi(vt.colorToVec4(vt.reshapeManipulators.vertex.color),vt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Ui(vt.colorToVec4(vt.reshapeManipulators.vertex.outlineColor),vt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Ui(vt.colorToVec4(vt.reshapeManipulators.vertex.hoverOutlineColor),vt.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Hi(vt.colorToVec4(vt.reshapeManipulators.edge.color),vt.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Ui(vt.colorToVec4(vt.reshapeManipulators.edge.outlineColor),vt.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=Hi(vt.colorToVec4(vt.reshapeManipulators.edgeOffset.color),vt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Hi(vt.colorToVec4(vt.reshapeManipulators.edgeOffset.hoverColor),vt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=Hi(vt.colorToVec4(vt.reshapeManipulators.selected.color),vt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Ui(vt.colorToVec4(vt.reshapeManipulators.selected.outlineColor),vt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Ui(vt.colorToVec4(vt.reshapeManipulators.selected.hoverOutlineColor),vt.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new m["a"],this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new yn["a"],this._snappingPipelineHandle=new yn["a"],this._vertexLaserLineVisualElement=null}initialize(){const e=new ni({graphic:this.graphic});this._graphicState=e,this.handles.add([e.watch("displaying",e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e}),this.view.trackGraphicState(e)])}destroy(){this._editGeometryOperations=Object(r["e"])(this._editGeometryOperations),this._moveManipulation=Object(r["e"])(this._moveManipulation),this._graphicMoveManipulation=Object(r["e"])(this._graphicMoveManipulation),this._manipulatorHandles=Object(r["e"])(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return Object(r["l"])(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const e=this._manipulatorInfos.filter(e=>e.manipulator.selected&&"vertex"===e.handle.type);this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=Object(r["e"])(this._moveManipulation),this._graphicMoveManipulation=Object(r["e"])(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(Object(r["k"])(this._editGeometryOperations))return;const e=Object(d["e"])(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return Object(r["l"])(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return Object(r["l"])(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(Object(r["k"])(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return Object(r["l"])(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(Object(r["k"])(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return Object(r["l"])(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),Object(r["k"])(e)||(Object(r["e"])(this._editGeometryOperations),this._editGeometryOperations=vn["a"].fromGeometry(e,this.view.state.viewingMode),this._createManipulators())}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;let i=0;const a=[],n=this._manipulatorInfos.some(e=>"vertex"===e.handle.type&&e.manipulator.selected),r=1===e&&n;for(const s of this._manipulatorInfos)In(s)&&(s.manipulator.grabbing||r&&!s.manipulator.selected||a.push(s),i++);if(0!==a.length)if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)In(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const n=[];for(const r of this._manipulatorInfos)In(r)&&(r.manipulator.selected&&!r.manipulator.grabbing||r===e.info)&&n.push(r);this._moveVertices(n,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){if(this._graphicMoveManipulation=new mn({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((t,i,a)=>{i.next(e=>this._trackNumDragging(e)).next(t=>("start"===t.action&&(e=Object(r["t"])(this._editGeometryOperations).createUndoGroup()),t)).next(t=>{this._perGraphicManipulatorDragAction(0,t),"end"===t.action&&(e=Object(r["s"])(e))}),a.next(this._cancelDragOperation(()=>e=Object(r["s"])(e)))}))}else this._graphicMoveManipulation.forEachManipulator(e=>{e.grabbable=!1,e.cursor=null});this._graphicMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})])),this._moveManipulation=new pn({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Xi(this.graphic),snapToScene:!1,radius:pn.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator(e=>{this.handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})])}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=Object(r["t"])(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline((t,i,a,n,s)=>{const o=a.next(e=>this._trackNumDragging(e)).next(e=>{const t=this._manipulatorInfos.filter(e=>In(e)&&e.manipulator.selected);return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}}).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:n,snappingManager:this.tool.snappingManager,snappingContext:new _n["a"]({editGeometryOperations:Object(r["t"])(this._editGeometryOperations),elevationInfo:e,pointer:s,excludeFeature:this.graphic,visualizer:new Je}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(Object(Ua["b"])()).next(e=>(this._perGraphicManipulatorDragAction(1,e),e));return n.next(this._cancelDragOperation()),o},e,t,this.graphic),Object(s["a"])(this._graphicState,"displaying",()=>{this._updateMoveManipulationPosition()}),this._graphicState.on("changed",()=>this._updateMoveManipulationPosition()),Object(s["a"])(this._graphicState,"isDraped",()=>{const e="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),e):this.handles.remove(e)})]),this._updateMoveManipulationPosition();const i=ua({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){Object(r["l"])(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});Object(r["l"])(i)&&(this._outlineVisualElement=i.visualElement instanceof Dt?i.visualElement:null),Object(r["l"])(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}),this._graphicState.watch("isDraped",()=>this._updateMoveManipulationPosition())]),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=Object(d["e"])(this.graphic)){const i=vt.reshapeManipulators.edgeOffset,a=i.size/2,s=a+i.collisionPadding;if(Object(r["k"])(this._edgeOffsetManipulatorGeometryInside)||Object(r["k"])(this._edgeOffsetManipulatorGeometryOutside)){const e=a/s,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=be["a"].createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=be["a"].createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset)}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],c=new Mi({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||Object(Dn["i"])(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(g["h"])(0,0,1)},collisionPriority:1}),l=new Mi({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),h={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:l,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(h,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(h);const u=this._getManipulatorInfoFromHandle(h.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(h)),p=this._getManipulatorInfoFromHandle(h.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(h));h.locationUpdateHandle=Object(n["b"])([u,p]),this._manipulatorHandles.add(h.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(l,!0)],c),this._manipulatorHandles.add(Object(Ua["e"])(c,this._createEdgeOffsetPipeline(h,t)),c),this._manipulatorHandles.add(Object(Ua["e"])(l,(e,i,a,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(h,t)(e,i,a);else if(this.enableMoveGraphic){const n=this.graphic,s=Object(r["l"])(n.geometry)?n.geometry.spatialReference:null;i.next(e=>this._trackNumDragging(e)).next(Object(Ua["f"])(this.view,e.elevationAlignedLocation)).next(Za(this.view,e.elevationAlignedLocation,t,s,n)).next(Object(Ua["c"])()).next(Object(Ua["b"])()).next(e=>this._perGraphicManipulatorDragAction(0,e)),a.next(this._cancelDragOperation())}}),c);const b=e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",b),l.events.on("immediate-click",b)],c),this._manipulatorInfos.push(h),this.manipulators.add(c),this.manipulators.add(l),this.emit("manipulators-changed"),h}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,s=()=>{Object(r["s"])(e.visibilityHandle);const s=Gn(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||s)&&(i.grabbable=!s,a.grabbable=!s,e.visibilityHandle=Object(n["b"])([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),a.events.on("focus-changed",s),{remove:()=>{Object(r["s"])(e.visibilityHandle),this.manipulators.remove(a)}}],i),s()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=Object(r["t"])(this._editGeometryOperations).data.coordinateHelper,i=Cn(this.view,e.manipulator.elevationAlignedLocation,An(t,e.handle,Object(r["t"])(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,s=Object(r["l"])(i)?Vn(i,a,n):C["a"];e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const o=Object(b["p"])(Object(b["j"])(Hn,a,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,n)=>{this._clearSelection();const{step:s,cleanup:o}=this._initializeEdgeOffset(e,t);a.next(e=>this._trackNumDragging(e)).next(Object(Ua["f"])(this.view,i.elevationAlignedLocation)).next(s).next(Ba(this.view)).next($a(this.view,Object(r["t"])(this._editGeometryOperations).data.spatialReference)).next(Object(Ua["b"])()).next(this._applyEdgeOffsetStep(e)).next(e=>{"end"===e.action&&o()}),n.next(e=>(o(),e)).next(this._cancelDragOperation())}}_initializeEdgeOffset(e,t){const i=Object(r["t"])(this._editGeometryOperations),a=An(i.data.coordinateHelper,e.handle,t),s=i.createUndoGroup(),o=Cn(this.view,e.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const c=()=>new Pn["a"]({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:Object(r["t"])(this._editGeometryOperations).data.spatialReference}),l=new Dt({view:this.view,isDraped:this._graphicState.isDraped,geometry:c(),elevationInfo:e.elevationInfo,width:vt.visualElements.lineGraphics.outline.width,color:vt.colorToVec4(tt.main),attached:!0});let h;const d=()=>{this._cleanEdgeOffsetCollapsedEdges(e),h=Object(r["s"])(h)},u=this.on("undo",d);return h=Object(n["b"])([Object(n["a"])(l),this._graphicState.watch("isDraped",e=>l.isDraped=e),this._graphicState.on("changed",()=>l.geometry=c()),s,u]),{step:e=>Object(r["k"])(a)||Object(r["k"])(o)?(d(),null):{...e,operation:a,plane:o},cleanup:d}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||Object(r["k"])(t.operation))return t;this._updateEventState(2);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=t;return(i||a||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const a=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,n=e.handle.leftVertex,s=null==(i=e.handle.rightVertex.rightEdge)?void 0:i.rightVertex,o=e.handle.rightVertex,c=Object(r["t"])(this._editGeometryOperations).data.coordinateHelper,l=1e-6,h=[];a&&c.distance(a.pos,n.pos)<l&&h.push(this._getManipulatorInfoFromHandle(n)),(c.distance(n.pos,o.pos)<l||s&&c.distance(s.pos,o.pos)<l)&&h.push(this._getManipulatorInfoFromHandle(o)),h.length&&this._removeVertices(h)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=Object(d["e"])(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(Object(r["k"])(this._vertexManipulatorGeometry)||Object(r["k"])(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(vt.reshapeManipulators.vertex);this._vertexManipulatorGeometry=be["a"].createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=be["a"].createSphereGeometry(t,16,16)}if(Object(r["k"])(this._edgeManipulatorGeometry)||Object(r["k"])(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(vt.reshapeManipulators.edge);this._edgeManipulatorGeometry=be["a"].createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=be["a"].createSphereGeometry(t,16,16)}const i=Object(r["l"])(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Un.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Un.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Un.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Un.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Un.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Un.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Un.Edge});const a=new Mi({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(a,e,t);const s="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(a),this._updateManipulatorPosition(s),"edge"===s.type){const e=this._getManipulatorInfoFromHandle(s.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s)),t=this._getManipulatorInfoFromHandle(s.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s));s.locationUpdateHandle=Object(n["b"])([e,t]),this._manipulatorHandles.add(s.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const o=Object(Ua["e"])(a,(e,i,a,n)=>{let o=null;i.next(e=>this._trackNumDragging(e)).next(e=>{if("start"===e.action&&(o=Object(r["t"])(this._editGeometryOperations).createUndoGroup()),Ln(s)){const t=this._splitEdgeManipulator(s);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:s,snapOrigin:s.handle.pos}}).next(Object(Ua["f"])(this.view,e.elevationAlignedLocation)).next(Xa(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new _n["a"]({editGeometryOperations:Object(r["t"])(this._editGeometryOperations),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new Je}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(Object(Ua["b"])()).next(e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(o=Object(r["s"])(o))}),a.next(this._cancelDragOperation(()=>o=Object(r["s"])(o)))});return this._manipulatorHandles.add(o,a),this._manipulatorHandles.add([a.events.on("immediate-click",e=>this._manipulatorClickCallback(e,s)),a.events.on("select-changed",()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})],a),this.emit("manipulators-changed"),s}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=Object(r["l"])(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,Object(r["l"])(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Un.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=vt.reshapeManipulators.vertex.size/2+vt.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=Object(r["l"])(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=Un.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=vt.reshapeManipulators.edge.size/2+vt.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||Object(Dn["i"])(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==i.pointerType||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(e=>{e.manipulator.interactive=!this._numGrabbing&&Object(r["l"])(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!this._numGrabbing)}),Object(r["t"])(this._graphicMoveManipulation).forEachManipulator(e=>e.interactive=!this._numGrabbing))})}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(r["t"])(this._editGeometryOperations);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Fn),e.manipulator.grabbing&&Object(r["l"])(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if(Object(r["l"])(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=i.location,r=a.location,s=.5,o=n.x+s*(r.x-n.x),c=n.y+s*(r.y-n.y),l=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=Object(yt["g"])(o,c,l,t.data.spatialReference)}else Object(b["i"])(Hn,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=Hn}}_splitEdgeManipulator(e,t=.5){const i=Object(r["t"])(this._editGeometryOperations),a=Object(r["t"])(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const n=Object(d["e"])(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(a)):(s=e,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this._updateSelection(e.manipulator);const o=this._updateEventState(2),c=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:c,componentIndex:l,vertexIndex:Object(r["t"])(a.index)}],added:c}),o&&this._updateEventState(0),s}_updateMoveManipulationPosition(){const e=Object(b["w"])(Hn,0,0,0);let t=0,i=!1,a=null,n=null;for(const s of this._manipulatorInfos)In(s)&&(s.manipulator.selected?(t++,Object(b["f"])(e,e,s.manipulator.renderLocation),Object(r["k"])(a)||s.selectedIndex>a.selectedIndex?(n=a,a=s):(Object(r["k"])(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Xi(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Xi(this.graphic)}if(0!==t){let e=0;if(Object(r["l"])(a)){const t=a.handle.pos,i=Object(r["l"])(n)?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,s=!Object(r["l"])(n)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=zn(i,t):s&&(e=zn(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=_a}else this._moveManipulation.angleDeferred=()=>rn(Object(r["t"])(this.graphic.geometry)),this._moveManipulation.radius=pn.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(b["e"])(e,e,1/t),Fn.spatialReference=Object(r["t"])(this._editGeometryOperations).data.spatialReference,Fn.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Fn),this._moveManipulation.elevationAlignedLocation=Fn):Object(r["l"])(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(r["l"])(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Ni(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(r["t"])(this._editGeometryOperations);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=Object(r["t"])(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map(e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:Object(r["t"])(e.index)}});this.outputGeometry=i.data.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map(e=>e.coordinates),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?0:1)){const a=Object(r["t"])(this._editGeometryOperations);a.moveVertices(e.map(e=>e.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if(Object(r["k"])(t.operation))return;const i=Object(r["t"])(this._editGeometryOperations),a=t.operation.clone();a.distance=t.operation.signedDistanceToPoint(t.mapEnd),i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Ln(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function zn(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function In(e){return"vertex"===e.handle.type}function Ln(e){return"edge"===e.handle.type}Object(a["a"])([Object(o["b"])({constructOnly:!0})],kn.prototype,"tool",void 0),Object(a["a"])([Object(o["b"])()],kn.prototype,"inputGeometry",null),Object(a["a"])([Object(o["b"])()],kn.prototype,"outputGeometry",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],kn.prototype,"updating",null),kn=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],kn);const Fn=Object(yt["g"])(0,0,null,null),Hn=Object(g["f"])();var Un;!function(e){e.Vertex=16,e.Edge=32}(Un||(Un={}));let qn=class extends(_t["a"].EventedMixin(On["a"])){constructor(e){super(e),this._handles=new m["a"],this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null,this.automaticManipulatorSelection=!1}destroy(){this._handles=Object(r["e"])(this._handles),this._reshapeOperation=Object(r["e"])(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}_updateGeometry(){const e=Object(En["a"])(this.graphic);this._reshapeOperation.inputGeometry=Object(r["l"])(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==Object(En["b"])(this.graphic))return;const e=this.watch("graphic.geometry",()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){Object(r["k"])(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new kn({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)}),this._reshapeOperation.on("move",e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)}),this._reshapeOperation.on("vertex-add",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)}),this._reshapeOperation.on("vertex-remove",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)}),this._reshapeOperation.on("immediate-click",e=>this.emit("immediate-click",e)),this.view.on("pointer-down",["Shift"],e=>{e.stopPropagation()}),Object(s["a"])(this,"graphic",()=>{this._updateGraphic()},!0)]),this.complete()}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){Object(r["l"])(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(r["l"])(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){Object(r["l"])(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(r["l"])(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(a["a"])([Object(o["b"])()],qn.prototype,"_reshapeOperation",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qn.prototype,"view",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],qn.prototype,"graphic",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qn.prototype,"enableZShape",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qn.prototype,"enableZVertex",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qn.prototype,"enableMoveGraphic",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qn.prototype,"enableMidpoints",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qn.prototype,"enableEdgeOffset",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],qn.prototype,"type",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],qn.prototype,"snappingManager",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],qn.prototype,"updating",null),Object(a["a"])([Object(o["b"])()],qn.prototype,"automaticManipulatorSelection",void 0),qn=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],qn);var Bn,Wn=i("5815"),Nn=i("680b");!function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(Bn||(Bn={}));class Zn{constructor(e){this.mode=null,this._handles=new m["a"],this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new _t["a"],this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(r["l"])(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this.ringManipulator.location=e}set elevationAlignedLocation(e){this.ringManipulator.elevationAlignedLocation=e}get grabbing(){return this.ringManipulator.grabbing}set interactive(e){this.ringManipulator.interactive=e}destroy(){Object(r["l"])(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=Object(r["e"])(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object(Wn["a"])({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(r["l"])(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=Object(r["e"])(this._activeAnimation))}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(Ua["e"])(e,(e,i,a)=>{this._scaleRotateDragData=null,this.adapter.restart();const n={mode:"none",origin:Object(g["d"])(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this.updateDragState();const s=Ve["d"].get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,s),i.next(qa(this.tool.view,Object(E["g"])(e.renderLocation,s,Object(E["d"])()))).next(e=>{const i=Object(E["q"])(e.plane),a=qi(e.renderStart,e.renderEnd,n.origin,i),s=Nn["b"].shortestSignedDiff(n.angle,a);n.angleDir=Object(w["d"])(n.angleDir+s,-ka,ka),n.angle=a;const o=Xn(n,e),c=o-this.adapter.scale;if(n.scaleDir=Object(w["d"])(n.scaleDir+c,-Ga,Ga),this.onScaleChanged(),"none"===n.mode){const i=this.mode||Yn(e,e.plane,n.origin,this.tool.view.state.camera);if(Object(r["l"])(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}n.mode=i}}switch(n.mode){case"rotate":this.adapter.angle=n.initialAngle+a;break;case"scale":this.adapter.scale=o,this.onScaleChanged()}switch(this.updateDragState(),this.updateManipulatorTransform(),e.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(w["l"])(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:o,yScale:o})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(w["l"])(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:o,yScale:o})}}"end"===e.action&&(this.startAnimation(Kn(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null,this.updateDragState())}),a.next(()=>{if(this.adapter.cancel(),Object(r["l"])(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Kn(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null,this.updateDragState()}})});this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",e=>{"focus"===e.action?this.startAnimation(Jn(this,()=>this.updateDelayedFocusedState())):this.updateDelayedFocusedState()}),this.ringManipulator.events.on("immediate-click",e=>{e.stopPropagation()}),Object(s["a"])(this.tool.graphicState,"displaying",e=>this.ringManipulator.available=e)])}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Bn.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Bn.Unlocked,!(Object(r["l"])(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(r["l"])(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Bn.ScaleIn|Bn.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Bn.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Bn.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Bn.RotateLeft|Bn.RotateRight,!1),this.ringManipulator.updateStateEnabled(Bn.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Bn.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Bn.ScaleIn|Bn.ScaleOut|Bn.RotateLeft|Bn.RotateRight,!1)}updateManipulatorTransform(){const e=Object(A["j"])(Ve["a"].get()),t=this.adapter.angle;Object(A["f"])(e,e,t,Object(g["h"])(0,0,1));const i=this.getScale(),a=Object(A["w"])(Ve["a"].get(),Object(b["w"])(Ve["d"].get(),i,i,i)),n=Object(A["j"])(Ve["a"].get());Object(A["n"])(n,a,e),this.ringManipulator.modelTransform=n}createRingManipulator(){const e=(e,t,i)=>{const a=[],n=Math.ceil(ba*(t-e)/(2*Math.PI));for(let r=0;r<n+1;r++){const s=e+r*(t-e)/n;a.push(Object(g["h"])(i*Math.cos(s),i*Math.sin(s),0))}return a},t=t=>e(0,2*Math.PI,t),i=e=>[[-e/2,0],[e/2,0],[e/2,ja/2],[-e/2,ja/2]],a=(e,t)=>be["a"].createPathExtrusionGeometry(i(t),e,[],[],!1),n=t(ya),r=a(n,Ma),s={left:[],right:[]},o=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,i=Math.PI/2-Da,n=t+i,r=t+Math.PI/2-i,c=e(n,r,xa),l=a(c,wa);o.push(c),o.push(e(n,r,Sa-Ma/2)),s.left.push(l),s.right.push(l);for(let e=0;e<2;e++){const t=0===e,i=Object(C["d"])();if(t){Object(A["g"])(i,i,[1,-1,1]),Object(A["f"])(i,i,-n,[0,0,1]);const e=Math.round(Ca*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{Object(A["f"])(i,i,r,[0,0,1]);const e=Math.round((1-Ca)*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const a=be["a"].createExtrudedTriangle(Ea,0,Pa,ja);be["a"].transformInPlace(a,i),(t?s.left:s.right).push(a)}}const c=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,i=Math.PI/2-Ra,n=t+i,r=t+Math.PI/2-i,s=e(n,r,Sa);c.push(a(s,wa))}const l=t(ya+Ta),h=t(ya+Va),u=a(l,wa),p=a(h,wa),b=t(ya-Ta),m=t(ya-Va),f=a(b,wa),O=a(m,wa),v=this.createMaterial(),_=this.createMaterial(.66),y=this.createMaterial(.5),j=this.createMaterial(.33);let M=[{geometry:r,material:v,stateMask:Bn.DelayedFocused},{geometry:r,material:y,stateMask:0}];this.mode&&"scale"!==this.mode||(M=M.concat([{geometry:c,material:v,stateMask:Bn.DelayedFocused|Bn.Unlocked},{geometry:u,material:_,stateMask:Bn.DelayedFocused|Bn.ScaleIn},{geometry:p,material:j,stateMask:Bn.DelayedFocused|Bn.ScaleIn},{geometry:f,material:_,stateMask:Bn.DelayedFocused|Bn.ScaleOut},{geometry:O,material:j,stateMask:Bn.DelayedFocused|Bn.ScaleOut}])),this.mode&&"rotate"!==this.mode||(M=M.concat([{geometry:s.right,material:v,stateMask:Bn.DelayedFocused|Bn.Unlocked},{geometry:s.left,material:v,stateMask:Bn.DelayedFocused|Bn.RotateLeft},{geometry:s.right,material:v,stateMask:Bn.DelayedFocused|Bn.RotateRight}]));const w=[n,...o];return new Mi({view:this.tool.view,renderObjects:M,autoScaleRenderObjects:!1,worldOriented:!0,radius:Ma,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(d["e"])(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:w,direction:Object(g["h"])(0,0,1)}})}createMaterial(e=1){const t=[...pa,e];return new Ne["a"]({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{ringManipulator:this.ringManipulator}}}function Xn(e,t){const i=Object(b["j"])(Ve["d"].get(),t.renderStart,e.origin),a=Object(b["j"])(Ve["d"].get(),t.renderEnd,e.origin),n=Object(b["p"])(i),r=Object(b["p"])(a);return 0===n?0:r/n}function Yn(e,t,i,a){const{renderStart:n,renderEnd:r}=e,s=Qn(n,a,Ve["d"].get()),o=Qn(r,a,Ve["d"].get());if(Object(b["l"])(s,o)<Aa*Aa)return null;const c=Object(b["j"])(Ve["d"].get(),n,i),l=Object(b["g"])(Ve["d"].get(),c,Object(E["q"])(t)),h=n,d=Object(b["f"])(Ve["d"].get(),h,l),u=Qn(i,a,Ve["d"].get()),p=s,g=Qn(d,a,Ve["d"].get()),m=Object(b["j"])(Ve["d"].get(),g,p),f=Object(b["j"])(Ve["d"].get(),s,u),O=Object(j["g"])(p,m),v=Object(j["g"])(u,f);return Object(j["d"])(O,o)<Object(j["d"])(v,o)?"rotate":"scale"}function Qn(e,t,i){return t.projectToScreen(e,$n),Object(b["w"])(i,$n[0],$n[1],0)}function Kn(e,t){let i=null,a=1;const n=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=n,t()},update:e=>(a+=((a+1)/2-a)*Math.min(e*Ia,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}function Jn(e,t){let i=0,a=null;const n=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=n,i=0,t()},update:e=>(i+=e,!a()||i>za?1:0),destroy:()=>{e.getFocused=a,t()}}}const $n=Object(Me["f"])();var er=i("477c"),tr=i("33b0");function ir(e){return Object(r["l"])(e.geometry)&&"mesh"===e.geometry.type?ar(e.geometry):nr(e)}function ar(e){return Object(r["l"])(e.transform)?rr(e,e.transform):sr(e)}function nr(e){let t=e.geometry,i=r["p"];return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}function rr(e,t){let i=t.clone(),a=null;return{undo:t=>{a=Object(r["l"])(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=Object(r["l"])(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()}}}function sr(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}let or=class extends hi["a"]{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(cr);const e=this.geometry.transform;if(this.scale=1,Object(r["l"])(e)){const t=Object(tr["c"])(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=Object(w["f"])(Object(tr["a"])(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Object(er["b"])(()=>({angle:this.angle,scale:this.scale}),e=>this.update(e),er["d"]),cr)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return ir(this.graphic)}update({scale:e,angle:t}){const i=this.geometry.anchor,a=1===this.viewingMode;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:i,geographic:a}),this.previousScale=e,this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,Object(w["l"])(t-this.previousAngle),{origin:i,geographic:a}),this.previousAngle=t,this.graphic.notifyGeometryChanged())}};Object(a["a"])([Object(o["b"])({constructOnly:!0})],or.prototype,"graphic",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],or.prototype,"geometry",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],or.prototype,"viewingMode",void 0),Object(a["a"])([Object(o["b"])()],or.prototype,"angle",void 0),Object(a["a"])([Object(o["b"])()],or.prototype,"scale",void 0),or=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],or);const cr="scale-heading-update-key";let lr=class extends hi["a"]{constructor(e){super(e),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(hr);const e=Object(r["l"])(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:r["p"];if(this.symbol=Object(r["l"])(e)?e.clone():null,this.initialSizes=[],Object(r["l"])(e)){const t=this.findLayerView();Object(r["l"])(t)&&(this.initialSizes=e.symbolLayers.map(i=>"object"===i.type?t.getSymbolLayerSize(e,i):null).toArray())}this.angle=0,Object(r["l"])(e)&&e.symbolLayers.some(e=>!("object"!==e.type||!Object(r["l"])(e.heading))&&(this.angle=-Object(w["f"])(e.heading),!0)),this.initialAngle=this.angle,this.scale=1,this.handles.add(Object(er["b"])(()=>({angle:this.angle,scale:this.scale}),e=>this.updateSymbol(e),er["d"]),hr)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e,this.restart()},redo:i=>{e=i.symbol,i.symbol=t,this.restart()}}}updateSymbol({scale:e,angle:t}){const i=this.graphic.symbol;if(Object(r["k"])(this.symbol)||Object(r["k"])(i)||"point-3d"!==i.type)return;const a=i.clone(),n=-Object(w["l"])(t-this.initialAngle);let s=!1;this.forEachObjectSymbolLayerPair(this.symbol,a,(t,i,a)=>{const o=Object(r["u"])(t.heading,0)+n;i.heading!==o&&(i.heading=o,s=!0);const c=this.initialSizes[a];if(Object(r["l"])(c)&&"width"in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);const t=c.width*e;i.width!==t&&(i.width=t,s=!0);const a=c.depth*e;i.depth!==a&&(i.depth=a,s=!0);const n=c.height*e;i.height!==n&&(i.height=n,s=!0)}}),s&&(this.graphic.symbol=a)}forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach((e,a)=>{const n=t.symbolLayers.getItemAt(a);"object"===e.type&&"object"===n.type&&i(e,n,a)})}};Object(a["a"])([Object(o["b"])()],lr.prototype,"angle",void 0),Object(a["a"])([Object(o["b"])()],lr.prototype,"scale",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],lr.prototype,"graphic",void 0),Object(a["a"])([Object(o["b"])()],lr.prototype,"symbol",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],lr.prototype,"findLayerView",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0})],lr.prototype,"sizeFilter",void 0),lr=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],lr);const hr="scale-heading-update-key";let dr=class extends(Object(hi["b"])(_t["a"].EventedMixin(On["a"]))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new yn["a"]}initialize(){this.graphicState=new ni({graphic:this.graphic}),this.moveManipulation=new pn({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Xi(this.graphic),radius:pn.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator(e=>this.handles.add(e.events.on("immediate-click",e=>{this.emit("immediate-click",{...e,graphic:this.graphicState.graphic}),e.stopPropagation()}))),this.moveManipulation.elevationInfo=Object(d["e"])(this.graphic);const e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((t,i,a,n,s)=>(Object(r["l"])(e)&&0===t&&(a=a.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new _n["a"]({elevationInfo:Object(d["e"])(this.graphic),pointer:s,editGeometryOperations:vn["a"].fromGeometry(new ji["a"]({spatialReference:e.spatialReference}),this.view.state.viewingMode),visualizer:new Je,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:n}),this.snappingPipeline.next)),a),this.graphicState,e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:n}=e,r={graphic:i,dxScreen:a,dyScreen:n};switch(t){case"start":this.emit("graphic-translate-start",r),this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",r);break;case"end":this.emit("graphic-translate-stop",r)}}),this.moveManipulation.angle=Object(r["l"])(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",()=>this.updateMoveAngle())),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Zn({tool:this,mode:e,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",()=>this.onScaleChanged()))}this.handles.add([ua({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(n["c"])()}),this.graphicState.on("changed",()=>this.onGeometryChanged()),this.hideManipulatorsForGraphicState(),this.view.watch("scale",()=>this.updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator(e=>{e instanceof Mi&&this.handles.add(e.events.on("grab-changed",()=>this.updateManipulatorsInteractive()))}),this.complete()}updateManipulatorsInteractive(){Object(r["k"])(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}createScaleRotateAdapter(){return Object(r["l"])(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new or({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new lr({graphic:this.graphic,sizeFilter:e=>this.enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.graphic.layer)})}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(r["l"])(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",e=>{this.forEachManipulator(t=>t.available=e),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Xi(this.graphic)})}createGeometryUndoRecord(){return ir(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=Object(r["e"])(this.scaleRotate),this.scaleRotateAdapter=Object(r["e"])(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this.moveManipulation.location=e,Object(r["l"])(this.scaleRotate)&&(this.scaleRotate.location=e)}set elevationAlignedLocation(e){this.moveManipulation.elevationAlignedLocation=e,Object(r["l"])(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}reset(){}onDetach(){Object(r["l"])(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){Object(r["l"])(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(Object(r["k"])(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){2===this.view.state.viewingMode||this.view.scale<La?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}onGeometryChanged(){Ni(this.view,this,this.graphic)}enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(r["l"])(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],dr.prototype,"view",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],dr.prototype,"graphic",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],dr.prototype,"enableZ",void 0),Object(a["a"])([Object(o["b"])()],dr.prototype,"enableRotation",void 0),Object(a["a"])([Object(o["b"])()],dr.prototype,"enableScaling",void 0),Object(a["a"])([Object(o["b"])({value:!1})],dr.prototype,"snapToScene",null),Object(a["a"])([Object(o["b"])({constructOnly:!0})],dr.prototype,"snappingManager",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],dr.prototype,"type",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],dr.prototype,"updating",null),dr=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],dr);var ur=i("8048"),pr=i("0d9f"),br=i("e92d"),gr=i("04f0");Object(c["a"])("mac");const mr=2,fr=1.15,Or=1.15,vr=1.1,_r=(Math.cos(Object(w["f"])(45)),Math.cos(Object(w["f"])(5)),.7),yr=[1,.5,0],jr=[...yr,1],Mr=[1,1,1,1],wr=[1,.8,.6,1],xr=[1,.93,.86,1],Sr=[...yr,1],Er=[...yr,1],Pr=3,Dr=11,Rr=22.5,Ar=40,Cr=48,Tr=2.25,Vr=[...yr,1],Gr=4,kr=1,zr=.3,Ir=6,Lr=4,Fr=12,Hr=40,Ur=27;Object(C["d"])();var qr=i("8675"),Br=i("b04d");class Wr extends V["a"]{initializeProgram(e){const t=Wr.shader.get().build();return new k["a"](e.rctx,t,K["a"])}bindPass(e,t){Object(Ut["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){Object(Ut["d"])(this.program,e),this.program.rebindTextures()}initializePipeline(){return Object(I["f"])({blending:Object(I["g"])(1,1,771,771),depthTest:{func:513},colorWrite:I["c"]})}}Wr.shader=new T["a"](Br["a"],()=>i.e("chunk-2d0a47c1").then(i.bind(null,"0748")));zt["a"];Gt["a"];zt["b"];i("5996");Object(g["f"])();Object(g["f"])();i("84f4");var Nr=i("68af"),Zr=i("87b7"),Xr=i("f3d9");class Yr extends V["a"]{initializeProgram(e){const t=Yr.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new k["a"](e.rctx,a,K["a"])}bindPass(e,t){Object(Ut["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Ht["a"])(this.program,t))}bindDraw(e){Object(Ut["d"])(this.program,e),Object(Ft["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,a=3===e,n=2===e;return Object(I["f"])({blending:0!==i.output&&7!==i.output||!i.transparent?null:a?Qr:Object(qt["a"])(e),culling:Object(I["b"])(i.cullFace),depthTest:{func:Object(qt["b"])(e)},depthWrite:a?i.writeDepth&&I["d"]:Object(qt["c"])(e),colorWrite:I["c"],stencilWrite:i.sceneHasOcludees?Zr["h"]:null,stencilTest:i.sceneHasOcludees?t?Zr["d"]:Zr["c"]:null,polygonOffset:a||n?null:Object(qt["h"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}Yr.shader=new T["a"](Xr["a"],()=>i.e("chunk-2d215c84").then(i.bind(null,"c056")));const Qr=Object(I["h"])(1,771);class Kr extends G["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(a["a"])([Object(G["b"])({count:8})],Kr.prototype,"output",void 0),Object(a["a"])([Object(G["b"])({count:3})],Kr.prototype,"cullFace",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"slicePlaneEnabled",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"transparent",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"enableOffset",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"writeDepth",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"sceneHasOcludees",void 0),Object(a["a"])([Object(G["b"])({count:4})],Kr.prototype,"transparencyPassType",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"multipassTerrainEnabled",void 0),Object(a["a"])([Object(G["b"])()],Kr.prototype,"cullAboveGround",void 0);class Jr extends zt["a"]{constructor(e){super(e,es),this.supportsEdges=!0,this.techniqueConfig=new Kr}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<qt["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,n,r,s){Object(Q["f"])(e,t,a,n,r,void 0,s)}requiresSlot(e,t){return 20===e||(4===Object(kt["b"])(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new $r(e):void 0}createBufferWriter(){return new qr["a"](qr["d"])}}class $r extends Nr["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(Yr,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}const es={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...zt["b"]};var ts,is=i("3748"),as=i("6a0e"),ns=i("7ffa"),rs=i("1a3e"),ss=i("c6f7");let os=ts=class extends as["a"]{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new ts({position:Object(ns["a"])(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(r["g"])(this.position,e.position)&&this.width===e.width&&this.height===e.height}};Object(a["a"])([Object(o["b"])({readOnly:!0,json:{read:!1,write:!0}})],os.prototype,"type",void 0),Object(a["a"])([Object(o["b"])({type:ji["a"]}),Object(ss["a"])()],os.prototype,"position",void 0),Object(a["a"])([Object(o["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ss["a"])(),Object(rs["a"])(e=>Nn["a"].normalize(Object(l["i"])(e),0,!0))],os.prototype,"heading",void 0),Object(a["a"])([Object(o["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ss["a"])(),Object(rs["a"])(e=>Nn["a"].normalize(Object(l["i"])(e),0,!0))],os.prototype,"tilt",void 0),Object(a["a"])([Object(o["b"])({type:Number,nonNullable:!0}),Object(ss["a"])()],os.prototype,"width",void 0),Object(a["a"])([Object(o["b"])({type:Number,nonNullable:!0}),Object(ss["a"])()],os.prototype,"height",void 0),os=ts=Object(a["a"])([Object(h["a"])("esri.widgets.Slice.SlicePlane")],os);i("3af1");br["a"].getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function cs(e,t){return Bi(e.basis1,e.basis2,e.origin,t)}function ls(e,t,i,a){const n=t.worldUpAtPosition(e.origin,Ve["d"].get()),r=Ve["d"].get();switch(i){case 1:Object(b["k"])(r,n);break;case 2:Object(b["k"])(r,e.basis1)}return Object(E["g"])(e.origin,r,a)}function hs(e,t,i,a){const n=Object(b["p"])(a.basis1),r=Object(b["p"])(a.basis2),s=ps(a),o=bs(a),c=Object(b["w"])(Ve["d"].get(),0,0,0);Object(b["f"])(c,Object(b["e"])(Ve["d"].get(),a.basis1,t.direction[0]),Object(b["e"])(Ve["d"].get(),a.basis2,t.direction[1])),Object(b["f"])(c,a.origin,c);let l=0,h=1;if(gs(t))1===t.direction[0]&&-1===t.direction[1]?l=xs:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;l=1===e?xs:0,h=(1===e?r:n)-s}const d=Object(A["j"])(Ve["a"].get());Object(A["r"])(d,d,l),Object(A["g"])(d,d,Object(b["w"])(Ve["d"].get(),h,h,h)),Object(A["n"])(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}function ds(e,t,i,a){const n=a.worldUpAtPosition(i.origin,Ve["d"].get()),r=us(i,0),s=Object(A["j"])(Ve["a"].get());Object(A["r"])(s,s,r.edge*Math.PI/2),Object(A["e"])(s,s,-js(i,n)),Object(A["n"])(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=r.position}function us(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(b["f"])(Ve["d"].get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(b["f"])(Ve["d"].get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(b["j"])(Ve["d"].get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(b["j"])(Ve["d"].get(),e.origin,e.basis2),edge:t}}}function ps(e){const t=Object(b["p"])(e.basis1),i=Object(b["p"])(e.basis2);return zr*Math.min(t,i)}function bs(e){return ps(e)}function gs(e){return 0!==e.direction[0]&&0!==e.direction[1]}function ms(e,t=1){const i=0===t?Ar:0,a=[Object(g["h"])(i,0,-Cr/2),Object(g["h"])(i,0,Cr/2)],n=ys(a,!0),r=(e,t)=>vs(a,a,{tubeRadius:Pr,tipRadius:Dr,tipLength:Rr,tubeFocusMultiplier:fr,tipFocusMultiplier:Or,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),s=r(0,!1),o=r(Tr,!0),c=new Ne["a"]({color:Mr,cullFace:2,renderOccluded:16}),l=new Ne["a"]({color:wr,cullFace:2,renderOccluded:16}),h=new Ne["a"]({color:xr,cullFace:2,renderOccluded:16}),d=new Ne["a"]({color:Er,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),u=be["a"].createPolylineGeometry([[i,0,0],[i-Ar,0,0]]),p=be["a"].createPolylineGeometry([[i,0,0],[i-Ar,0,0]]),b=new is["a"]({color:Sr,renderOccluded:4});return new Mi({view:e,renderObjects:[...s.normal.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:h,transform:i,stateMask:1|Ms})),...o.normal.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:1|Ms})),{geometry:u,material:b,stateMask:1|Ms|ws},...s.focused.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:h,transform:i,stateMask:2|Ms})),...o.focused.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:2|Ms})),{geometry:p,material:b,stateMask:2|Ms|ws}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:Dr,state:Ms})}function fs(e,t){const i=new Jr({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),a=Hr,n=Ur,r=n*vr,s=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new We["a"]([["position",{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=be["a"].createPolylineGeometry([[0,0,0],[a-n,0,0]]),c=be["a"].createPolylineGeometry([[0,0,0],[a-r,0,0]]),l=new is["a"]({color:jr,renderOccluded:4}),h=[{geometry:s(n),material:i,stateMask:1|Ms},{geometry:o,material:l,stateMask:1|Ms},{geometry:s(r),material:i,stateMask:2|Ms},{geometry:c,material:l,stateMask:2|Ms}];return new Mi({view:e,renderObjects:h,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:n/2,state:Ms})}function Os(e,t){const i=gs(t),a=i?[Object(g["h"])(1,0,0),Object(g["h"])(0,0,0),Object(g["h"])(0,1,0)]:[Object(g["h"])(1,0,0),Object(g["h"])(-1,0,0)],n=be["a"].createPolylineGeometry(a),r=Vr,s=e=>new ge["a"]({color:r,width:e,renderOccluded:4}),o=()=>new is["a"]({color:r,renderOccluded:4}),c=i?Gr:kr,l=c*mr,h=kr,d=e=>e>1?s(e):o(),u=[{geometry:n,material:d(c),stateMask:1|Ss},{geometry:n,material:d(l),stateMask:2|Ss},{geometry:n,material:d(h),stateMask:Es}],p=new Mi({view:e,renderObjects:u,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?Ir:Lr});return p.state=Ss,p}function vs(e,t,i){const a=a=>{const n=(a?t:e).slice(0),s=Object(b["j"])(Ve["d"].get(),n[0],n[1]);Object(b["r"])(s,s);const o=Object(b["j"])(Ve["d"].get(),n[n.length-1],n[n.length-2]);if(Object(b["r"])(o,o),i.padding>0){const e=Object(b["e"])(Object(g["f"])(),o,-i.padding);if(n[n.length-1]=Object(b["f"])(e,e,n[n.length-1]),i.bothEnds){const e=Object(b["e"])(Object(g["f"])(),s,-i.padding);n[0]=Object(b["f"])(e,e,n[0])}}const c=a?i.tipFocusMultiplier:1,l=i.tipLength*(i.focusTipLength?c:1),h=i.tipRadius*c,d=Object(A["j"])(Ve["a"].get());if(i.padding>0){const e=l/4,t=Object(b["w"])(Ve["d"].get(),0,e,0),a=1+i.padding/e;Object(A["b"])(d,d,t),Object(A["g"])(d,d,Object(b["w"])(Ve["d"].get(),a,a,a)),Object(A["b"])(d,d,Object(b["e"])(t,t,-1/a))}const u=Object(A["j"])(Object(C["d"])()),p=Object(g["h"])(0,1,0),m=Object(A["h"])(Object(C["d"])(),Object(gr["g"])(Ve["b"].get(),p,o));m[12]=n[n.length-1][0],m[13]=n[n.length-1][1],m[14]=n[n.length-1][2],Object(A["n"])(m,m,d);const f=[{part:"tube",geometry:_s(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:u}];let O,v;if(Object(r["l"])(i.flat)?O=be["a"].createExtrudedTriangle(l,h,h,i.flat.thickness):(O=be["a"].createConeGeometry(l,h,24,!1,!1,!0),v=be["a"].createConeGeometry(l,h,24,!1,!0,!1)),f.push({part:"tip",geometry:O,transform:m}),v&&f.push({part:"cap",geometry:v,transform:m}),i.bothEnds){const e=Object(A["h"])(Object(C["d"])(),Object(gr["g"])(Ve["b"].get(),p,s));e[12]=n[0][0],e[13]=n[0][1],e[14]=n[0][2],Object(A["n"])(e,e,d),f.push({part:"tip",geometry:O,transform:e}),v&&f.push({part:"cap",geometry:v,transform:e})}return f};return{normal:a(!1),focused:a(!0)}}function _s(e,t,i){const a=[];if(Object(r["l"])(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const n=i/t*2*Math.PI;a.push([Math.cos(n)*e,Math.sin(n)*e])}}return be["a"].createPathExtrusionGeometry(a,i,[],[],!1)}function ys(e,t){const i=Object(b["j"])(Object(g["f"])(),e[e.length-1],e[e.length-2]);if(Object(b["r"])(i,i),Object(b["e"])(i,i,Fr),Object(b["f"])(i,i,e[e.length-1]),t){const t=Object(b["j"])(Object(g["f"])(),e[0],e[1]);return Object(b["r"])(t,t),Object(b["e"])(t,t,Fr),Object(b["f"])(t,t,e[0]),[t,...e,i]}return[...e,i]}function js(e,t){return Object(Ha["b"])(t,e.basis2,e.basis1)+xs}const Ms=16,ws=32,xs=(Object(j["c"])(),Math.PI/2),Ss=16,Es=32;const Ps="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/gAD/fAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/gAL/fgD/gAb/gAT/gwr/gQj/hA7/hAz/hxH/iBP/ixn/iRf/jBz/jR7/jyP/kCX/kyr/lS7/lCz/li//mTT/mTf/nDr/mjn/nTz/n0H/nT//oET/oEL/okf/oEX/o0r/pU3/o0v/pU//qFL/plH/qFX/qFP/qVb/q1n/rV3/rFz/rmD/rl7/sGL/rmH/tW3/s2v/tW//tW7/t3L/tnD/uHT/unb/unn/unf/vHv/vX3/v4D/vX7/w4n/xY3/xIv/x4//xY3/x5H/yZP/x5H/yJP/y5f/yZX/zZv/y5n/zZ3/zJv/z5//z6D/z6H/0aT/0KP/0qb/06j/1av/06r/1q3/1q//17H/2rb/2rb/2rj/3bz/4MH/38D/38H/4sX/4MT/48f/4sb/4sf/5Mr/5s3/5cz/5s3/59D/59D/6dT/6dP/6dT/6tb/6tX/6tf/69n/69j/7dr/7Nn/7dz/7dv/7t3/7t7/7t3/7+H/8eL/8uX/8eP/8+j/8+f/9On/8+j/9Or/9ez/9e3/9ez/9e3/9+//9+7/+PD/9+//+PH/+PD/+fL/+PH/+fT/+vX/+fT/+vb/+vX/+/b/+vb/+/j/+/j//Pr//Pn//fv//v3//vz//fz//fv//v3//fz//////v7//v3///9vf1WOAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADmklEQVR42qXXd3sUVRQG8BNDKkU3KLYUIFkLLBo0yRJNBszuuwQlGISIDUTFhljAhhUbtlXEYEcjoEJUNCqKPXZUUCDU0FvI+RpkZpa5c9iZzMzD7+/d88yde+95z5CbvIIhIyqrtbo6rboyUlKQR4GcGI7GIMSi4QHkU1bRKDgaVZRF3nKGanClDc4hD4Nq0CvtzAzqRd8L4GlkX3IVGg0fxpxMzjLOgk9hx2VkRuBbJNPh/+cjpQnezkuvcC6Q8vVseItkkKTWP6Pr17HwVkbCQFg+YJ4P3U0vtrS1t//c9u6zM+DgFLH/av+m7Gfe1IhpLf+ysmbxVBxrdD4ptvPzDvdY2trNUvfytBLlZDkdloZt3GPvPk5z8K0EpFMpJacWlmTqmdnBd1dBqMkm01BY4n+waTsb1nd0drHl/2kQSsiQpcHyKKd0MP/YfOt4AJfPWtTOKRumw04z+0MRlNV81PezoNz5JZv+boRdIemisMxkS+ck2M3rZMPHskcZ/Q/KR6y8D2HqWjbMh11/IgrDfoiU7lsgXGNW6GgQB1quYPrClk9+WnuITash3WGWfw02VUR5MUCKX3n7w8m3P1z121xIzazbMg5KLJcK4Ntl5vV4EDYhGgz/XmDdcnmWRsC/iQeM1wibYVSBAL5g3WQoF9JFCOBN1t0PpZo0BDCPdU9BqaU6BPAA65JQLglWYDbrFooCGgJ4jHXPiSUEeokvse4hKNXBtnEF624W2xiBf/GN3GP3pVCG0xAIE57+9h64uZd1bbApFpcpMXfFLuaVcLOKdS/DJiSu87UHucfhOb0+wIEmeZ0pCqWVdX+Nh5MJ61i3BDaVsqVhphkCnyaQrt68SYdvhE0pEQ2AzRI2LBuX3k1a2fAe7PoRyTU0/seGb66ANPkHNqxpEG1dBIvhvkNs2PLMWCiJ5FY27LlbBouMNsOTXWz6p/lqmK57fR2buh+HjDYVrsqCLhWmK5cuXvbZBhUVzzuGK+XUwO6J3exs5yMQLs6mlNMg3PY7O/nlBkiDyDISQv2CHXysrckEpHI5ZEmTXpUzyp+vTOx1yHLIp/icN74y927z54vuiiNNiISwc5hNub6pHoo8xNI5CCSS4T5sw/ewLZ1wNnwbnklOyuBPrJRcnKTBhzEDyVV+OTyV5x/fZ98Z5CG7RIOr2pJs8tanMApH0cI+5FP/sqoYhFhVaT8KJDdUHKkwP/8rhhWHct1+dwRTps/cplDIpwAAAABJRU5ErkJggg==",Ds={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function Rs(e){return e.fromData(Ps,()=>new Le["a"](Ps,Ds))}class As{constructor(){this.lastDragEvent=null,this.next=new Ua["a"],this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(r["l"])(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const t=gs(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}var Cs=i("157c"),Ts=i("e1e0"),Vs=i("fbd0"),Gs=i("34f2");function ks(e,t){return Is(e,t,!1)}function zs(e,t){return Is(e,t,!0)}function Is(e,t,i){if(e instanceof Gs["a"]){if(e.operation instanceof Cs["a"])return Ls(e.operation,t,i),!0;if(e.operation instanceof Ts["a"])return Fs(e.operation,t,i),!0;if(e.operation instanceof Vs["a"])return Hs(e.operation,t,i),!0}return!1}function Ls(e,t,i=!1){const a=i?-1:1,n=Object(g["h"])(a*e.dx,a*e.dy,a*e.dz);Object(b["f"])(t.origin,t.origin,n)}function Fs(e,t,i=!1){const a=i?-e.angle:e.angle;Object(b["d"])(t.basis1,t.basis1,g["c"],a),Object(b["d"])(t.basis2,t.basis2,g["c"],a)}function Hs(e,t,i=!1){const a=i?1/e.factor1:e.factor1,n=i?1/e.factor2:e.factor2;Object(b["e"])(t.basis1,t.basis1,a),Object(b["e"])(t.basis2,t.basis2,n),Object(we["q"])(t.origin,t.origin,e.origin,e.axis1,a),Object(we["q"])(t.origin,t.origin,e.origin,e.axis2,n)}function Us(e,t,i,a){a||(a=Object(pr["c"])());const n=Object(we["s"])(Ve["c"].get(),e[1],-e[0]),r=Object(we["s"])(Ve["c"].get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(we["s"])(Ve["c"].get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=Ve["c"].get();t.components.forEach(t=>t.vertices.forEach(t=>{const i=t.pos;Object(we["s"])(o,Object(we["k"])(e,i),Object(we["k"])(n,i)),Object(we["w"])(r,r,o),Object(we["x"])(s,s,o)}));const c=1e-6,l=Object(we["s"])(Ve["c"].get(),s[0]-r[0]<c?i/2:0,s[1]-r[1]<c?i/2:0);return Object(we["f"])(r,r,l),Object(we["m"])(s,s,l),Object(we["g"])(a.basis1,e,(s[0]-r[0])/2),Object(we["g"])(a.basis2,n,(s[1]-r[1])/2),Object(we["s"])(a.origin,r[0]*e[0]+r[1]*n[0],r[0]*e[1]+r[1]*n[1]),Object(we["m"])(a.origin,a.origin,a.basis1),Object(we["m"])(a.origin,a.origin,a.basis2),a}function qs(e,t,i,a=0,n){n||(n=Object(pr["c"])()),t.toRenderCoords(e.origin,i,n.origin);const r=Ve["d"].get();Object(b["f"])(r,e.origin,e.basis1),Object(b["f"])(r,r,e.basis2),t.toRenderCoords(r,i,r);const s=Ve["d"].get();Object(b["f"])(s,e.origin,e.basis1),Object(b["j"])(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=Ve["d"].get();Object(b["j"])(o,e.origin,e.basis1),Object(b["j"])(o,o,e.basis2),t.toRenderCoords(o,i,o);const c=Ve["d"].get();Object(b["j"])(c,e.origin,e.basis1),Object(b["f"])(c,c,e.basis2),t.toRenderCoords(c,i,c);const l=Object(b["i"])(Ve["d"].get(),r,s,.5);Object(b["j"])(l,l,n.origin);const h=Object(b["i"])(Ve["d"].get(),o,c,.5);Object(b["j"])(h,n.origin,h),Object(b["i"])(n.basis1,l,h,.5);const d=Object(b["i"])(Ve["d"].get(),c,r,.5);Object(b["j"])(d,d,n.origin);const u=Object(b["i"])(Ve["d"].get(),s,o,.5);Object(b["j"])(u,n.origin,u),Object(b["i"])(n.basis2,d,u,.5);const p=Object(b["g"])(Ve["d"].get(),n.basis1,n.basis2),g=Object(b["g"])(p,p,n.basis1);return Object(b["r"])(g,g),Object(b["e"])(n.basis2,g,Object(b["h"])(n.basis2,g)),Object(b["e"])(n.basis1,n.basis1,1+a/Object(b["p"])(n.basis1)),Object(b["e"])(n.basis2,n.basis2,1+a/Object(b["p"])(n.basis2)),Object(pr["k"])(n),n}let Bs=class extends(_t["a"].EventedMixin(On["a"])){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new As,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new m["a"],this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Object(pr["c"])(),this.mapBoundsStart=Object(pr["c"])(),this.displayBounds=Object(pr["c"])(),this.displayBoundsStart=Object(pr["c"])(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new ni({graphic:this.graphic});const e=this.graphic.geometry;this.editGeometryOperations=vn["a"].fromGeometry(e,this.view.state.viewingMode),this.graphicMoveManipulation=new mn({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this.createMoveXYGraphicDragPipeline()),this.moveZManipulator=ms(this.view,0),this.moveZManipulator.state|=ws,this.handles.add(this.watch("enableZ",()=>this.updateManipulatorAvailability(this.moveZManipulator,0))),this.handles.add(this.createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(e=>{const t=Os(this.view,e);return this.handles.add(this.watch("enableScaling",()=>this.updateManipulatorAvailability(t,2))),t.events.on("grab-changed",e=>this.onResizeGrab(e)),this.handles.add(this.createResizeDragPipeline(t,e)),t}),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=Rs(this.view.toolViewManager.textures),this.rotateManipulator=fs(this.view,this.rotateManipulatorTexture.texture),this.handles.add(this.watch("enableRotation",()=>this.updateManipulatorAvailability(this.rotateManipulator,3))),this.rotateManipulator.events.on("grab-changed",e=>{this.onRotateGrab(e)}),this.handles.add(this.createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds();const t=ua({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(n["c"])()});Object(r["l"])(t)&&(this.outlineVisualElement=t.visualElement instanceof Dt?t.visualElement:null),Object(r["l"])(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",()=>this.updateDisplayBounds())),this.handles.add(t),this.handles.add([this.graphicState.on("changed",()=>this.onGeometryChanged()),this.graphicState.watch("displaying",()=>this.updateAllManipulatorAvailability()),Object(s["a"])(this.graphicState,"isDraped",()=>this.graphicDrapedChanged()),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.centerOnSurfaceFrequent.watch("location",()=>this.updateDisplayBounds()));const a=e=>{this.handles.add(e.events.on("grab-changed",()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()}))};this.forEachManipulator(a);const o=(e,t)=>{this.handles.add(e.events.on("immediate-click",e=>{1===t&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))};this.forEachManipulator(o),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}graphicDrapedChanged(){this.handles.remove(Ws),this.updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",e=>{Object(r["l"])(this.attachmentOrigin)&&Object(fi["j"])(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds()}),Ws)}updateAllManipulatorAvailability(){this.forEachManipulator((e,t)=>this.updateManipulatorAvailability(e,t))}updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof Mi){const a=this.graphicState.displaying,n=this.enableZ&&Xi(this.graphic);switch(t){case 3:e.available=a&&this.enableRotation;break;case 2:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Ss:Es;break;case 0:e.available=a&&n;break;default:e.available=a}}}forEachManipulator(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach(t=>e(t,2)),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds()}calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],a=Object(we["f"])(Ve["c"].get(),i.leftVertex.pos,i.rightVertex.pos);Object(we["i"])(a,a);const n=Object(r["u"])(Wi(this.view,this.graphic),e.extent.center);let s=Zs*this.view.pixelSizeAt(n);const o=this.view.spatialReference;o!==e.spatialReference&&(s*=Object(ur["d"])(o)/Object(ur["d"])(e.spatialReference)),Us(a,t,s,this.mapBounds)}updateDisplayBounds(){const e=this.graphic.geometry;if(Object(r["k"])(e))return;const t=Object(r["l"])(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(r["l"])(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Wi(this.view,this.graphic);this.attachmentOrigin=Object(r["u"])(t,e.extent.center);const i=Object(r["l"])(t)?t.z:Object(ke["f"])(this.mapBounds.origin,this.view.elevationProvider,ze["a"].fromElevationInfo(Object(d["e"])(this.graphic)),this.view.renderCoordsHelper),a=Object(pr["a"])(this.mapBounds);a.origin[2]=i,qs(a,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this.updateManipulators()}get displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return Ns*this.view.pixelSizeAt(t)}createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline((e,t,i)=>this.applyGraphicMoveSteps(t,i))}createMoveZDragPipeline(){const e=this.view,t=this.editGeometryOperations.data.spatialReference;return Object(Ua["e"])(this.moveZManipulator,(i,a,n)=>{const r=Object(g["d"])(i.renderLocation),s=a.next(Ka(e,r,t)).next(Object(Ua["c"])());this.applyGraphicMoveSteps(s,n)})}applyGraphicMoveSteps(e,t){const i=e.next(e=>("start"===e.action&&(this.inputState={type:"move"},Object(pr["a"])(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e)).next(Object(Ua["b"])()).next(this.moveDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e});return t.next(()=>{Object(r["l"])(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()}),i}moveDragUpdateGeometry(){return e=>{if(Object(r["k"])(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const n of this.editGeometryOperations.data.components)t.push(...n.vertices);const i="start"===e.action?0:1,a=this.editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i);return ks(a,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}onResizeGrab(e){if("start"!==e.action)return;const t=this.calculatePickRay(e.screenPoint);Object(E["m"])(this.displayBounds.plane,t,Ve["d"].get())&&(Object(pr["a"])(this.displayBounds,this.displayBoundsStart),Object(pr["a"])(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}createResizeDragPipeline(e,t){return Object(Ua["e"])(e,(e,i,a)=>{Object(r["k"])(this.inputState)||(i.next(e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e)).next(qa(this.view,this.displayBoundsStart.plane)).next(e=>({...e,handle:t})).next(this.resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this.resizeDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e}),a.next(()=>{Object(r["l"])(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()}))})}resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin,n=this.displayBoundsMarginStart,r=Object(b["k"])(Ve["d"].get(),t.origin);Object(b["c"])(r,r,t.basis1,-i[0]),Object(b["c"])(r,r,t.basis2,-i[1]);const s=Object(b["j"])(Ve["d"].get(),e.renderEnd,r),o=Object(b["j"])(Ve["d"].get(),e.renderStart,r),c=gs(e.handle),l=bs(t),h=bs(this.displayBounds)/l,d=(e,t)=>{if(0===e)return 1;let i=Object(b["p"])(t),r=.5*e*Object(b["h"])(t,s)/i;const l=r<0?-1:1;c&&(r+=(i-.5*e*Object(b["h"])(t,o)/i)*l*h);const d=i<1.5*n?1:Xs;return i=Math.max(i-n,Xs),l>0&&(r-=a),l*Math.max(l*(r/i),d)};return{...e,factor1:d(i[0],t.basis1),factor2:d(i[1],t.basis2)}}}resizeDragUpdateGeometry(){return e=>{const t=Object(b["k"])(Object(g["f"])(),this.mapBoundsStart.origin);Object(b["c"])(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(b["c"])(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(we["s"])(Object(x["a"])(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(we["i"])(i,i);const a=[];for(const s of this.editGeometryOperations.data.components)a.push(...s.vertices);const n="start"===e.action?0:1,r=this.editGeometryOperations.scaleVertices(a,t,i,e.factor1,e.factor2,n,1);return Object(pr["a"])(this.mapBoundsStart,this.mapBounds),ks(r,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}onRotateGrab(e){if("start"!==e.action)return;const t=ls(this.displayBounds,this.view.renderCoordsHelper,1,Object(E["d"])()),i=this.calculatePickRay(e.screenPoint);Object(E["m"])(t,i,Ve["d"].get())&&(Object(pr["a"])(this.displayBounds,this.displayBoundsStart),Object(pr["a"])(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}createRotateDragPipeline(e){return Object(Ua["e"])(e,(e,t,i)=>{const a=this.inputState;Object(r["k"])(a)||(t.next(e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e)).next(qa(this.view,a.rotatePlane)).next(this.rotateDragRenderPlaneToRotate(a)).next(this.rotateDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,angle:Object(w["l"])(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e}),i.next(()=>{Object(r["l"])(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()}))})}rotateDragRenderPlaneToRotate(e){return t=>{const i=Object(E["q"])(e.rotatePlane),a=qi(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}rotateDragUpdateGeometry(){return e=>{const t=Object(b["k"])(Object(g["f"])(),this.mapBoundsStart.origin),i=[];for(const r of this.editGeometryOperations.data.components)i.push(...r.vertices);const a="start"===e.action?0:1,n=this.editGeometryOperations.rotateVertices(i,t,e.rotateAngle,a,1);return Object(pr["a"])(this.mapBoundsStart,this.mapBounds),ks(n,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}calculatePickRay(e){const t=Object(j["c"])(),i=Object(Me["i"])(e);return vi(this.view.state.camera,i,t),Object(b["r"])(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;const e=cs(this.displayBounds,Ve["a"].get());ds(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach((t,i)=>{hs(t,this.resizeHandles[i],e,this.displayBounds)})}updateZMoveHandle(e,t){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:Object(b["j"])(Ve["d"].get(),i.origin,i.basis1),edge:2},n=Ve["a"].get();Object(A["r"])(n,t,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}cancel(){const e=this.editGeometryOperations.lastOperation;Object(r["k"])(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,zs(e,this.mapBounds),this.updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if(Object(r["l"])(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,zs(Object(r["t"])(e),this.mapBounds),this.updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,ks(Object(r["t"])(e),this.mapBounds),this.updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],Bs.prototype,"view",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],Bs.prototype,"graphic",void 0),Object(a["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],Bs.prototype,"enableZ",void 0),Object(a["a"])([Object(o["b"])()],Bs.prototype,"enableRotation",void 0),Object(a["a"])([Object(o["b"])()],Bs.prototype,"enableScaling",void 0),Object(a["a"])([Object(o["b"])()],Bs.prototype,"preserveAspectRatio",null),Object(a["a"])([Object(o["b"])()],Bs.prototype,"grabbing",void 0),Object(a["a"])([Object(o["b"])()],Bs.prototype,"inputState",void 0),Object(a["a"])([Object(o["b"])({readOnly:!0})],Bs.prototype,"type",void 0),Bs=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Bs);const Ws="draped-elevation-changes",Ns=10,Zs=80,Xs=1e-6},4772:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var a=i("a4ee"),n=i("fc29"),r=i("e92d"),s=i("b2b2"),o=i("f4cc"),c=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),h=i("7aa6"),d=i("2c4f");class u{constructor(){this._isToolEditable=!0,this._manipulators=new d["a"],this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){return this.addMany([e],t)[0]}addMany(e,t=0){return e.map(e=>{const i=this._nextManipulatorId++,a={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(a),this._attached&&this._updateManipulatorAttachment(a),i})}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this._manipulators.forEach(({manipulator:e})=>{e.destroy&&e.destroy()}),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,a=Number.MAX_VALUE;return this._manipulators.forEach(({id:n,manipulator:r,attached:o})=>{if(!o||!r.interactive)return;const c=r.intersectionDistance(e,t);Object(s["l"])(c)&&c<a&&(a=c,i={id:n,manipulator:r})}),i}findById(e){if(Object(s["k"])(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}const p=r["a"].getLogger("esri.views.interactive.InteractiveToolBase");let b=class extends n["a"]{constructor(e){super(e),this.toolState="pending",this.completed=!1,this.manipulators=new u,this.updating=!1,this.automaticManipulatorSelection=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationStartedResolver=Object(o["f"])(),this._creationFinishedResolver=Object(o["f"])()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._set("visible",e),e||this.active&&(this.view.activeTool=null),this.attached&&(e?this._show():this._hide())}get editable(){return this.getEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}get attached(){return this._get("attached")}get created(){return"created"===this.toolState}get cursor(){return null}attach(){this.attached?p.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):p.error("Tool isn't currently attached. Ignoring detach request.")}activate(){Object(s["k"])(this.view)?p.error("Can't activate tool if view is not defined."):this.active?p.warn("Tool is already active, ignoring activation request."):(Object(h["b"])(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.active?this.onDeactivate():p.warn("Tool is not active, ignoring deactivation request.")}handleInputEvent(e){this.attached?this.onInputEvent(e):p.warn("handleInputEvent() called on detached tool")}handleInputEventAfter(e){this.attached?this.onInputEventAfter(e):p.warn("handleInputEventAfter() called on detached tool")}destroy(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),0===e&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(e){return this._editableFlags.get(e)}whenCreationStarted(){return this._creationStartedResolver.promise}whenCreated(){return this._creationFinishedResolver.promise}rejectCreation(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}onActivate(){}onDeactivate(){}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}startToolCreation(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error("Unexpected tool state "+this.toolState)}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error("Unexpected tool state "+this.toolState)}}complete(){this.finishToolCreation(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}};Object(a["a"])([Object(c["b"])()],b.prototype,"toolState",void 0),Object(a["a"])([Object(c["b"])({constructOnly:!0})],b.prototype,"view",void 0),Object(a["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"active",null),Object(a["a"])([Object(c["b"])({value:!0})],b.prototype,"visible",null),Object(a["a"])([Object(c["b"])({value:!0})],b.prototype,"editable",null),Object(a["a"])([Object(c["b"])({value:!1,readOnly:!0})],b.prototype,"attached",null),Object(a["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"created",null),Object(a["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"completed",void 0),Object(a["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"manipulators",void 0),Object(a["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"updating",void 0),Object(a["a"])([Object(c["b"])()],b.prototype,"cursor",null),Object(a["a"])([Object(c["b"])()],b.prototype,"automaticManipulatorSelection",void 0),b=Object(a["a"])([Object(l["a"])("esri.views.interactive.InteractiveToolBase")],b)},"536f":function(e,t,i){"use strict";function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e){let t=0,i=0;for(let a=0;a<e.length;a++){const n=e[a].size;"number"==typeof n&&(t+=n,i++)}return t/i}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?n(e.stops):t}function s(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:a}=t;return(r(i,e)+r(a,e))/2});let a=0;const n=i.length;if(0===n)return e;for(let r=0;r<n;r++)a+=i[r];const s=Math.floor(a/n);return Math.max(s,e)}function o(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return a(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos.forEach(t=>{e=a(e,t.symbol)}),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach(t=>{e=a(e,t.symbol)}),e}return t.type,n}i.d(t,"a",(function(){return o}))},"56d6":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var a=i("9e77"),n=i("3886"),r=i("690a");function s(e){const t=new r["a"];return t.include(a["a"],e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(n["a"]`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = uModelViewMatrix * vec4(pos, 1);
vec4 projPos = uProjectionMatrix * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;
vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(n["a"]`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const o=Object.freeze({__proto__:null,build:s})},"5bab":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var a=i("b2b2"),n=i("a915"),r=i("1a54"),s=i("f408");class o{constructor(e,t,i,a=null){this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=a}screenToMap(e){if(Object(a["l"])(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n["f"])(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n["f"])(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(a["l"])(t)&&(t.z=void 0),t}mapToScreen(e){const t=Object(r["g"])(e.x,e.y,Object(s["a"])(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class c{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return Object(a["l"])(t)&&(t.z=Object(s["g"])(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return Object(a["l"])(this.elevationInfo)&&(t=Object(r["g"])(e.x,e.y,Object(s["a"])(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class l{constructor(e){this.view=e,this.screenToMap=t=>e.toMap(t),this.mapToScreen=t=>e.toScreen(t)}}},"5ef2":function(e,t,i){"use strict";function a(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,a){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=a,n}function s(e,t){return new Float32Array(e,t,4)}function o(){return a()}function c(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function h(){return r(0,1,0,0)}function d(){return r(0,0,1,0)}function u(){return r(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return r}));const p=o(),b=c(),g=l(),m=h(),f=d(),O=u();Object.freeze({__proto__:null,create:a,clone:n,fromValues:r,createView:s,zeros:o,ones:c,unitX:l,unitY:h,unitZ:d,unitW:u,ZEROS:p,ONES:b,UNIT_X:g,UNIT_Y:m,UNIT_Z:f,UNIT_W:O})},"692f":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));var a=i("2252"),n=i("d272"),r=i("4db9"),s=i("d047"),o=i("c6d7"),c=i("ebd5"),l=i("4377"),h=i("3886"),d=i("690a");function u(e){const t=new d["a"];return t.include(r["a"],{linearDepth:!1}),t.include(a["a"],{}),t.include(n["a"],e),t.fragment.include(l["a"]),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(h["a"]`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(h["a"]`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),t.vertex.code.add(h["a"]`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(s["a"]),t.include(o["b"],e)),t.fragment.code.add(h["a"]`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(h["a"]`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):t.fragment.code.add(h["a"]`vec4 finalColor = color;`),t.fragment.code.add(h["a"]`
      if (finalColor.a < ${h["a"].float(c["c"])}) {
        discard;
      }
      ${7===e.output?h["a"]`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?h["a"]`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}const p=Object.freeze({__proto__:null,build:u})},"8a19":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var a=i("b2b2"),n=i("f4cc"),r=i("3563"),s=i("c20d"),o=i("1f1c"),c=i("9305");class l{constructor(){this.next=new s["a"]}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:l,updatingHandles:h}){if(Object(a["k"])(i))return e=>e;let d=null,u=null;const p=()=>{d=Object(a["a"])(d),i.doneSnapping(),Object(a["l"])(u)&&u.frameTask.remove(),u=null};return t.next(e=>(p(),e)),this.next=new s["a"],t=>{if(!e(t))return t;if(d=Object(a["a"])(d),"start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(c["b"].SNAPPING):c["a"];u={context:new o["a"]({editGeometryOperations:l.editGeometryOperations,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:Object(a["l"])(t.info)?t.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:Object(a["l"])(t.snapOrigin)?l.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(Object(a["l"])(u)){const e=u.context.coordinateHelper.vectorToDehydratedPoint(u.context.coordinateHelper.arrayToVector([u.originalPos.x,u.originalPos.y,u.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const a=t.mapStart.x-u.originalPos.x,s=t.mapStart.y-u.originalPos.y,o={...t,action:"udpate"},c=u.context,l=i.update(e,u.context);if(t.mapEnd.x=l.x+a,t.mapEnd.y=l.y+s,"end"!==t.action){const t=u.frameTask;d=Object(n["g"])(async n=>{const h=await t.schedule(()=>i.snap(e,c,n),n);if(h.valid){const e=await t.schedule(()=>h.apply(),n);Object(r["a"])(e,l)||(o.mapEnd.x=e.x+a,o.mapEnd.y=e.y+s,this.next.execute(o))}}),h.addPromise(d.promise)}}return"end"===t.action&&p(),t}}}},"9e77":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i("d047"),n=i("3886");function r(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(n["a"]`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function s(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(a["a"]),e.include(r),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(n["a"]`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),e.fragment.code.add(n["a"]`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),e.fragment.code.add(n["a"]`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),e.fragment.code.add(n["a"]`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?e.fragment.code.add(n["a"]`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):e.fragment.code.add(n["a"]`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},a997:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var a=i("38a4"),n=i("9e77"),r=i("2aad"),s=i("3886"),o=i("690a");const c=Object(a["f"])(6);function l(e){const t=new o["a"];return t.extensions.add("GL_OES_standard_derivatives"),t.include(r["a"]),t.include(n["a"],e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(s["a"]`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.pointDistanceEnabled&&t.fragment.code.add(s["a"]`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.intersectsLineEnabled&&t.fragment.code.add(s["a"]`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(s["a"]`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.fragment.code.add(s["a"]`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled&&t.fragment.code.add(s["a"]`{
float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
color = max(color, heightManifoldColor * heightManifoldAlpha);
}`),e.pointDistanceEnabled&&t.fragment.code.add(s["a"]`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`),e.lineVerticalPlaneEnabled&&t.fragment.code.add(s["a"]`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`),e.intersectsLineEnabled&&t.fragment.code.add(s["a"]`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`),t.fragment.code.add(s["a"]`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}const h=Object.freeze({__proto__:null,defaultAngleCutoff:c,build:l})},ae3c:function(e,t,i){"use strict";i.d(t,"a",(function(){return B})),i.d(t,"b",(function(){return Z}));var a=i("a4ee"),n=i("8d60"),r=(i("c120"),i("ce6d")),s=i("9096"),o=i("c649"),c=i("b2b2"),l=i("59b2"),h=i("b50f"),d=(i("cea0"),i("d386")),u=i("ce0b"),p=(i("e06a"),i("7ffa")),b=i("8048"),g=i("b48e"),m=i("ea51"),f=i("32ed"),O=i("7f83"),v=i("a29a"),_=i("f7eb"),y=i("04f0"),j=i("b139"),M=i("e431"),w=i("0b2d"),x=i("4ae5");function S(e,t,i=null){return Object(c["l"])(i)?[e,t,i]:[e,t]}function E(e,t,i=null){return Object(c["l"])(i)?{x:e,y:t,z:i}:{x:e,y:t}}class P{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return Object(c["h"])(e.map(e=>this.mapToLocal(e)))}get doUnnormalization(){return!1}}class D extends P{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=Object(_["b"])(),this.transformInv=Object(_["b"])(),this.transform=Object(_["a"])(e),Object(v["a"])(this.transformInv,this.transform)}makeMapPoint(e,t){return S(e,t,this.defaultZ)}mapToLocal(e){return E(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return S(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class R extends P{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=Object(w["f"])(),this.tangentFrameUpWS=Object(w["f"])(),this.tangentFrameRightWS=Object(w["f"])(),this.tangentFrameForwardWS=Object(w["f"])(),this.localFrameRightWS=Object(w["f"])(),this.localFrameUpWS=Object(w["f"])(),this.worldToLocalTransform=Object(j["b"])(),this.localToWorldTransform=Object(j["b"])(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const a=Object(w["f"])();Object(M["e"])(a,this.tangentFrameForwardWS,Object(M["h"])(i,this.tangentFrameForwardWS)),Object(M["j"])(this.localFrameRightWS,i,a),Object(M["r"])(this.localFrameRightWS,this.localFrameRightWS),Object(M["g"])(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Object(y["g"])(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Object(y["c"])(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return S(e,t,this.defaultZ)}mapToLocal(e){const t=Object(w["f"])();this.view.renderCoordsHelper.toRenderCoords(new x["a"]({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(M["u"])(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(c["l"])(i)?E(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=Object(w["f"])();this.view.renderCoordsHelper.toRenderCoords(new x["a"]({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(M["u"])(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(c["l"])(i)?S(i.x,i.y,this.defaultZ):null}}function A(e,t){if("2d"===e.type)return new D(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new x["a"]({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new x["a"]({x:t[0],y:t[1],spatialReference:e.spatialReference});return new R(e,i)}return null}var C=i("57dc"),T=i("521c"),V=i("1219");function G(e,t){const i=new x["a"]({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function k(e,t){return new C["a"]({points:e,spatialReference:t})}function z(e,t,i){const a=new T["a"]({paths:e,spatialReference:t});return i&&Object(f["i"])(a),a}function I(e,t,i,a=!0){const n=Object(p["a"])(e);n.forEach(e=>{const t=e[0],i=e[e.length-1];Object(h["c"])(t,i)&&1!==e.length||e.push(e[0])});let r=new V["a"]({rings:n,spatialReference:t});return r.rings.forEach(e=>{Object(f["g"])(e,!1,!1)||e.reverse()}),i&&Object(f["i"])(r),a&&r.isSelfIntersecting&&Object(O["l"])(t)&&(r=Object(m["simplify"])(r)),r}function L(e,t,i){const a=t.mapToLocalMultiple(e),n=[],r={x:a[0].x,y:a[0].y},s={x:a[1].x,y:a[1].y},o=Math.round(s.x-r.x),l=Math.round(s.y-r.y),h=Math.max(Math.abs(o),Math.abs(l));if(i){const e={x:r.x+h,y:r.y+h},t={x:r.x-h,y:r.y-h};n.push(E(e.x,t.y),E(t.x,t.y),E(t.x,e.y),E(e.x,e.y))}else{const e={x:o>0?r.x+h:r.x-h,y:l>0?r.y+h:r.y-h};n.push(E(r.x,r.y),E(e.x,r.y),E(e.x,e.y),E(r.x,e.y))}return I([Object(c["h"])(n.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function F(e,t,i){let a=t.mapToLocalMultiple(e);if(1===a.length){const e=48,t=a[0];a=[E(t.x-e,t.y+e),E(t.x+e,t.y-e),E(t.x+e,t.y-e),E(t.x-e,t.y+e)]}const n=[],r={x:a[0].x,y:a[0].y},s={x:a[1].x,y:a[1].y};if(i){const e=Math.round(s.x-r.x),t=Math.round(s.y-r.y);n.push(E(r.x-e,r.y-t),E(s.x,r.y-t),E(s.x,s.y),E(r.x-e,s.y))}else n.push(E(r.x,r.y),E(s.x,r.y),E(s.x,s.y),E(r.x,s.y));return I([Object(c["h"])(n.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function H(e,t,i,a){const n=t.mapToLocalMultiple(e);let r=null,s=null;if(i)r=n[0],s=n[1];else{const e=n[0],t=n[1],i=Math.round(t.x-e.x),a=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(a));r=E(i>0?e.x+o/2:e.x-o/2,a>0?e.y+o/2:e.y-o/2),s=E(Math.abs(i)>Math.abs(a)?r.x-o/2:r.x,Math.abs(i)>Math.abs(a)?r.y:r.y-o/2)}const o=t.localToMap(r),l=t.localToMap(s);if(Object(c["k"])(o)||Object(c["k"])(l))return null;t.doUnnormalization&&Object(f["j"])([[o,l]],t.spatialReference);const h=G(o,t.spatialReference),d=G(l,t.spatialReference),u=Object(b["d"])(t.spatialReference);let p=0;if(Object(O["l"])(t.spatialReference))p=u*Object(m["distance"])(h,d,null);else{const e=r.x-s.x,t=r.y-s.y;p=u*Math.sqrt(e*e+t*t)*(a||1)}const v=new g["a"]({center:h,radius:p,radiusUnit:"meters",spatialReference:t.spatialReference});return I(v.rings,v.spatialReference,!1)}function U(e,t,i){const a=t.mapToLocalMultiple(e),n=a[0],r=a[1],s=Math.round(r.x-n.x),o=Math.round(r.y-n.y),l=E(i?n.x:n.x+s/2,i?n.y:n.y+o/2),h=i?s:s/2,d=i?o:o/2,u=60,p=[],b=2*Math.PI/u;for(let c=0;c<u;c++){const e=Math.cos(c*b),t=Math.sin(c*b),i=E(h*e+l.x,d*t+l.y);p.push(i)}return p.push(p[0]),I([Object(c["h"])(p.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!1)}var q=i("4772");let B=class extends(Object(s["b"])(r["a"].EventedMixin(q["a"]))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new u["a"]({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e))]),this.complete()}destroy(){this.drawOperation=Object(c["e"])(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Object(c["e"])(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),Object(c["l"])(this._graphic)&&(this._graphic.symbol=e)}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new n["a"]({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(Object(o["c"])(()=>{Object(c["l"])(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=Object(c["e"])(this._graphic))}),W)}_destroyAllVisualisations(){this.handles.remove(N.outline),this.handles.remove(N.regularVertices),this.handles.remove(N.activeVertex),this.handles.remove(W)}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,a=i.slice();Object(c["l"])(t)&&a.push(this.drawOperation.coordinateHelper.pointToArray(t));const n=Object(c["l"])(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],r={regularVertices:null,activeVertex:null,full:null,outline:null},s=a.length,o=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":r.regularVertices=i,r.activeVertex=n,r.full=this.drawOperation.coordinateHelper.arrayToPoint(a[0]);break;case"multipoint":r.regularVertices=i,r.activeVertex=n,s>0&&(r.full=k(a,o));break;case"polyline":r.regularVertices=i,r.activeVertex=n,s>0&&(r.full=z([a],o,l));break;case"polygon":r.regularVertices=i,r.activeVertex=n,s>0&&(r.full=I([a],o,l,!0));break;case"circle":if(s>0){const t=A(this.view,a[0]);if(1===s&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+X*this.view.resolution,e[1]);r.full=H([e,i],t,!0)}else 2===s&&(r.full=this.forceUniformSize?H(a,t,this.centered):U(a,t,this.centered))}break;case"rectangle":if(s>0){const t=A(this.view,a[0]);if(1===s&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+X*this.view.resolution,e[1]);r.full=L([e,i],t,!0)}else 2===s&&(r.full=this.forceUniformSize?L(a,t,this.centered):F(a,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":s>1&&(r.outline=z([a],o,l));break;case"circle":case"rectangle":Object(c["l"])(r.full)&&"polygon"===r.full.type&&(r.outline=I(r.full.rings,o,l))}return r}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});Object(c["l"])(e)&&(t=new n["a"]({geometry:e.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();Object(c["k"])(e)?this._destroyAllVisualisations():(Object(c["l"])(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),N.outline):this.handles.remove(N.outline),Object(c["l"])(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),N.regularVertices):this.handles.remove(N.regularVertices),Object(c["l"])(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),N.activeVertex):this.handles.remove(N.activeVertex),Object(c["l"])(e.full)?Object(c["k"])(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(W))}};Object(a["a"])([Object(l["b"])({value:!0})],B.prototype,"centered",null),Object(a["a"])([Object(l["b"])({nonNullable:!0})],B.prototype,"defaultZ",void 0),Object(a["a"])([Object(l["b"])()],B.prototype,"drawOperation",void 0),Object(a["a"])([Object(l["b"])({value:!0})],B.prototype,"enabled",null),Object(a["a"])([Object(l["b"])({value:!0})],B.prototype,"forceUniformSize",null),Object(a["a"])([Object(l["b"])({constructOnly:!0})],B.prototype,"geometryType",void 0),Object(a["a"])([Object(l["b"])()],B.prototype,"graphic",null),Object(a["a"])([Object(l["b"])({constructOnly:!0})],B.prototype,"graphicProperties",void 0),Object(a["a"])([Object(l["b"])()],B.prototype,"graphicSymbol",null),Object(a["a"])([Object(l["b"])({constructOnly:!0})],B.prototype,"hasZ",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],B.prototype,"mode",void 0),Object(a["a"])([Object(l["b"])()],B.prototype,"snappingManager",void 0),Object(a["a"])([Object(l["b"])()],B.prototype,"snapToScene",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],B.prototype,"type",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],B.prototype,"updating",null),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],B.prototype,"view",void 0),B=Object(a["a"])([Object(d["a"])("esri.views.draw.DrawGraphicTool")],B);const W="create-operation-graphic",N={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function Z(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const X=48},b04d:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));var a=i("3886"),n=i("690a");function r(){const e=new n["a"];return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(a["a"]`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(a["a"]`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const s=Object.freeze({__proto__:null,build:r})},c20d:function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return p})),i.d(t,"h",(function(){return O})),i.d(t,"i",(function(){return _})),i.d(t,"j",(function(){return j}));i("c649");var a=i("7ffa"),n=i("38a4"),r=i("b2b2"),s=i("a915"),o=i("0b2d"),c=i("8188"),l=i("cdc1");function h(e,t){let i=null,a=null;return n=>{if("cancel"===n.action)return void(Object(r["l"])(a)&&(a.execute({action:"cancel"}),i=null,a=null));const s={action:n.action,screenStart:n.start,screenEnd:n.screenPoint};"start"===n.action&&Object(r["k"])(i)&&(i=new S,a=new S,t(e,i,a,n.pointerType,s)),Object(r["l"])(i)&&i.execute(s),"end"===n.action&&Object(r["l"])(i)&&(i=null,a=null)}}function d(e,t){return e.events.on("drag",h(e,t))}function u(e,t){const i=[e.x,e.y,e.z],a=t,n=[Math.cos(a),Math.sin(a)],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(0===r)return null;n[0]/=r,n[1]/=r;const s=e=>{const t=(e.x-i[0])*n[0]+(e.y-i[1])*n[1];e.x=i[0]+t*n[0],e.y=i[1]+t*n[1]};return e=>(s(e.mapStart),s(e.mapEnd),e)}function p(e,t){let i=null;return a=>{if("start"===a.action&&(i=g(e,a.mapStart.spatialReference,t)),Object(r["k"])(i))return null;const n=a.mapEnd.x-a.mapStart.x,s=a.mapEnd.y-a.mapStart.y,o=a.mapEnd.z-a.mapStart.z;return i.move(n,s,o),{...a,translationX:n,translationY:s,translationZ:o}}}function b(e,t){return Object(r["k"])(e)?null:e.spatialReference.equals(t)?e.clone():Object(c["i"])(e,t)}function g(e,t,i){const a=e.geometry;if(Object(r["k"])(a))return null;if("mesh"===a.type)return m(e,a,t,i);const n=b(a,t),s=a.spatialReference;return Object(r["k"])(n)?null:{move:(t,i,a)=>{const r=Object(l["d"])(n.clone(),t,i,a);r.spatialReference.equals(s)?e.geometry=r:e.geometry=Object(c["i"])(r,s)}}}function m(e,t,i,a){if(Object(r["l"])(t.transform))return f(e,t,t.transform,i);if(!t.spatialReference.equals(i))return null;let n=0,s=0,o=0;return{move:(i,r,c)=>{const l=i-n,h=r-s,d=c-o;if(l||h||d){const u=t.origin.clone().offset(l,h,d);t.centerAt(u,{geographic:1===a}),e.notifyGeometryChanged(),n=i,s=r,o=c}}}}function f(e,t,i,a){const n=b(i.getOriginPoint(t.spatialReference),a),s=t.spatialReference;return Object(r["k"])(n)?null:{move:(t,a,h)=>{const d=Object(l["d"])(n.clone(),t,a,h);if(d.spatialReference.equals(s))i.origin=Object(o["h"])(d.x,d.y,d.z);else{const e=Object(c["i"])(d,s);Object(r["l"])(e)&&(i.origin=Object(o["h"])(e.x,e.y,e.z))}e.notifyGeometryChanged()}}}function O(e,t){const i=e.map(e=>Object(r["t"])(p(e,t))).filter(e=>Object(r["l"])(e));return e=>{const t=e.mapEnd.x-e.mapStart.x,a=e.mapEnd.y-e.mapStart.y,n=e.mapEnd.z-e.mapStart.z;return i.forEach(t=>t(e)),{...e,translationX:t,translationY:a,translationZ:n}}}function v(e,t){const i=new Map;for(const n of t)i.set(n,Object(a["a"])(e[n]));return t=>(i.forEach((t,i)=>{e[i]=t}),t)}function _(e){return Object(r["l"])(e.geometry)&&"mesh"===e.geometry.type?y(e,e.geometry):v(e,["geometry"])}function y(e,t){const i=Object(r["l"])(t.transform)?t.transform.clone():null,a=t.vertexAttributes.clonePositional();return n=>(t.transform=i,t.vertexAttributes=a,e.notifyGeometryChanged(),n)}function j(e){const t=e.map(e=>Object(r["t"])(_(e))).filter(e=>Object(r["l"])(e));return e=>(t.forEach(t=>t(e)),e)}function M(){let e=0,t=0,i=0;return a=>{"start"===a.action&&(e=a.mapStart.x,t=a.mapStart.y,i=a.mapStart.z);const n=a.mapEnd.x-e,r=a.mapEnd.y-t,s=a.mapEnd.z-i;return e=a.mapEnd.x,t=a.mapEnd.y,i=a.mapEnd.z,{...a,mapDeltaX:n,mapDeltaY:r,mapDeltaZ:s,mapDeltaSpatialReference:a.mapStart.spatialReference}}}function w(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const a=i.screenEnd.x-e,n=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:a,screenDeltaY:n}}}function x(e,t){let i=null,a=0,r=0;return o=>{if("start"===o.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(a=o.screenStart.x-i.x,r=o.screenStart.y-i.y)),null==i)return null;const c=Object(n["d"])(o.screenEnd.x-a,0,e.width),l=Object(n["d"])(o.screenEnd.y-r,0,e.height),h=Object(s["e"])(c,l);return o.screenStart=i,o.screenEnd=h,o}}class S{constructor(){this.execute=()=>{}}next(e,t=new S){return Object(r["l"])(e)&&(this.execute=i=>{const a=e(i);Object(r["l"])(a)&&t.execute(a)}),t}}},c6f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var a=i("b2b2"),n=i("2698"),r=i("e041"),s=i("8eed"),o=i("7af8"),c=i("92ef"),l=i("59b2");function h(e){return p[d(e)]||g}function d(e){return e instanceof Blob?e.type:u(e.url)}function u(e){const t=Object(r["n"])(e);return m[t]||b}const p={},b="text/plain",g=p[b],m={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const D in m)p[m[D]]=D;var f=i("fcf2");function O(e){const t=Object(a["l"])(e)&&e.origins?e.origins:[void 0];return(i,a)=>{const n=v(e,i,a);for(const e of t){const t=Object(l["c"])(i,e,a);for(const e in n)t[e]=n[e]}}}function v(e,t,i){if(Object(a["l"])(e)&&"resource"===e.type)return _(e,t,i);switch(Object(a["l"])(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=f["c"];return{read:e,write:t}}}}function _(e,t,i){const s=Object(o["b"])(t,i);return{type:String,read:(e,t,i)=>{const a=Object(f["d"])(e,t,i);return s.type===String?a:"function"==typeof s.type?new s.type({url:a}):void 0},write:{writer(t,o,l,h){if(!h||!h.resources)return"string"==typeof t?void(o[l]=Object(f["e"])(t,h)):void(o[l]=t.write({},h));const d=E(t),u=d?Object(f["e"])(d,{...h,verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,p=s.type!==String&&(!Object(n["a"])(this)||h&&h.origin&&this.originIdOf(i)>Object(c["d"])(h.origin));h&&h.portalItem&&Object(a["l"])(u)&&!Object(r["s"])(u)?p?j(this,i,t,u,o,l,h,e):M(u,o,l,h):h&&h.portalItem&&(Object(a["k"])(u)||Object(a["l"])(Object(f["b"])(u))||Object(r["t"])(u)||p)?y(this,i,t,u,o,l,h,e):o[l]=u}}}}function y(e,t,i,n,o,c,l,d){const u=Object(s["a"])(),p=x(i,n,l),b=Object(r["z"])(Object(a["j"])(d,"prefix"),u),g=`${b}.${h(p)}`,m=l.portalItem.resourceFromPath(g);Object(r["t"])(n)&&l.resources.pendingOperations.push(S(n).then(e=>{m.path=`${b}.${h(e)}`,o[c]=m.itemRelativeUrl}).catch(()=>{})),w(e,t,m,p,l.resources.toAdd),o[c]=m.itemRelativeUrl}function j(e,t,i,a,n,s,o,c){const l=o.portalItem.resourceFromPath(a),d=x(i,a,o);h(d)===Object(r["n"])(l.path)?(w(e,t,l,d,o.resources.toUpdate),n[s]=a):y(e,t,i,a,n,s,o,c)}function M(e,t,i,a){a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(e)}),t[i]=e}function w(e,t,i,a,n){n.push({resource:i,content:a,finish:i=>{P(e,t,i)}})}function x(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function S(e){const t=(await Promise.resolve().then(i.bind(null,"2eab"))).default,{data:a}=await t(e,{responseType:"blob"});return a}function E(e){return Object(a["k"])(e)?null:"string"==typeof e?e:e.url}function P(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}},d329:function(e,t,i){"use strict";function a(e){return"r"in e&&"g"in e&&"b"in e}function n(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function s(e){return"l"in e&&"c"in e&&"h"in e}function o(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return E})),i.d(t,"b",(function(){return w})),i.d(t,"c",(function(){return x})),i.d(t,"d",(function(){return S})),i.d(t,"e",(function(){return M}));const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const i=[];let a,n;if(e[0].length!==t.length)throw"dimensions do not match";const r=e.length,s=e[0].length;let o=0;for(a=0;a<r;a++){for(o=0,n=0;n<s;n++)o+=e[a][n]*t[n];i.push(o)}return i}function d(e){const t=[e.r/255,e.g/255,e.b/255].map(e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4),i=h(c,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function u(e){const t=h(l,[e.x/100,e.y/100,e.z/100]).map(e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function b(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function g(e){const t=e.l,i=e.a,a=e.b,n=Math.sqrt(i*i+a*a);let r=Math.atan2(a,i);return r=r>0?r:r+2*Math.PI,{l:t,c:n,h:r}}function m(e){const t=e.l,i=e.c,a=e.h;return{l:t,a:i*Math.cos(a),b:i*Math.sin(a)}}function f(e){return p(d(e))}function O(e){return u(b(e))}function v(e){return g(p(d(e)))}function _(e){return u(b(m(e)))}function y(e){const t=e.r,i=e.g,a=e.b,n=Math.max(t,i,a),r=n-Math.min(t,i,a);let s=n,o=0===r?0:n===t?(i-a)/r%6:n===i?(a-t)/r+2:(t-i)/r+4,c=0===r?0:r/s;return o<0&&(o+=6),o*=60,c*=100,s*=100/255,{h:o,s:c,v:s}}function j(e){const t=(e.h+360)%360/60,i=e.s/100,a=e.v/100*255,n=a*i,r=n*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:n,g:r,b:0};break;case 1:s={r:r,g:n,b:0};break;case 2:s={r:0,g:n,b:r};break;case 3:s={r:0,g:r,b:n};break;case 4:s={r:r,g:0,b:n};break;case 5:case 6:s={r:n,g:0,b:r};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+a-n),s.g=Math.round(s.g+a-n),s.b=Math.round(s.b+a-n),s}function M(e){return a(e)?e:s(e)?_(e):r(e)?O(e):o(e)?u(e):n(e)?j(e):e}function w(e){return n(e)?e:y(M(e))}function x(e){return r(e)?e:f(M(e))}function S(e){return s(e)?e:v(M(e))}function E(e,t){const i=f(e);return i.l*=1-t,O(i)}},e7e3:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var a=i("a4ee"),n=i("ce6d"),r=i("9096"),s=i("7ffa"),o=i("b2b2"),c=i("f4cc"),l=i("a915"),h=i("59b2"),d=(i("cea0"),i("d386")),u=i("3563");class p{constructor({grabbableForEvent:e}){this.events=new n["a"],this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}const b="click";var g=i("8b1a"),m=i("c20d"),f=i("6ae9"),O=i("2c8f"),v=i("1f1c"),_=i("8a19"),y=i("9305");let j=class extends(n["a"].EventedMixin(r["a"])){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingPipeline=new _["a"],this._snappingTask=null,this._stagedVertex=null,this.snapToSceneEnabled=null,Object(o["k"])(e.elevationInfo)&&(this.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0})}initialize(){var e,t;this.coordinateHelper=Object(g["a"])(this.hasZ,this.hasM,this.view.spatialReference);const i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=i?i.registerTask(y["b"].SNAPPING):y["a"];const a="viewingMode"in this.view.state?this.view.state.viewingMode:2,n="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new O["a"](new f["c"](n,this.coordinateHelper,a)),this._activeComponent=new f["a"](this.spatialReference,a),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],e=>{const t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)})),i=t.map(e=>e.coordinates);switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}})),this._manipulator=new p({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",e=>this._onImmediateClick(e)),this._manipulator.events.on("immediate-double-click",e=>this._onImmediateDoubleClick(e))])}destroy(){this._editGeometryOperations=Object(o["e"])(this._editGeometryOperations),this._frameTask=Object(o["s"])(this._frameTask)}get _snappingEnabled(){return Object(o["l"])(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}set drawingMode(e){this._set("drawingMode",null!=e?e:b)}get hasStagedVertex(){return Object(o["l"])(this._stagedVertex)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return Object(o["l"])(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get spatialReference(){return this.view.spatialReference}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if(Object(o["k"])(e))this.discardStagedVertex();else if(!Object(o["l"])(this._stagedVertex)||!Object(u["a"])(this._stagedVertex,e)){if(Object(o["k"])(this._stagedVertex))this._stagedVertex=Object(s["a"])(e);else{if(Object(u["a"])(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return Object(o["l"])(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingTask=Object(o["a"])(this._snappingTask),Object(o["l"])(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;Object(o["a"])(this._snappingTask),Object(o["l"])(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();const i="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:t,type:"complete"})}discardStagedVertex(){this._stagedVertex=null}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){Object(o["l"])(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Object(m["e"])(e,(e,t,i,a)=>{const n="touch"===a&&this._snappingEnabled;!this.isCompleted&&n&&(t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||n&&0===this.numVertices)&&this.commitStagedVertex()),e)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>n,cancel:i,snappingManager:this.snappingManager,snappingContext:new v["a"]({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:a,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(e=>(n&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e)).next(e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)),i.next(()=>{n&&Object(o["l"])(this.snappingManager)&&this.snappingManager.doneSnapping()}))})}_createManipulatorDragPipelineFreehand(e){return Object(m["e"])(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(Object(o["k"])(this.stagedVertex)&&(this.stagedVertex=e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e})})}_createManipulatorDragPipelineHybrid(e){return Object(m["e"])(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(Object(o["k"])(this.stagedVertex)&&(this.stagedVertex=e.mapStart),this.commitStagedVertex()),e)).next(e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e})})}_getDrawSurface(){if(Object(o["k"])(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;Object(o["l"])(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(o["l"])(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(o["l"])(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_onHold(e){Object(o["a"])(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if(Object(o["l"])(i))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();const a=this._screenToMap(e.screenPoint);if(Object(o["l"])(a))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(a)),this.complete());break;case"click":case"hybrid":this._snappingTask=Object(o["a"])(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(a)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){if(Object(o["a"])(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=Object(l["e"])(e.x,e.y),i=this._closeOnClickVertexIndex(t);if(Object(o["l"])(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);if(this._manipulator.cursor=Object(o["l"])(i)?"crosshair":null,Object(o["l"])(i))if(Object(o["l"])(this.snappingManager)){const t=this.snappingManager,a=new v["a"]({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=t.update(i,a),this._snappingTask=Object(c["g"])(async e=>{const n=await this._frameTask.schedule(()=>t.snap(i,a,e),e);n.valid&&await this._frameTask.schedule(()=>{this.stagedVertex=n.apply()},e)}),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=i}e.stopPropagation()}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),Object(o["k"])(e))return null;const i=this._screenToMap(t.screenEnd);return Object(o["l"])(i)?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=25,a=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!Object(o["l"])(a)&&M(a,t,i)}};function M(e,t,i){const a=e.x-t.x,n=e.y-t.y;return a*a+n*n<=i}Object(a["a"])([Object(h["b"])()],j.prototype,"defaultZ",void 0),Object(a["a"])([Object(h["b"])({value:b})],j.prototype,"drawingMode",null),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"elevationDrawSurface",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"elevationInfo",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"geometryType",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"hasM",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"hasZ",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"manipulators",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"drawSurface",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"snappingManager",void 0),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"snappingVisualizer",void 0),Object(a["a"])([Object(h["b"])()],j.prototype,"snapToSceneEnabled",void 0),Object(a["a"])([Object(h["b"])({readOnly:!0})],j.prototype,"updating",null),Object(a["a"])([Object(h["b"])({constructOnly:!0})],j.prototype,"view",void 0),j=Object(a["a"])([Object(d["a"])("esri.views.draw.DrawOperation")],j)},e94b:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));i("e06a");var a=i("b2b2"),n=i("8048"),r=i("536f"),s=i("3af1");function o(e,t,i,r=new s["a"]){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const r=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;o=Object(a["l"])(s)&&!s.equals(i.spatialReference)?Object(n["d"])(s)/Object(n["d"])(i.spatialReference):t*r}const c=e.x-o,l=e.y-o,h=e.x+o,d=e.y+o,{spatialReference:u}=i;return r.xmin=Math.min(c,h),r.ymin=Math.min(l,d),r.xmax=Math.max(c,h),r.ymax=Math.max(l,d),r.spatialReference=u,r}function c(e,t,i){const n=i.toMap(e);return!Object(a["k"])(n)&&o(n,Object(r["a"])(),i,l).intersects(t)}const l=new s["a"]},f3d9:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d}));var a=i("d272"),n=i("4db9"),r=i("d047"),s=i("c6d7"),o=i("ebd5"),c=i("4377"),l=i("3886"),h=i("690a");function d(e){const t=new h["a"];return t.include(n["a"],{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(l["a"]`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(a["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(r["a"]),t.include(s["b"],e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(l["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${l["a"].float(o["b"])}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(c["a"]),t.fragment.code.add(l["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${l["a"].float(o["b"])}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const u=Object.freeze({__proto__:null,build:d})}}]);
//# sourceMappingURL=chunk-6a8d130a.cc9733cb.js.map